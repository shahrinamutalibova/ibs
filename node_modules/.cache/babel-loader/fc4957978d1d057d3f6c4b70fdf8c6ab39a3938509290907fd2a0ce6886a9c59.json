{"ast":null,"code":"var __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\nvar __rest = this && this.__rest || function (s, e) {\n  var t = {};\n  for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0) t[p] = s[p];\n  if (s != null && typeof Object.getOwnPropertySymbols === \"function\") for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n    if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i])) t[p[i]] = s[p[i]];\n  }\n  return t;\n};\nimport { min, max } from 'd3-array';\nimport { tagCloud } from './utils/d3-cloud';\nimport { flow } from './utils/flow';\nconst DEFAULT_OPTIONS = {\n  size: [500, 500],\n  fontSize: [14, 28]\n};\nexport function processImageMask(img) {\n  return new Promise((res, rej) => {\n    if (img instanceof HTMLImageElement) {\n      res(img);\n      return;\n    }\n    if (typeof img === 'string') {\n      const image = new Image();\n      image.crossOrigin = 'anonymous';\n      image.src = img;\n      image.onload = () => res(image);\n      image.onerror = () => {\n        console.error(`'image ${img} load failed !!!'`);\n        rej();\n      };\n      return;\n    }\n    rej();\n  });\n}\nexport function normalizeFontSize(fontSize, range) {\n  if (typeof fontSize === 'function') return fontSize;\n  if (Array.isArray(fontSize)) {\n    const [fMin, fMax] = fontSize;\n    if (!range) return () => (fMax + fMin) / 2;\n    const [min, max] = range;\n    if (max === min) return () => (fMax + fMin) / 2;\n    return ({\n      value\n    }) => (fMax - fMin) / (max - min) * (value - min) + fMin;\n  }\n  return () => fontSize;\n}\nexport const WordCloud = options => {\n  return data => __awaiter(void 0, void 0, void 0, function* () {\n    const cloudOptions = Object.assign({}, DEFAULT_OPTIONS, options);\n    const layout = tagCloud();\n    yield flow(layout, cloudOptions).set('fontSize', v => {\n      const arr = data.map(d => d.value);\n      return normalizeFontSize(v, [min(arr), max(arr)]);\n    }).set('font').set('fontStyle').set('fontWeight').set('padding').set('rotate').set('size').set('spiral').set('timeInterval').set('random').set('text').set('on').setAsync('imageMask', processImageMask, layout.createMask);\n    layout.words([...data]);\n    const result = layout.start();\n    const [cw, ch] = cloudOptions.size;\n    const defaultBounds = [{\n      x: 0,\n      y: 0\n    }, {\n      x: cw,\n      y: ch\n    }];\n    const {\n      _bounds: bounds = defaultBounds,\n      _tags,\n      hasImage\n    } = result;\n    const tags = _tags.map(_a => {\n      var {\n          x,\n          y\n        } = _a,\n        rest = __rest(_a, [\"x\", \"y\"]);\n      return Object.assign(Object.assign({}, rest), {\n        x: x + cw / 2,\n        y: y + ch / 2\n      });\n    });\n    // Append two data to replace the corner of top-left and bottom-right, avoid calculate the actual bounds will occur some error.\n    const [{\n      x: tlx,\n      y: tly\n    }, {\n      x: brx,\n      y: bry\n    }] = bounds;\n    const invisibleText = {\n      text: '',\n      value: 0,\n      opacity: 0,\n      fontSize: 0\n    };\n    tags.push(Object.assign(Object.assign({}, invisibleText), {\n      x: hasImage ? 0 : tlx,\n      y: hasImage ? 0 : tly\n    }), Object.assign(Object.assign({}, invisibleText), {\n      x: hasImage ? cw : brx,\n      y: hasImage ? ch : bry\n    }));\n    return tags;\n  });\n};\nWordCloud.props = {};","map":{"version":3,"names":["min","max","tagCloud","flow","DEFAULT_OPTIONS","size","fontSize","processImageMask","img","Promise","res","rej","HTMLImageElement","image","Image","crossOrigin","src","onload","onerror","console","error","normalizeFontSize","range","Array","isArray","fMin","fMax","value","WordCloud","options","data","__awaiter","cloudOptions","Object","assign","layout","set","v","arr","map","d","setAsync","createMask","words","result","start","cw","ch","defaultBounds","x","y","_bounds","bounds","_tags","hasImage","tags","_a","rest","__rest","tlx","tly","brx","bry","invisibleText","text","opacity","push","props"],"sources":["data/wordCloud.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}