{"ast":null,"code":"import { ChartEvent } from '../utils/event';\nexport function dataOf(element, view) {\n  const {\n    __data__: datum\n  } = element;\n  const {\n    markKey,\n    index,\n    seriesIndex\n  } = datum;\n  const {\n    markState\n  } = view;\n  const selectedMark = Array.from(markState.keys()).find(mark => mark.key === markKey);\n  if (!selectedMark) return;\n  if (seriesIndex) {\n    return seriesIndex.map(i => selectedMark.data[i]);\n  }\n  return selectedMark.data[index];\n}\nfunction maybeRoot(node, rootOf) {\n  if (rootOf(node)) return node;\n  let root = node.parent;\n  while (root && !rootOf(root)) root = root.parent;\n  return root;\n}\n// For extended component\nfunction maybeComponentRoot(node) {\n  return maybeRoot(node, node => node.className === 'component');\n}\n// For extended shape.\nfunction maybeElementRoot(node) {\n  return maybeRoot(node, node => node.className === 'element');\n}\n// For extended label.\nfunction maybeLabelRoot(node) {\n  return maybeRoot(node, node => node.className === 'label');\n}\nfunction bubblesEvent(eventType, view, emitter, predicate = event => true) {\n  return e => {\n    if (!predicate(e)) return;\n    // Emit plot events.\n    emitter.emit(`plot:${eventType}`, e);\n    const {\n      target\n    } = e;\n    // There is no target for pointerupoutside event if out of canvas.\n    if (!target) return;\n    const {\n      className\n    } = target;\n    // If target area is plot area, do not emit extra events.\n    if (className === 'plot') return;\n    // If target is element or child of element.\n    const elementRoot = maybeElementRoot(target);\n    // If target is component or child of component.\n    const componentRoot = maybeComponentRoot(target);\n    //  If target is babel or child of babel.\n    const babelRoot = maybeLabelRoot(target);\n    const root = elementRoot || componentRoot || babelRoot;\n    if (!root) return;\n    const {\n      className: elementType,\n      markType\n    } = root;\n    const e1 = Object.assign(Object.assign({}, e), {\n      nativeEvent: true\n    });\n    if (elementType === 'element') {\n      e1['data'] = {\n        data: dataOf(root, view)\n      };\n      emitter.emit(`element:${eventType}`, e1);\n      emitter.emit(`${markType}:${eventType}`, e1);\n    } else if (elementType === 'label') {\n      //label children [Text2, Rect2, Path2],\n      e1['data'] = {\n        data: root.attributes.datum\n      };\n      emitter.emit(`label:${eventType}`, e1);\n      emitter.emit(`${className}:${eventType}`, e1);\n    } else {\n      emitter.emit(`component:${eventType}`, e1);\n      emitter.emit(`${className}:${eventType}`, e1);\n    }\n  };\n}\n// @todo Provide more info for event.dataset.\nexport function Event() {\n  return (context, _, emitter) => {\n    const {\n      container,\n      view\n    } = context;\n    // Click events.\n    const click = bubblesEvent(ChartEvent.CLICK, view, emitter, e => e.detail === 1);\n    const dblclick = bubblesEvent(ChartEvent.DBLCLICK, view, emitter, e => e.detail === 2);\n    // Pointer events.\n    const pointertap = bubblesEvent(ChartEvent.POINTER_TAP, view, emitter);\n    const pointerdown = bubblesEvent(ChartEvent.POINTER_DOWN, view, emitter);\n    const pointerup = bubblesEvent(ChartEvent.POINTER_UP, view, emitter);\n    const pointerover = bubblesEvent(ChartEvent.POINTER_OVER, view, emitter);\n    const pointerout = bubblesEvent(ChartEvent.POINTER_OUT, view, emitter);\n    const pointermove = bubblesEvent(ChartEvent.POINTER_MOVE, view, emitter);\n    const pointerenter = bubblesEvent(ChartEvent.POINTER_ENTER, view, emitter);\n    const pointerleave = bubblesEvent(ChartEvent.POINTER_LEAVE, view, emitter);\n    const pointerupoutside = bubblesEvent(ChartEvent.POINTER_UPOUTSIDE, view, emitter);\n    // Drag and drop events.\n    const dragstart = bubblesEvent(ChartEvent.DRAG_START, view, emitter);\n    const drag = bubblesEvent(ChartEvent.DRAG, view, emitter);\n    const dragend = bubblesEvent(ChartEvent.DRAG_END, view, emitter);\n    const dragenter = bubblesEvent(ChartEvent.DRAG_ENTER, view, emitter);\n    const dragleave = bubblesEvent(ChartEvent.DRAG_LEAVE, view, emitter);\n    const dragover = bubblesEvent(ChartEvent.DRAG_OVER, view, emitter);\n    const drop = bubblesEvent(ChartEvent.DROP, view, emitter);\n    // For legacy usage.\n    container.addEventListener('click', click);\n    container.addEventListener('click', dblclick);\n    // Recommend events.\n    container.addEventListener('pointertap', pointertap);\n    container.addEventListener('pointerdown', pointerdown);\n    container.addEventListener('pointerup', pointerup);\n    container.addEventListener('pointerover', pointerover);\n    container.addEventListener('pointerout', pointerout);\n    container.addEventListener('pointermove', pointermove);\n    container.addEventListener('pointerenter', pointerenter);\n    container.addEventListener('pointerleave', pointerleave);\n    container.addEventListener('pointerupoutside', pointerupoutside);\n    // Plugin events.\n    container.addEventListener('dragstart', dragstart);\n    container.addEventListener('drag', drag);\n    container.addEventListener('dragend', dragend);\n    container.addEventListener('dragenter', dragenter);\n    container.addEventListener('dragleave', dragleave);\n    container.addEventListener('dragover', dragover);\n    container.addEventListener('drop', drop);\n    return () => {\n      container.removeEventListener('click', click);\n      container.removeEventListener('click', dblclick);\n      container.removeEventListener('pointertap', pointertap);\n      container.removeEventListener('pointerdown', pointerdown);\n      container.removeEventListener('pointerup', pointerup);\n      container.removeEventListener('pointerover', pointerover);\n      container.removeEventListener('pointerout', pointerout);\n      container.removeEventListener('pointermove', pointermove);\n      container.removeEventListener('pointerenter', pointerenter);\n      container.removeEventListener('pointerleave', pointerleave);\n      container.removeEventListener('pointerupoutside', pointerupoutside);\n      container.removeEventListener('dragstart', dragstart);\n      container.removeEventListener('drag', drag);\n      container.removeEventListener('dragend', dragend);\n      container.removeEventListener('dragenter', dragenter);\n      container.removeEventListener('dragleave', dragleave);\n      container.removeEventListener('dragover', dragover);\n      container.removeEventListener('drop', drop);\n    };\n  };\n}\nEvent.props = {\n  reapplyWhenUpdate: true\n};","map":{"version":3,"names":["ChartEvent","dataOf","element","view","__data__","datum","markKey","index","seriesIndex","markState","selectedMark","Array","from","keys","find","mark","key","map","i","data","maybeRoot","node","rootOf","root","parent","maybeComponentRoot","className","maybeElementRoot","maybeLabelRoot","bubblesEvent","eventType","emitter","predicate","event","e","emit","target","elementRoot","componentRoot","babelRoot","elementType","markType","e1","Object","assign","nativeEvent","attributes","Event","context","_","container","click","CLICK","detail","dblclick","DBLCLICK","pointertap","POINTER_TAP","pointerdown","POINTER_DOWN","pointerup","POINTER_UP","pointerover","POINTER_OVER","pointerout","POINTER_OUT","pointermove","POINTER_MOVE","pointerenter","POINTER_ENTER","pointerleave","POINTER_LEAVE","pointerupoutside","POINTER_UPOUTSIDE","dragstart","DRAG_START","drag","DRAG","dragend","DRAG_END","dragenter","DRAG_ENTER","dragleave","DRAG_LEAVE","dragover","DRAG_OVER","drop","DROP","addEventListener","removeEventListener","props","reapplyWhenUpdate"],"sources":["interaction/event.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}