{"ast":null,"code":"import { __spreadArray, __read, __assign, __extends } from 'tslib';\nimport { ElementEvent, AABB, CustomEvent, CanvasEvent, Node, Shape, isPattern, GradientType, AbstractRendererPlugin } from '@antv/g-lite';\nimport { isNil, isString } from '@antv/util';\nimport { mat4, vec3 } from 'gl-matrix';\n\n/**\n * support 2 modes in rendering:\n * * immediate\n * * delayed: render at the end of frame with dirty-rectangle\n */\nvar CanvasRendererPlugin = /** @class */function () {\n  function CanvasRendererPlugin(canvasRendererPluginOptions) {\n    this.canvasRendererPluginOptions = canvasRendererPluginOptions;\n    this.removedRBushNodeAABBs = [];\n    this.renderQueue = [];\n    /**\n     * This stack is only used by clipPath for now.\n     */\n    this.restoreStack = [];\n    this.clearFullScreen = false;\n    /**\n     * view projection matrix\n     */\n    this.vpMatrix = mat4.create();\n    this.dprMatrix = mat4.create();\n    this.tmpMat4 = mat4.create();\n    this.vec3a = vec3.create();\n    this.vec3b = vec3.create();\n    this.vec3c = vec3.create();\n    this.vec3d = vec3.create();\n  }\n  CanvasRendererPlugin.prototype.apply = function (context, runtime) {\n    var _this = this;\n    this.context = context;\n    var config = context.config,\n      camera = context.camera,\n      renderingService = context.renderingService,\n      renderingContext = context.renderingContext,\n      rBushRoot = context.rBushRoot,\n      // @ts-ignore\n      pathGeneratorFactory = context.pathGeneratorFactory;\n    this.rBush = rBushRoot;\n    this.pathGeneratorFactory = pathGeneratorFactory;\n    var contextService = context.contextService;\n    var canvas = renderingContext.root.ownerDocument.defaultView;\n    var handleUnmounted = function (e) {\n      var object = e.target;\n      // remove r-bush node\n      // @ts-ignore\n      var rBushNode = object.rBushNode;\n      if (rBushNode.aabb) {\n        // save removed aabbs for dirty-rectangle rendering later\n        _this.removedRBushNodeAABBs.push(rBushNode.aabb);\n      }\n    };\n    var handleCulled = function (e) {\n      var object = e.target;\n      // @ts-ignore\n      var rBushNode = object.rBushNode;\n      if (rBushNode.aabb) {\n        // save removed aabbs for dirty-rectangle rendering later\n        _this.removedRBushNodeAABBs.push(rBushNode.aabb);\n      }\n    };\n    renderingService.hooks.init.tap(CanvasRendererPlugin.tag, function () {\n      canvas.addEventListener(ElementEvent.UNMOUNTED, handleUnmounted);\n      canvas.addEventListener(ElementEvent.CULLED, handleCulled);\n      // clear fullscreen\n      var dpr = contextService.getDPR();\n      var width = config.width,\n        height = config.height;\n      var context = contextService.getContext();\n      _this.clearRect(context, 0, 0, width * dpr, height * dpr, config.background);\n    });\n    renderingService.hooks.destroy.tap(CanvasRendererPlugin.tag, function () {\n      canvas.removeEventListener(ElementEvent.UNMOUNTED, handleUnmounted);\n      canvas.removeEventListener(ElementEvent.CULLED, handleCulled);\n      _this.renderQueue = [];\n      _this.removedRBushNodeAABBs = [];\n      _this.restoreStack = [];\n    });\n    renderingService.hooks.beginFrame.tap(CanvasRendererPlugin.tag, function () {\n      var context = contextService.getContext();\n      var dpr = contextService.getDPR();\n      var width = config.width,\n        height = config.height;\n      var _a = _this.canvasRendererPluginOptions,\n        dirtyObjectNumThreshold = _a.dirtyObjectNumThreshold,\n        dirtyObjectRatioThreshold = _a.dirtyObjectRatioThreshold;\n      // some heuristic conditions such as 80% object changed\n      var _b = renderingService.getStats(),\n        total = _b.total,\n        rendered = _b.rendered;\n      var ratio = rendered / total;\n      _this.clearFullScreen = renderingService.disableDirtyRectangleRendering() || rendered > dirtyObjectNumThreshold && ratio > dirtyObjectRatioThreshold;\n      if (context) {\n        context.resetTransform ? context.resetTransform() : context.setTransform(1, 0, 0, 1, 0, 0);\n        if (_this.clearFullScreen) {\n          _this.clearRect(context, 0, 0, width * dpr, height * dpr, config.background);\n        }\n      }\n    });\n    var renderByZIndex = function (object, context) {\n      if (object.isVisible() && !object.isCulled()) {\n        _this.renderDisplayObject(object, context, _this.context, _this.restoreStack, runtime);\n        // if (object.renderable.) {\n        // if we did a full screen rendering last frame\n        _this.saveDirtyAABB(object);\n        // }\n      }\n      var sorted = object.sortable.sorted || object.childNodes;\n      // should account for z-index\n      sorted.forEach(function (child) {\n        renderByZIndex(child, context);\n      });\n    };\n    // render at the end of frame\n    renderingService.hooks.endFrame.tap(CanvasRendererPlugin.tag, function () {\n      var context = contextService.getContext();\n      // clear & clip dirty rectangle\n      var dpr = contextService.getDPR();\n      mat4.fromScaling(_this.dprMatrix, [dpr, dpr, 1]);\n      mat4.multiply(_this.vpMatrix, _this.dprMatrix, camera.getOrthoMatrix());\n      // if (this.clearFullScreen) {\n      if (_this.clearFullScreen) {\n        // console.log('canvas renderer fcp...');\n        renderByZIndex(renderingContext.root, context);\n      } else {\n        // console.log('canvas renderer next...');\n        // merge removed AABB\n        var dirtyRenderBounds = _this.safeMergeAABB.apply(_this, __spreadArray([_this.mergeDirtyAABBs(_this.renderQueue)], __read(_this.removedRBushNodeAABBs.map(function (_a) {\n          var minX = _a.minX,\n            minY = _a.minY,\n            maxX = _a.maxX,\n            maxY = _a.maxY;\n          var aabb = new AABB();\n          aabb.setMinMax(\n          // vec3.fromValues(minX, minY, 0),\n          // vec3.fromValues(maxX, maxY, 0),\n          [minX, minY, 0], [maxX, maxY, 0]);\n          return aabb;\n        })), false));\n        _this.removedRBushNodeAABBs = [];\n        if (AABB.isEmpty(dirtyRenderBounds)) {\n          _this.renderQueue = [];\n          return;\n        }\n        var dirtyRect = _this.convertAABB2Rect(dirtyRenderBounds);\n        var x = dirtyRect.x,\n          y = dirtyRect.y,\n          width = dirtyRect.width,\n          height = dirtyRect.height;\n        var tl = vec3.transformMat4(_this.vec3a, [x, y, 0], _this.vpMatrix);\n        var tr = vec3.transformMat4(_this.vec3b, [x + width, y, 0], _this.vpMatrix);\n        var bl = vec3.transformMat4(_this.vec3c, [x, y + height, 0], _this.vpMatrix);\n        var br = vec3.transformMat4(_this.vec3d, [x + width, y + height, 0], _this.vpMatrix);\n        var minx = Math.min(tl[0], tr[0], br[0], bl[0]);\n        var miny = Math.min(tl[1], tr[1], br[1], bl[1]);\n        var maxx = Math.max(tl[0], tr[0], br[0], bl[0]);\n        var maxy = Math.max(tl[1], tr[1], br[1], bl[1]);\n        var ix = Math.floor(minx);\n        var iy = Math.floor(miny);\n        var iwidth = Math.ceil(maxx - minx);\n        var iheight = Math.ceil(maxy - miny);\n        context.save();\n        _this.clearRect(context, ix, iy, iwidth, iheight, config.background);\n        context.beginPath();\n        context.rect(ix, iy, iwidth, iheight);\n        context.clip();\n        // @see https://developer.mozilla.org/en-US/docs/Web/API/Canvas_API/Tutorial/Transformations\n        context.setTransform(_this.vpMatrix[0], _this.vpMatrix[1], _this.vpMatrix[4], _this.vpMatrix[5], _this.vpMatrix[12], _this.vpMatrix[13]);\n        // draw dirty rectangle\n        var enableDirtyRectangleRenderingDebug = config.renderer.getConfig().enableDirtyRectangleRenderingDebug;\n        if (enableDirtyRectangleRenderingDebug) {\n          canvas.dispatchEvent(new CustomEvent(CanvasEvent.DIRTY_RECTANGLE, {\n            dirtyRect: {\n              x: ix,\n              y: iy,\n              width: iwidth,\n              height: iheight\n            }\n          }));\n        }\n        // search objects intersect with dirty rectangle\n        var dirtyObjects = _this.searchDirtyObjects(dirtyRenderBounds);\n        // do rendering\n        dirtyObjects\n        // sort by z-index\n        .sort(function (a, b) {\n          return a.sortable.renderOrder - b.sortable.renderOrder;\n        }).forEach(function (object) {\n          // culled object should not be rendered\n          if (object && object.isVisible() && !object.isCulled()) {\n            _this.renderDisplayObject(object, context, _this.context, _this.restoreStack, runtime);\n          }\n        });\n        context.restore();\n        // save dirty AABBs in last frame\n        _this.renderQueue.forEach(function (object) {\n          _this.saveDirtyAABB(object);\n        });\n        // clear queue\n        _this.renderQueue = [];\n      }\n      // pop restore stack, eg. root -> parent -> child\n      _this.restoreStack.forEach(function () {\n        context.restore();\n      });\n      // clear restore stack\n      _this.restoreStack = [];\n    });\n    renderingService.hooks.render.tap(CanvasRendererPlugin.tag, function (object) {\n      if (!_this.clearFullScreen) {\n        // render at the end of frame\n        _this.renderQueue.push(object);\n      }\n    });\n  };\n  CanvasRendererPlugin.prototype.clearRect = function (context, x, y, width, height, background) {\n    // clearRect is faster than fillRect @see https://stackoverflow.com/a/30830253\n    context.clearRect(x, y, width, height);\n    if (background) {\n      context.fillStyle = background;\n      context.fillRect(x, y, width, height);\n    }\n  };\n  CanvasRendererPlugin.prototype.renderDisplayObject = function (object, context, canvasContext, restoreStack, runtime) {\n    var nodeName = object.nodeName;\n    // console.log('canvas render:', object);\n    // restore to its ancestor\n    var parent = restoreStack[restoreStack.length - 1];\n    if (parent && !(object.compareDocumentPosition(parent) & Node.DOCUMENT_POSITION_CONTAINS)) {\n      context.restore();\n      restoreStack.pop();\n    }\n    // @ts-ignore\n    var styleRenderer = this.context.styleRendererFactory[nodeName];\n    var generatePath = this.pathGeneratorFactory[nodeName];\n    // clip path\n    var clipPath = object.parsedStyle.clipPath;\n    if (clipPath) {\n      this.applyWorldTransform(context, clipPath);\n      // generate path in local space\n      var generatePath_1 = this.pathGeneratorFactory[clipPath.nodeName];\n      if (generatePath_1) {\n        context.save();\n        // save clip\n        restoreStack.push(object);\n        context.beginPath();\n        generatePath_1(context, clipPath.parsedStyle);\n        context.closePath();\n        context.clip();\n      }\n    }\n    // fill & stroke\n    if (styleRenderer) {\n      this.applyWorldTransform(context, object);\n      context.save();\n      // apply attributes to context\n      this.applyAttributesToContext(context, object);\n    }\n    if (generatePath) {\n      context.beginPath();\n      generatePath(context, object.parsedStyle);\n      if (object.nodeName !== Shape.LINE && object.nodeName !== Shape.PATH && object.nodeName !== Shape.POLYLINE) {\n        context.closePath();\n      }\n    }\n    // fill & stroke\n    if (styleRenderer) {\n      styleRenderer.render(context, object.parsedStyle, object, canvasContext, this, runtime);\n      // restore applied attributes, eg. shadowBlur shadowColor...\n      context.restore();\n    }\n    // finish rendering, clear dirty flag\n    object.renderable.dirty = false;\n  };\n  CanvasRendererPlugin.prototype.convertAABB2Rect = function (aabb) {\n    var min = aabb.getMin();\n    var max = aabb.getMax();\n    // expand the rectangle a bit to avoid artifacts\n    // @see https://www.yuque.com/antv/ou292n/bi8nix#ExvCu\n    var minX = Math.floor(min[0]);\n    var minY = Math.floor(min[1]);\n    var maxX = Math.ceil(max[0]);\n    var maxY = Math.ceil(max[1]);\n    var width = maxX - minX;\n    var height = maxY - minY;\n    return {\n      x: minX,\n      y: minY,\n      width: width,\n      height: height\n    };\n  };\n  /**\n   * TODO: merge dirty rectangles with some strategies.\n   * For now, we just simply merge all the rectangles into one.\n   * @see https://idom.me/articles/841.html\n   */\n  CanvasRendererPlugin.prototype.mergeDirtyAABBs = function (dirtyObjects) {\n    // merge into a big AABB\n    // TODO: skip descendant if ancestor is caculated, but compareNodePosition is really slow\n    var aabb = new AABB();\n    dirtyObjects.forEach(function (object) {\n      var renderBounds = object.getRenderBounds();\n      aabb.add(renderBounds);\n      var dirtyRenderBounds = object.renderable.dirtyRenderBounds;\n      if (dirtyRenderBounds) {\n        aabb.add(dirtyRenderBounds);\n      }\n    });\n    return aabb;\n  };\n  CanvasRendererPlugin.prototype.searchDirtyObjects = function (dirtyRectangle) {\n    // search in r-tree, get all affected nodes\n    var _a = __read(dirtyRectangle.getMin(), 2),\n      minX = _a[0],\n      minY = _a[1];\n    var _b = __read(dirtyRectangle.getMax(), 2),\n      maxX = _b[0],\n      maxY = _b[1];\n    var rBushNodes = this.rBush.search({\n      minX: minX,\n      minY: minY,\n      maxX: maxX,\n      maxY: maxY\n    });\n    return rBushNodes.map(function (_a) {\n      var displayObject = _a.displayObject;\n      return displayObject;\n    });\n  };\n  CanvasRendererPlugin.prototype.saveDirtyAABB = function (object) {\n    var renderable = object.renderable;\n    if (!renderable.dirtyRenderBounds) {\n      renderable.dirtyRenderBounds = new AABB();\n    }\n    var renderBounds = object.getRenderBounds();\n    if (renderBounds) {\n      // save last dirty aabb\n      renderable.dirtyRenderBounds.update(renderBounds.center, renderBounds.halfExtents);\n    }\n  };\n  /**\n   * TODO: batch the same global attributes\n   */\n  CanvasRendererPlugin.prototype.applyAttributesToContext = function (context, object) {\n    var _a = object.parsedStyle,\n      stroke = _a.stroke,\n      fill = _a.fill,\n      opacity = _a.opacity,\n      lineDash = _a.lineDash,\n      lineDashOffset = _a.lineDashOffset;\n    // @see https://developer.mozilla.org/zh-CN/docs/Web/API/CanvasRenderingContext2D/setLineDash\n    if (lineDash) {\n      context.setLineDash(lineDash);\n    }\n    // @see https://developer.mozilla.org/zh-CN/docs/Web/API/CanvasRenderingContext2D/lineDashOffset\n    if (!isNil(lineDashOffset)) {\n      context.lineDashOffset = lineDashOffset;\n    }\n    if (!isNil(opacity)) {\n      context.globalAlpha *= opacity;\n    }\n    if (!isNil(stroke) && !Array.isArray(stroke) && !stroke.isNone) {\n      context.strokeStyle = object.attributes.stroke;\n    }\n    if (!isNil(fill) && !Array.isArray(fill) && !fill.isNone) {\n      context.fillStyle = object.attributes.fill;\n    }\n  };\n  CanvasRendererPlugin.prototype.applyWorldTransform = function (context, object, matrix) {\n    var tx = 0;\n    var ty = 0;\n    var anchor = (object.parsedStyle || {}).anchor;\n    var anchorX = anchor && anchor[0] || 0;\n    var anchorY = anchor && anchor[1] || 0;\n    if (anchorX !== 0 || anchorY !== 0) {\n      // const bounds = object.getGeometryBounds();\n      var bounds = object.geometry.contentBounds;\n      var width = bounds && bounds.halfExtents[0] * 2 || 0;\n      var height = bounds && bounds.halfExtents[1] * 2 || 0;\n      tx = -(anchorX * width);\n      ty = -(anchorY * height);\n    }\n    // apply clip shape's RTS\n    if (matrix) {\n      mat4.copy(this.tmpMat4, object.getLocalTransform());\n      this.vec3a[0] = tx;\n      this.vec3a[1] = ty;\n      this.vec3a[2] = 0;\n      mat4.translate(this.tmpMat4, this.tmpMat4, this.vec3a);\n      mat4.multiply(this.tmpMat4, matrix, this.tmpMat4);\n      mat4.multiply(this.tmpMat4, this.vpMatrix, this.tmpMat4);\n    } else {\n      // apply RTS transformation in world space\n      mat4.copy(this.tmpMat4, object.getWorldTransform());\n      this.vec3a[0] = tx;\n      this.vec3a[1] = ty;\n      this.vec3a[2] = 0;\n      mat4.translate(this.tmpMat4, this.tmpMat4, this.vec3a);\n      mat4.multiply(this.tmpMat4, this.vpMatrix, this.tmpMat4);\n    }\n    // @see https://developer.mozilla.org/en-US/docs/Web/API/Canvas_API/Tutorial/Transformations\n    context.setTransform(this.tmpMat4[0], this.tmpMat4[1], this.tmpMat4[4], this.tmpMat4[5], this.tmpMat4[12], this.tmpMat4[13]);\n  };\n  CanvasRendererPlugin.prototype.safeMergeAABB = function () {\n    var aabbs = [];\n    for (var _i = 0; _i < arguments.length; _i++) {\n      aabbs[_i] = arguments[_i];\n    }\n    var merged = new AABB();\n    aabbs.forEach(function (aabb) {\n      merged.add(aabb);\n    });\n    return merged;\n  };\n  CanvasRendererPlugin.tag = 'CanvasRenderer';\n  return CanvasRendererPlugin;\n}();\nvar DefaultRenderer = /** @class */function () {\n  function DefaultRenderer(imagePool) {\n    this.imagePool = imagePool;\n  }\n  DefaultRenderer.prototype.render = function (context, parsedStyle, object, canvasContext, plugin, runtime) {\n    var fill = parsedStyle.fill,\n      fillRule = parsedStyle.fillRule,\n      opacity = parsedStyle.opacity,\n      fillOpacity = parsedStyle.fillOpacity,\n      stroke = parsedStyle.stroke,\n      strokeOpacity = parsedStyle.strokeOpacity,\n      lineWidth = parsedStyle.lineWidth,\n      lineCap = parsedStyle.lineCap,\n      lineJoin = parsedStyle.lineJoin,\n      shadowType = parsedStyle.shadowType,\n      shadowColor = parsedStyle.shadowColor,\n      shadowBlur = parsedStyle.shadowBlur,\n      filter = parsedStyle.filter,\n      miterLimit = parsedStyle.miterLimit;\n    var hasFill = !isNil(fill) && !fill.isNone;\n    var hasStroke = !isNil(stroke) && !stroke.isNone && lineWidth > 0;\n    var isFillTransparent = fill.alpha === 0;\n    var hasFilter = !!(filter && filter.length);\n    var hasShadow = !isNil(shadowColor) && shadowBlur > 0;\n    var nodeName = object.nodeName;\n    var isInnerShadow = shadowType === 'inner';\n    var shouldDrawShadowWithStroke = hasStroke && hasShadow && (nodeName === Shape.PATH || nodeName === Shape.LINE || nodeName === Shape.POLYLINE || isFillTransparent || isInnerShadow);\n    if (hasFill) {\n      context.globalAlpha = opacity * fillOpacity;\n      if (!shouldDrawShadowWithStroke) {\n        setShadowAndFilter(object, context, hasShadow);\n      }\n      this.fill(context, object, fill, fillRule, canvasContext, plugin, runtime);\n      if (!shouldDrawShadowWithStroke) {\n        this.clearShadowAndFilter(context, hasFilter, hasShadow);\n      }\n    }\n    if (hasStroke) {\n      context.globalAlpha = opacity * strokeOpacity;\n      context.lineWidth = lineWidth;\n      if (!isNil(miterLimit)) {\n        context.miterLimit = miterLimit;\n      }\n      if (!isNil(lineCap)) {\n        context.lineCap = lineCap;\n      }\n      if (!isNil(lineJoin)) {\n        context.lineJoin = lineJoin;\n      }\n      if (shouldDrawShadowWithStroke) {\n        if (isInnerShadow) {\n          context.globalCompositeOperation = 'source-atop';\n        }\n        setShadowAndFilter(object, context, true);\n        if (isInnerShadow) {\n          this.stroke(context, object, stroke, canvasContext, plugin, runtime);\n          context.globalCompositeOperation = 'source-over';\n          this.clearShadowAndFilter(context, hasFilter, true);\n        }\n      }\n      this.stroke(context, object, stroke, canvasContext, plugin, runtime);\n    }\n  };\n  DefaultRenderer.prototype.clearShadowAndFilter = function (context, hasFilter, hasShadow) {\n    if (hasShadow) {\n      context.shadowColor = 'transparent';\n      context.shadowBlur = 0;\n    }\n    if (hasFilter) {\n      // save drop-shadow filter\n      var oldFilter = context.filter;\n      if (!isNil(oldFilter) && oldFilter.indexOf('drop-shadow') > -1) {\n        context.filter = oldFilter.replace(/drop-shadow\\([^)]*\\)/, '').trim() || 'none';\n      }\n    }\n  };\n  DefaultRenderer.prototype.fill = function (context, object, fill, fillRule, canvasContext, plugin, runtime) {\n    var _this = this;\n    if (Array.isArray(fill)) {\n      fill.forEach(function (gradient) {\n        context.fillStyle = _this.getColor(gradient, object, context);\n        fillRule ? context.fill(fillRule) : context.fill();\n      });\n    } else {\n      if (isPattern(fill)) {\n        context.fillStyle = this.getPattern(fill, object, context, canvasContext, plugin, runtime);\n      }\n      fillRule ? context.fill(fillRule) : context.fill();\n    }\n  };\n  DefaultRenderer.prototype.stroke = function (context, object, stroke, canvasContext, plugin, runtime) {\n    var _this = this;\n    if (Array.isArray(stroke)) {\n      stroke.forEach(function (gradient) {\n        context.strokeStyle = _this.getColor(gradient, object, context);\n        context.stroke();\n      });\n    } else {\n      if (isPattern(stroke)) {\n        context.strokeStyle = this.getPattern(stroke, object, context, canvasContext, plugin, runtime);\n      }\n      context.stroke();\n    }\n  };\n  DefaultRenderer.prototype.getPattern = function (pattern, object, context, canvasContext, plugin, runtime) {\n    var $offscreenCanvas;\n    var dpr;\n    if (pattern.image.nodeName === 'rect') {\n      var _a = pattern.image.parsedStyle,\n        width = _a.width,\n        height = _a.height;\n      dpr = canvasContext.contextService.getDPR();\n      var offscreenCanvas = canvasContext.config.offscreenCanvas;\n      $offscreenCanvas = runtime.offscreenCanvasCreator.getOrCreateCanvas(offscreenCanvas);\n      $offscreenCanvas.width = width * dpr;\n      $offscreenCanvas.height = height * dpr;\n      var offscreenCanvasContext_1 = runtime.offscreenCanvasCreator.getOrCreateContext(offscreenCanvas);\n      var restoreStack_1 = [];\n      // offscreenCanvasContext.scale(1 / dpr, 1 / dpr);\n      pattern.image.forEach(function (object) {\n        plugin.renderDisplayObject(object, offscreenCanvasContext_1, canvasContext, restoreStack_1, runtime);\n      });\n      restoreStack_1.forEach(function () {\n        offscreenCanvasContext_1.restore();\n      });\n    }\n    var canvasPattern = this.imagePool.getOrCreatePatternSync(pattern, context, $offscreenCanvas, dpr, function () {\n      // set dirty rectangle flag\n      object.renderable.dirty = true;\n      canvasContext.renderingService.dirtify();\n    });\n    return canvasPattern;\n  };\n  DefaultRenderer.prototype.getColor = function (parsedColor, object, context) {\n    var color;\n    if (parsedColor.type === GradientType.LinearGradient || parsedColor.type === GradientType.RadialGradient) {\n      var bounds = object.getGeometryBounds();\n      var width = bounds && bounds.halfExtents[0] * 2 || 1;\n      var height = bounds && bounds.halfExtents[1] * 2 || 1;\n      color = this.imagePool.getOrCreateGradient(__assign(__assign({\n        type: parsedColor.type\n      }, parsedColor.value), {\n        width: width,\n        height: height\n      }), context);\n    }\n    return color;\n  };\n  return DefaultRenderer;\n}();\n/**\n * apply before fill and stroke but only once\n */\nfunction setShadowAndFilter(object, context, hasShadow) {\n  var _a = object.parsedStyle,\n    filter = _a.filter,\n    shadowColor = _a.shadowColor,\n    shadowBlur = _a.shadowBlur,\n    shadowOffsetX = _a.shadowOffsetX,\n    shadowOffsetY = _a.shadowOffsetY;\n  if (filter && filter.length) {\n    // use raw filter string\n    context.filter = object.style.filter;\n  }\n  if (hasShadow) {\n    context.shadowColor = shadowColor.toString();\n    context.shadowBlur = shadowBlur || 0;\n    context.shadowOffsetX = shadowOffsetX || 0;\n    context.shadowOffsetY = shadowOffsetY || 0;\n  }\n}\nvar ImageRenderer = /** @class */function () {\n  function ImageRenderer(imagePool) {\n    this.imagePool = imagePool;\n  }\n  ImageRenderer.prototype.render = function (context, parsedStyle, object) {\n    var width = parsedStyle.width,\n      height = parsedStyle.height,\n      img = parsedStyle.img,\n      shadowColor = parsedStyle.shadowColor,\n      shadowBlur = parsedStyle.shadowBlur;\n    var image;\n    var iw = width;\n    var ih = height;\n    if (isString(img)) {\n      // image has been loaded in `mounted` hook\n      image = this.imagePool.getImageSync(img);\n    } else {\n      iw || (iw = img.width);\n      ih || (ih = img.height);\n      image = img;\n    }\n    if (image) {\n      var hasShadow = !isNil(shadowColor) && shadowBlur > 0;\n      setShadowAndFilter(object, context, hasShadow);\n      // node-canvas will throw the following err:\n      // Error: Image given has not completed loading\n      try {\n        context.drawImage(image, 0, 0, iw, ih);\n      } catch (e) {}\n    }\n  };\n  return ImageRenderer;\n}();\nvar TextRenderer = /** @class */function () {\n  function TextRenderer() {}\n  TextRenderer.prototype.render = function (context, parsedStyle, object, canvasContext, plugin, runtime) {\n    var _a = parsedStyle,\n      lineWidth = _a.lineWidth,\n      textAlign = _a.textAlign,\n      textBaseline = _a.textBaseline,\n      lineJoin = _a.lineJoin,\n      miterLimit = _a.miterLimit,\n      letterSpacing = _a.letterSpacing,\n      stroke = _a.stroke,\n      fill = _a.fill,\n      fillOpacity = _a.fillOpacity,\n      strokeOpacity = _a.strokeOpacity,\n      opacity = _a.opacity,\n      metrics = _a.metrics,\n      dx = _a.dx,\n      dy = _a.dy,\n      shadowColor = _a.shadowColor,\n      shadowBlur = _a.shadowBlur;\n    var font = metrics.font,\n      lines = metrics.lines,\n      height = metrics.height,\n      lineHeight = metrics.lineHeight,\n      lineMetrics = metrics.lineMetrics;\n    context.font = font;\n    context.lineWidth = lineWidth;\n    context.textAlign = textAlign === 'middle' ? 'center' : textAlign;\n    var formattedTextBaseline = textBaseline;\n    if (\n    // formattedTextBaseline === 'bottom' ||\n    !runtime.enableCSSParsing && formattedTextBaseline === 'alphabetic') {\n      formattedTextBaseline = 'bottom';\n    }\n    context.lineJoin = lineJoin;\n    if (!isNil(miterLimit)) {\n      context.miterLimit = miterLimit;\n    }\n    var linePositionY = 0;\n    // handle vertical text baseline\n    if (textBaseline === 'middle') {\n      linePositionY = -height / 2 - lineHeight / 2;\n    } else if (textBaseline === 'bottom' || textBaseline === 'alphabetic' || textBaseline === 'ideographic') {\n      linePositionY = -height;\n    } else if (textBaseline === 'top' || textBaseline === 'hanging') {\n      linePositionY = -lineHeight;\n    }\n    // account for dx & dy\n    var offsetX = dx || 0;\n    linePositionY += dy || 0;\n    if (lines.length === 1) {\n      if (formattedTextBaseline === 'bottom') {\n        formattedTextBaseline = 'middle';\n        linePositionY -= 0.5 * height;\n      } else if (formattedTextBaseline === 'top') {\n        formattedTextBaseline = 'middle';\n        linePositionY += 0.5 * height;\n      }\n    }\n    context.textBaseline = formattedTextBaseline;\n    var hasShadow = !isNil(shadowColor) && shadowBlur > 0;\n    setShadowAndFilter(object, context, hasShadow);\n    // draw lines line by line\n    for (var i = 0; i < lines.length; i++) {\n      var linePositionX = lineWidth / 2 + offsetX;\n      linePositionY += lineHeight;\n      // no need to re-position X, cause we already set text align\n      // @see https://developer.mozilla.org/en-US/docs/Web/API/CanvasRenderingContext2D/textAlign\n      if (!isNil(stroke) && !stroke.isNone && lineWidth) {\n        this.drawLetterSpacing(context, lines[i], lineMetrics[i], textAlign, linePositionX, linePositionY, letterSpacing, fillOpacity, strokeOpacity, opacity, true);\n      }\n      if (!isNil(fill)) {\n        this.drawLetterSpacing(context, lines[i], lineMetrics[i], textAlign, linePositionX, linePositionY, letterSpacing, fillOpacity, strokeOpacity, opacity);\n      }\n    }\n  };\n  TextRenderer.prototype.drawLetterSpacing = function (context, text, lineMetrics, textAlign, x, y, letterSpacing, fillOpacity, strokeOpacity, opacity, isStroke) {\n    if (isStroke === void 0) {\n      isStroke = false;\n    }\n    // letterSpacing of 0 means normal, render all texts directly\n    if (letterSpacing === 0) {\n      if (isStroke) {\n        this.strokeText(context, text, x, y, strokeOpacity);\n      } else {\n        this.fillText(context, text, x, y, fillOpacity, opacity);\n      }\n      return;\n    }\n    // draw text using left align\n    var currentTextAlign = context.textAlign;\n    context.textAlign = 'left';\n    var currentPosition = x;\n    if (textAlign === 'center' || textAlign === 'middle') {\n      currentPosition = x - lineMetrics.width / 2;\n    } else if (textAlign === 'right' || textAlign === 'end') {\n      currentPosition = x - lineMetrics.width;\n    }\n    var stringArray = Array.from(text);\n    var previousWidth = context.measureText(text).width;\n    var currentWidth = 0;\n    for (var i = 0; i < stringArray.length; ++i) {\n      var currentChar = stringArray[i];\n      if (isStroke) {\n        this.strokeText(context, currentChar, currentPosition, y, strokeOpacity);\n      } else {\n        this.fillText(context, currentChar, currentPosition, y, fillOpacity, opacity);\n      }\n      currentWidth = context.measureText(text.substring(i + 1)).width;\n      currentPosition += previousWidth - currentWidth + letterSpacing;\n      previousWidth = currentWidth;\n    }\n    context.textAlign = currentTextAlign;\n  };\n  TextRenderer.prototype.fillText = function (context, text, x, y, fillOpacity, opacity) {\n    var currentGlobalAlpha;\n    var applyOpacity = !isNil(fillOpacity) && fillOpacity !== 1;\n    if (applyOpacity) {\n      currentGlobalAlpha = context.globalAlpha;\n      context.globalAlpha = fillOpacity * opacity;\n    }\n    context.fillText(text, x, y);\n    if (applyOpacity) {\n      context.globalAlpha = currentGlobalAlpha;\n    }\n  };\n  TextRenderer.prototype.strokeText = function (context, text, x, y, strokeOpacity) {\n    var currentGlobalAlpha;\n    var applyOpacity = !isNil(strokeOpacity) && strokeOpacity !== 1;\n    if (applyOpacity) {\n      currentGlobalAlpha = context.globalAlpha;\n      context.globalAlpha = strokeOpacity;\n    }\n    context.strokeText(text, x, y);\n    if (applyOpacity) {\n      context.globalAlpha = currentGlobalAlpha;\n    }\n  };\n  return TextRenderer;\n}();\nvar RectRenderer = /** @class */function (_super) {\n  __extends(RectRenderer, _super);\n  function RectRenderer() {\n    return _super !== null && _super.apply(this, arguments) || this;\n  }\n  return RectRenderer;\n}(DefaultRenderer);\nvar CircleRenderer = /** @class */function (_super) {\n  __extends(CircleRenderer, _super);\n  function CircleRenderer() {\n    return _super !== null && _super.apply(this, arguments) || this;\n  }\n  return CircleRenderer;\n}(DefaultRenderer);\nvar EllipseRenderer = /** @class */function (_super) {\n  __extends(EllipseRenderer, _super);\n  function EllipseRenderer() {\n    return _super !== null && _super.apply(this, arguments) || this;\n  }\n  return EllipseRenderer;\n}(DefaultRenderer);\nvar LineRenderer = /** @class */function (_super) {\n  __extends(LineRenderer, _super);\n  function LineRenderer() {\n    return _super !== null && _super.apply(this, arguments) || this;\n  }\n  return LineRenderer;\n}(DefaultRenderer);\nvar PolylineRenderer = /** @class */function (_super) {\n  __extends(PolylineRenderer, _super);\n  function PolylineRenderer() {\n    return _super !== null && _super.apply(this, arguments) || this;\n  }\n  return PolylineRenderer;\n}(DefaultRenderer);\nvar PolygonRenderer = /** @class */function (_super) {\n  __extends(PolygonRenderer, _super);\n  function PolygonRenderer() {\n    return _super !== null && _super.apply(this, arguments) || this;\n  }\n  return PolygonRenderer;\n}(DefaultRenderer);\nvar PathRenderer = /** @class */function (_super) {\n  __extends(PathRenderer, _super);\n  function PathRenderer() {\n    return _super !== null && _super.apply(this, arguments) || this;\n  }\n  return PathRenderer;\n}(DefaultRenderer);\nvar Plugin = /** @class */function (_super) {\n  __extends(Plugin, _super);\n  function Plugin(options) {\n    if (options === void 0) {\n      options = {};\n    }\n    var _this = _super.call(this) || this;\n    _this.options = options;\n    _this.name = 'canvas-renderer';\n    return _this;\n  }\n  Plugin.prototype.init = function () {\n    var _a;\n    var canvasRendererPluginOptions = __assign({\n      dirtyObjectNumThreshold: 500,\n      dirtyObjectRatioThreshold: 0.8\n    }, this.options);\n    // @ts-ignore\n    var imagePool = this.context.imagePool;\n    var defaultRenderer = new DefaultRenderer(imagePool);\n    var defaultStyleRendererFactory = (_a = {}, _a[Shape.CIRCLE] = defaultRenderer, _a[Shape.ELLIPSE] = defaultRenderer, _a[Shape.RECT] = defaultRenderer, _a[Shape.IMAGE] = new ImageRenderer(imagePool), _a[Shape.TEXT] = new TextRenderer(), _a[Shape.LINE] = defaultRenderer, _a[Shape.POLYLINE] = defaultRenderer, _a[Shape.POLYGON] = defaultRenderer, _a[Shape.PATH] = defaultRenderer, _a[Shape.GROUP] = undefined, _a[Shape.HTML] = undefined, _a[Shape.MESH] = undefined, _a);\n    this.context.defaultStyleRendererFactory = defaultStyleRendererFactory;\n    this.context.styleRendererFactory = defaultStyleRendererFactory;\n    this.addRenderingPlugin(new CanvasRendererPlugin(canvasRendererPluginOptions));\n  };\n  Plugin.prototype.destroy = function () {\n    this.removeAllRenderingPlugins();\n    delete this.context.defaultStyleRendererFactory;\n    delete this.context.styleRendererFactory;\n  };\n  return Plugin;\n}(AbstractRendererPlugin);\nexport { CircleRenderer, EllipseRenderer, ImageRenderer, LineRenderer, PathRenderer, Plugin, PolygonRenderer, PolylineRenderer, RectRenderer, TextRenderer };","map":{"version":3,"names":["CanvasRendererPlugin","canvasRendererPluginOptions","removedRBushNodeAABBs","renderQueue","restoreStack","clearFullScreen","vpMatrix","mat4","create","dprMatrix","tmpMat4","vec3a","vec3","vec3b","vec3c","vec3d","prototype","apply","context","runtime","_this","config","camera","renderingService","renderingContext","rBushRoot","pathGeneratorFactory","rBush","contextService","canvas","root","ownerDocument","defaultView","handleUnmounted","e","object","target","rBushNode","aabb","push","handleCulled","hooks","init","tap","tag","addEventListener","ElementEvent","UNMOUNTED","CULLED","dpr","getDPR","width","height","getContext","clearRect","background","destroy","removeEventListener","beginFrame","_a","dirtyObjectNumThreshold","dirtyObjectRatioThreshold","_b","getStats","total","rendered","ratio","disableDirtyRectangleRendering","resetTransform","setTransform","renderByZIndex","isVisible","isCulled","renderDisplayObject","saveDirtyAABB","sorted","sortable","childNodes","forEach","child","endFrame","fromScaling","multiply","getOrthoMatrix","dirtyRenderBounds","safeMergeAABB","__spreadArray","mergeDirtyAABBs","__read","map","minX","minY","maxX","maxY","AABB","setMinMax","isEmpty","dirtyRect","convertAABB2Rect","x","y","tl","transformMat4","tr","bl","br","minx","Math","min","miny","maxx","max","maxy","ix","floor","iy","iwidth","ceil","iheight","save","beginPath","rect","clip","enableDirtyRectangleRenderingDebug","renderer","getConfig","dispatchEvent","CustomEvent","CanvasEvent","DIRTY_RECTANGLE","dirtyObjects","searchDirtyObjects","sort","a","b","renderOrder","restore","render","fillStyle","fillRect","canvasContext","nodeName","parent","length","compareDocumentPosition","Node","DOCUMENT_POSITION_CONTAINS","pop","styleRenderer","styleRendererFactory","generatePath","clipPath","parsedStyle","applyWorldTransform","generatePath_1","closePath","applyAttributesToContext","Shape","LINE","PATH","POLYLINE","renderable","dirty","getMin","getMax","renderBounds","getRenderBounds","add","dirtyRectangle","rBushNodes","search","displayObject","update","center","halfExtents","stroke","fill","opacity","lineDash","lineDashOffset","setLineDash","isNil","globalAlpha","Array","isArray","isNone","strokeStyle","attributes","matrix","tx","ty","anchor","anchorX","anchorY","bounds","geometry","contentBounds","copy","getLocalTransform","translate","getWorldTransform","aabbs","_i","arguments","merged","DefaultRenderer","imagePool","plugin","fillRule","fillOpacity","strokeOpacity","lineWidth","lineCap","lineJoin","shadowType","shadowColor","shadowBlur","filter","miterLimit","hasFill","hasStroke","isFillTransparent","alpha","hasFilter","hasShadow","isInnerShadow","shouldDrawShadowWithStroke","setShadowAndFilter","clearShadowAndFilter","globalCompositeOperation","oldFilter","indexOf","replace","trim","gradient","getColor","isPattern","getPattern","pattern","$offscreenCanvas","image","offscreenCanvas","offscreenCanvasCreator","getOrCreateCanvas","offscreenCanvasContext_1","getOrCreateContext","restoreStack_1","canvasPattern","getOrCreatePatternSync","dirtify","parsedColor","color","type","GradientType","LinearGradient","RadialGradient","getGeometryBounds","getOrCreateGradient","__assign","value","shadowOffsetX","shadowOffsetY","style","toString","ImageRenderer","img","iw","ih","isString","getImageSync","drawImage","TextRenderer","textAlign","textBaseline","letterSpacing","metrics","dx","dy","font","lines","lineHeight","lineMetrics","formattedTextBaseline","enableCSSParsing","linePositionY","offsetX","i","linePositionX","drawLetterSpacing","text","isStroke","strokeText","fillText","currentTextAlign","currentPosition","stringArray","from","previousWidth","measureText","currentWidth","currentChar","substring","currentGlobalAlpha","applyOpacity","RectRenderer","_super","__extends","CircleRenderer","EllipseRenderer","LineRenderer","PolylineRenderer","PolygonRenderer","PathRenderer","Plugin","options","call","name","defaultRenderer","defaultStyleRendererFactory","CIRCLE","ELLIPSE","RECT","IMAGE","TEXT","POLYGON","GROUP","undefined","HTML","MESH","addRenderingPlugin","removeAllRenderingPlugins","AbstractRendererPlugin"],"sources":["../src/packages/g-plugin-canvas-renderer/src/CanvasRendererPlugin.ts","../src/packages/g-plugin-canvas-renderer/src/shapes/styles/Default.ts","../src/packages/g-plugin-canvas-renderer/src/shapes/styles/Image.ts","../src/packages/g-plugin-canvas-renderer/src/shapes/styles/Text.ts","../src/packages/g-plugin-canvas-renderer/src/shapes/styles/Rect.ts","../src/packages/g-plugin-canvas-renderer/src/shapes/styles/Circle.ts","../src/packages/g-plugin-canvas-renderer/src/shapes/styles/Ellipse.ts","../src/packages/g-plugin-canvas-renderer/src/shapes/styles/Line.ts","../src/packages/g-plugin-canvas-renderer/src/shapes/styles/Polyline.ts","../src/packages/g-plugin-canvas-renderer/src/shapes/styles/Polygon.ts","../src/packages/g-plugin-canvas-renderer/src/shapes/styles/Path.ts","../src/packages/g-plugin-canvas-renderer/src/index.ts"],"sourcesContent":[null,null,null,null,null,null,null,null,null,null,null,null],"mappings":";;;;;AAiCA;;;;AAIG;AACH,IAAAA,oBAAA;EAYE,SAAAA,qBACUC,2BAAwD;IAAxD,IAA2B,CAAAA,2BAAA,GAA3BA,2BAA2B;IAG7B,IAAqB,CAAAC,qBAAA,GAAoB,EAAE;IAE3C,IAAW,CAAAC,WAAA,GAAoB,EAAE;IAEzC;;AAEG;IACK,IAAY,CAAAC,YAAA,GAAoB,EAAE;IAElC,IAAe,CAAAC,eAAA,GAAG,KAAK;IAE/B;;AAEG;IACK,KAAAC,QAAQ,GAAGC,IAAI,CAACC,MAAM,EAAE;IACxB,KAAAC,SAAS,GAAGF,IAAI,CAACC,MAAM,EAAE;IACzB,KAAAE,OAAO,GAAGH,IAAI,CAACC,MAAM,EAAE;IACvB,KAAAG,KAAK,GAAGC,IAAI,CAACJ,MAAM,EAAE;IACrB,KAAAK,KAAK,GAAGD,IAAI,CAACJ,MAAM,EAAE;IACrB,KAAAM,KAAK,GAAGF,IAAI,CAACJ,MAAM,EAAE;IACrB,KAAAO,KAAK,GAAGH,IAAI,CAACJ,MAAM,EAAE;;EAE7BR,oBAAA,CAAAgB,SAAA,CAAAC,KAAK,GAAL,UAAMC,OAA+B,EAAEC,OAAsB;IAA7D,IAkRCC,KAAA;IAjRC,IAAI,CAACF,OAAO,GAAGA,OAAO;IAGpB,IAAAG,MAAM,GAOJH,OAAO,CAAAG,MAPH;MACNC,MAAM,GAMJJ,OAAO,CAAAI,MANH;MACNC,gBAAgB,GAKdL,OAAO,CAAAK,gBALO;MAChBC,gBAAgB,GAIdN,OAAO,CAAAM,gBAJO;MAChBC,SAAS,GAGPP,OAAO,CAHAO,SAAA;;MAETC,oBAAoB,GAClBR,OAAO,CAAAQ,oBADW;IAEtB,IAAI,CAACC,KAAK,GAAGF,SAAS;IACtB,IAAI,CAACC,oBAAoB,GAAGA,oBAAoB;IAChD,IAAME,cAAc,GAClBV,OAAO,CAACU,cAA0D;IAEpE,IAAMC,MAAM,GAAGL,gBAAgB,CAACM,IAAI,CAACC,aAAa,CAACC,WAAW;IAE9D,IAAMC,eAAe,GAAG,SAAAA,CAACC,CAAiB;MACxC,IAAMC,MAAM,GAAGD,CAAC,CAACE,MAAuB;;;MAIxC,IAAMC,SAAS,GAAGF,MAAM,CAACE,SAAS;MAElC,IAAIA,SAAS,CAACC,IAAI,EAAE;;QAElBlB,KAAI,CAAClB,qBAAqB,CAACqC,IAAI,CAACF,SAAS,CAACC,IAAI,CAAC;;IAEnD,CAAC;IAED,IAAME,YAAY,GAAG,SAAAA,CAACN,CAAiB;MACrC,IAAMC,MAAM,GAAGD,CAAC,CAACE,MAAuB;;MAExC,IAAMC,SAAS,GAAGF,MAAM,CAACE,SAAS;MAElC,IAAIA,SAAS,CAACC,IAAI,EAAE;;QAElBlB,KAAI,CAAClB,qBAAqB,CAACqC,IAAI,CAACF,SAAS,CAACC,IAAI,CAAC;;IAEnD,CAAC;IAEDf,gBAAgB,CAACkB,KAAK,CAACC,IAAI,CAACC,GAAG,CAAC3C,oBAAoB,CAAC4C,GAAG,EAAE;MACxDf,MAAM,CAACgB,gBAAgB,CAACC,YAAY,CAACC,SAAS,EAAEd,eAAe,CAAC;MAChEJ,MAAM,CAACgB,gBAAgB,CAACC,YAAY,CAACE,MAAM,EAAER,YAAY,CAAC;;MAG1D,IAAMS,GAAG,GAAGrB,cAAc,CAACsB,MAAM,EAAE;MAC3B,IAAAC,KAAK,GAAa9B,MAAM,CAAA8B,KAAnB;QAAEC,MAAM,GAAK/B,MAAM,CAAA+B,MAAX;MACrB,IAAMlC,OAAO,GAAGU,cAAc,CAACyB,UAAU,EAAE;MAC3CjC,KAAI,CAACkC,SAAS,CACZpC,OAAO,EACP,CAAC,EACD,CAAC,EACDiC,KAAK,GAAGF,GAAG,EACXG,MAAM,GAAGH,GAAG,EACZ5B,MAAM,CAACkC,UAAU,CAClB;IACH,CAAC,CAAC;IAEFhC,gBAAgB,CAACkB,KAAK,CAACe,OAAO,CAACb,GAAG,CAAC3C,oBAAoB,CAAC4C,GAAG,EAAE;MAC3Df,MAAM,CAAC4B,mBAAmB,CAACX,YAAY,CAACC,SAAS,EAAEd,eAAe,CAAC;MACnEJ,MAAM,CAAC4B,mBAAmB,CAACX,YAAY,CAACE,MAAM,EAAER,YAAY,CAAC;MAC7DpB,KAAI,CAACjB,WAAW,GAAG,EAAE;MACrBiB,KAAI,CAAClB,qBAAqB,GAAG,EAAE;MAC/BkB,KAAI,CAAChB,YAAY,GAAG,EAAE;IACxB,CAAC,CAAC;IAEFmB,gBAAgB,CAACkB,KAAK,CAACiB,UAAU,CAACf,GAAG,CAAC3C,oBAAoB,CAAC4C,GAAG,EAAE;MAC9D,IAAM1B,OAAO,GAAGU,cAAc,CAACyB,UAAU,EAAE;MAC3C,IAAMJ,GAAG,GAAGrB,cAAc,CAACsB,MAAM,EAAE;MAC3B,IAAAC,KAAK,GAAa9B,MAAM,CAAA8B,KAAnB;QAAEC,MAAM,GAAK/B,MAAM,CAAA+B,MAAX;MACf,IAAAO,EAAA,GACJvC,KAAI,CAACnB,2BAA2B;QAD1B2D,uBAAuB,GAAAD,EAAA,CAAAC,uBAAA;QAAEC,yBAAyB,GAAAF,EAAA,CAAAE,yBACxB;;MAG5B,IAAAC,EAAA,GAAsBvC,gBAAgB,CAACwC,QAAQ,EAAE;QAA/CC,KAAK,GAAAF,EAAA,CAAAE,KAAA;QAAEC,QAAQ,GAAAH,EAAA,CAAAG,QAAgC;MACvD,IAAMC,KAAK,GAAGD,QAAQ,GAAGD,KAAK;MAE9B5C,KAAI,CAACf,eAAe,GAClBkB,gBAAgB,CAAC4C,8BAA8B,EAAE,IAChDF,QAAQ,GAAGL,uBAAuB,IACjCM,KAAK,GAAGL,yBAA0B;MAEtC,IAAI3C,OAAO,EAAE;QACXA,OAAO,CAACkD,cAAc,GAClBlD,OAAO,CAACkD,cAAc,EAAE,GACxBlD,OAAO,CAACmD,YAAY,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC;QAC1C,IAAIjD,KAAI,CAACf,eAAe,EAAE;UACxBe,KAAI,CAACkC,SAAS,CACZpC,OAAO,EACP,CAAC,EACD,CAAC,EACDiC,KAAK,GAAGF,GAAG,EACXG,MAAM,GAAGH,GAAG,EACZ5B,MAAM,CAACkC,UAAU,CAClB;;;IAGP,CAAC,CAAC;IAEF,IAAMe,cAAc,GAAG,SAAAA,CACrBnC,MAAqB,EACrBjB,OAAiC;MAEjC,IAAIiB,MAAM,CAACoC,SAAS,EAAE,IAAI,CAACpC,MAAM,CAACqC,QAAQ,EAAE,EAAE;QAC5CpD,KAAI,CAACqD,mBAAmB,CACtBtC,MAAM,EACNjB,OAAO,EACPE,KAAI,CAACF,OAAO,EACZE,KAAI,CAAChB,YAAY,EACjBe,OAAO,CACR;;;QAIDC,KAAI,CAACsD,aAAa,CAACvC,MAAM,CAAC;;;MAI5B,IAAMwC,MAAM,GAAGxC,MAAM,CAACyC,QAAQ,CAACD,MAAM,IAAIxC,MAAM,CAAC0C,UAAU;;MAG1DF,MAAM,CAACG,OAAO,CAAC,UAACC,KAAoB;QAClCT,cAAc,CAACS,KAAK,EAAE7D,OAAO,CAAC;MAChC,CAAC,CAAC;IACJ,CAAC;;IAGDK,gBAAgB,CAACkB,KAAK,CAACuC,QAAQ,CAACrC,GAAG,CAAC3C,oBAAoB,CAAC4C,GAAG,EAAE;MAC5D,IAAM1B,OAAO,GAAGU,cAAc,CAACyB,UAAU,EAAE;;MAE3C,IAAMJ,GAAG,GAAGrB,cAAc,CAACsB,MAAM,EAAE;MACnC3C,IAAI,CAAC0E,WAAW,CAAC7D,KAAI,CAACX,SAAS,EAAE,CAACwC,GAAG,EAAEA,GAAG,EAAE,CAAC,CAAC,CAAC;MAC/C1C,IAAI,CAAC2E,QAAQ,CAAC9D,KAAI,CAACd,QAAQ,EAAEc,KAAI,CAACX,SAAS,EAAEa,MAAM,CAAC6D,cAAc,EAAE,CAAC;;MAGrE,IAAI/D,KAAI,CAACf,eAAe,EAAE;;QAExBiE,cAAc,CAAC9C,gBAAgB,CAACM,IAAI,EAAEZ,OAAO,CAAC;OAC/C,MAAM;;;QAGL,IAAMkE,iBAAiB,GAAGhE,KAAI,CAACiE,aAAa,CAAApE,KAAA,CAAlBG,KAAI,EAAAkE,aAAA,EAC5BlE,KAAI,CAACmE,eAAe,CAACnE,KAAI,CAACjB,WAAW,CAAC,GAAAqF,MAAA,CACnCpE,KAAI,CAAClB,qBAAqB,CAACuF,GAAG,CAAC,UAAC9B,EAA0B;cAAxB+B,IAAI,GAAA/B,EAAA,CAAA+B,IAAA;YAAEC,IAAI,GAAAhC,EAAA,CAAAgC,IAAA;YAAEC,IAAI,GAAAjC,EAAA,CAAAiC,IAAA;YAAEC,IAAI,GAAAlC,EAAA,CAAAkC,IAAA;UACzD,IAAMvD,IAAI,GAAG,IAAIwD,IAAI,EAAE;UACvBxD,IAAI,CAACyD,SAAS;;;UAGZ,CAACL,IAAI,EAAEC,IAAI,EAAE,CAAC,CAAC,EACf,CAACC,IAAI,EAAEC,IAAI,EAAE,CAAC,CAAC,CAChB;UACD,OAAOvD,IAAI;SACZ,CAAC,UACH;QACDlB,KAAI,CAAClB,qBAAqB,GAAG,EAAE;QAE/B,IAAI4F,IAAI,CAACE,OAAO,CAACZ,iBAAiB,CAAC,EAAE;UACnChE,KAAI,CAACjB,WAAW,GAAG,EAAE;UACrB;;QAGF,IAAM8F,SAAS,GAAG7E,KAAI,CAAC8E,gBAAgB,CAACd,iBAAiB,CAAC;QAClD,IAAAe,CAAC,GAAuBF,SAAS,CAAAE,CAAhC;UAAEC,CAAC,GAAoBH,SAAS,CAAAG,CAA7B;UAAEjD,KAAK,GAAa8C,SAAS,CAAtB9C,KAAA;UAAEC,MAAM,GAAK6C,SAAS,CAAA7C,MAAd;QAE3B,IAAMiD,EAAE,GAAGzF,IAAI,CAAC0F,aAAa,CAAClF,KAAI,CAACT,KAAK,EAAE,CAACwF,CAAC,EAAEC,CAAC,EAAE,CAAC,CAAC,EAAEhF,KAAI,CAACd,QAAQ,CAAC;QACnE,IAAMiG,EAAE,GAAG3F,IAAI,CAAC0F,aAAa,CAC3BlF,KAAI,CAACP,KAAK,EACV,CAACsF,CAAC,GAAGhD,KAAK,EAAEiD,CAAC,EAAE,CAAC,CAAC,EACjBhF,KAAI,CAACd,QAAQ,CACd;QACD,IAAMkG,EAAE,GAAG5F,IAAI,CAAC0F,aAAa,CAC3BlF,KAAI,CAACN,KAAK,EACV,CAACqF,CAAC,EAAEC,CAAC,GAAGhD,MAAM,EAAE,CAAC,CAAC,EAClBhC,KAAI,CAACd,QAAQ,CACd;QACD,IAAMmG,EAAE,GAAG7F,IAAI,CAAC0F,aAAa,CAC3BlF,KAAI,CAACL,KAAK,EACV,CAACoF,CAAC,GAAGhD,KAAK,EAAEiD,CAAC,GAAGhD,MAAM,EAAE,CAAC,CAAC,EAC1BhC,KAAI,CAACd,QAAQ,CACd;QAED,IAAMoG,IAAI,GAAGC,IAAI,CAACC,GAAG,CAACP,EAAE,CAAC,CAAC,CAAC,EAAEE,EAAE,CAAC,CAAC,CAAC,EAAEE,EAAE,CAAC,CAAC,CAAC,EAAED,EAAE,CAAC,CAAC,CAAC,CAAC;QACjD,IAAMK,IAAI,GAAGF,IAAI,CAACC,GAAG,CAACP,EAAE,CAAC,CAAC,CAAC,EAAEE,EAAE,CAAC,CAAC,CAAC,EAAEE,EAAE,CAAC,CAAC,CAAC,EAAED,EAAE,CAAC,CAAC,CAAC,CAAC;QACjD,IAAMM,IAAI,GAAGH,IAAI,CAACI,GAAG,CAACV,EAAE,CAAC,CAAC,CAAC,EAAEE,EAAE,CAAC,CAAC,CAAC,EAAEE,EAAE,CAAC,CAAC,CAAC,EAAED,EAAE,CAAC,CAAC,CAAC,CAAC;QACjD,IAAMQ,IAAI,GAAGL,IAAI,CAACI,GAAG,CAACV,EAAE,CAAC,CAAC,CAAC,EAAEE,EAAE,CAAC,CAAC,CAAC,EAAEE,EAAE,CAAC,CAAC,CAAC,EAAED,EAAE,CAAC,CAAC,CAAC,CAAC;QAEjD,IAAMS,EAAE,GAAGN,IAAI,CAACO,KAAK,CAACR,IAAI,CAAC;QAC3B,IAAMS,EAAE,GAAGR,IAAI,CAACO,KAAK,CAACL,IAAI,CAAC;QAC3B,IAAMO,MAAM,GAAGT,IAAI,CAACU,IAAI,CAACP,IAAI,GAAGJ,IAAI,CAAC;QACrC,IAAMY,OAAO,GAAGX,IAAI,CAACU,IAAI,CAACL,IAAI,GAAGH,IAAI,CAAC;QAEtC3F,OAAO,CAACqG,IAAI,EAAE;QACdnG,KAAI,CAACkC,SAAS,CAACpC,OAAO,EAAE+F,EAAE,EAAEE,EAAE,EAAEC,MAAM,EAAEE,OAAO,EAAEjG,MAAM,CAACkC,UAAU,CAAC;QACnErC,OAAO,CAACsG,SAAS,EAAE;QACnBtG,OAAO,CAACuG,IAAI,CAACR,EAAE,EAAEE,EAAE,EAAEC,MAAM,EAAEE,OAAO,CAAC;QACrCpG,OAAO,CAACwG,IAAI,EAAE;;QAGdxG,OAAO,CAACmD,YAAY,CAClBjD,KAAI,CAACd,QAAQ,CAAC,CAAC,CAAC,EAChBc,KAAI,CAACd,QAAQ,CAAC,CAAC,CAAC,EAChBc,KAAI,CAACd,QAAQ,CAAC,CAAC,CAAC,EAChBc,KAAI,CAACd,QAAQ,CAAC,CAAC,CAAC,EAChBc,KAAI,CAACd,QAAQ,CAAC,EAAE,CAAC,EACjBc,KAAI,CAACd,QAAQ,CAAC,EAAE,CAAC,CAClB;;QAGO,IAAAqH,kCAAkC,GACxCtG,MAAM,CAACuG,QAAQ,CAACC,SAAS,EAAE,CAAAF,kCADa;QAE1C,IAAIA,kCAAkC,EAAE;UACtC9F,MAAM,CAACiG,aAAa,CAClB,IAAIC,WAAW,CAACC,WAAW,CAACC,eAAe,EAAE;YAC3ChC,SAAS,EAAE;cACTE,CAAC,EAAEc,EAAE;cACLb,CAAC,EAAEe,EAAE;cACLhE,KAAK,EAAEiE,MAAM;cACbhE,MAAM,EAAEkE;YACT;UACF,EAAC,CACH;;;QAIH,IAAMY,YAAY,GAAG9G,KAAI,CAAC+G,kBAAkB,CAAC/C,iBAAiB,CAAC;;QAG/D8C;;SAEGE,IAAI,CAAC,UAACC,CAAC,EAAEC,CAAC,EAAK;UAAA,OAAAD,CAAC,CAACzD,QAAQ,CAAC2D,WAAW,GAAGD,CAAC,CAAC1D,QAAQ,CAAC2D,WAAW;QAAA,EAAC,CAC/DzD,OAAO,CAAC,UAAC3C,MAAM;;UAEd,IAAIA,MAAM,IAAIA,MAAM,CAACoC,SAAS,EAAE,IAAI,CAACpC,MAAM,CAACqC,QAAQ,EAAE,EAAE;YACtDpD,KAAI,CAACqD,mBAAmB,CACtBtC,MAAM,EACNjB,OAAO,EACPE,KAAI,CAACF,OAAO,EACZE,KAAI,CAAChB,YAAY,EACjBe,OAAO,CACR;;QAEL,CAAC,CAAC;QAEJD,OAAO,CAACsH,OAAO,EAAE;;QAGjBpH,KAAI,CAACjB,WAAW,CAAC2E,OAAO,CAAC,UAAC3C,MAAM;UAC9Bf,KAAI,CAACsD,aAAa,CAACvC,MAAM,CAAC;QAC5B,CAAC,CAAC;;QAGFf,KAAI,CAACjB,WAAW,GAAG,EAAE;;;MAIvBiB,KAAI,CAAChB,YAAY,CAAC0E,OAAO,CAAC;QACxB5D,OAAO,CAACsH,OAAO,EAAE;MACnB,CAAC,CAAC;;MAEFpH,KAAI,CAAChB,YAAY,GAAG,EAAE;IACxB,CAAC,CAAC;IAEFmB,gBAAgB,CAACkB,KAAK,CAACgG,MAAM,CAAC9F,GAAG,CAC/B3C,oBAAoB,CAAC4C,GAAG,EACxB,UAACT,MAAqB;MACpB,IAAI,CAACf,KAAI,CAACf,eAAe,EAAE;;QAEzBe,KAAI,CAACjB,WAAW,CAACoC,IAAI,CAACJ,MAAM,CAAC;;IAEjC,CAAC,CACF;GACF;EAEOnC,oBAAA,CAAAgB,SAAA,CAAAsC,SAAS,GAAjB,UACEpC,OAAiC,EACjCiF,CAAS,EACTC,CAAS,EACTjD,KAAa,EACbC,MAAc,EACdG,UAAkB;;IAGlBrC,OAAO,CAACoC,SAAS,CAAC6C,CAAC,EAAEC,CAAC,EAAEjD,KAAK,EAAEC,MAAM,CAAC;IACtC,IAAIG,UAAU,EAAE;MACdrC,OAAO,CAACwH,SAAS,GAAGnF,UAAU;MAC9BrC,OAAO,CAACyH,QAAQ,CAACxC,CAAC,EAAEC,CAAC,EAAEjD,KAAK,EAAEC,MAAM,CAAC;;GAExC;EAEDpD,oBAAmB,CAAAgB,SAAA,CAAAyD,mBAAA,GAAnB,UACEtC,MAAqB,EACrBjB,OAAiC,EACjC0H,aAA4B,EAC5BxI,YAA6B,EAC7Be,OAAsB;IAEtB,IAAM0H,QAAQ,GAAG1G,MAAM,CAAC0G,QAAQ;;;IAMhC,IAAMC,MAAM,GAAG1I,YAAY,CAACA,YAAY,CAAC2I,MAAM,GAAG,CAAC,CAAC;IACpD,IACED,MAAM,IACN,EACE3G,MAAM,CAAC6G,uBAAuB,CAACF,MAAM,CAAC,GAAGG,IAAI,CAACC,0BAA0B,CACzE,EACD;MACAhI,OAAO,CAACsH,OAAO,EAAE;MACjBpI,YAAY,CAAC+I,GAAG,EAAE;;;IAIpB,IAAMC,aAAa,GAAG,IAAI,CAAClI,OAAO,CAACmI,oBAAoB,CAACR,QAAQ,CAAC;IACjE,IAAMS,YAAY,GAAG,IAAI,CAAC5H,oBAAoB,CAACmH,QAAQ,CAAC;;IAGhD,IAAAU,QAAQ,GAAKpH,MAAM,CAACqH,WAAmC,CAAAD,QAA/C;IAChB,IAAIA,QAAQ,EAAE;MACZ,IAAI,CAACE,mBAAmB,CAACvI,OAAO,EAAEqI,QAAQ,CAAC;;MAG3C,IAAMG,cAAY,GAAG,IAAI,CAAChI,oBAAoB,CAAC6H,QAAQ,CAACV,QAAQ,CAAC;MACjE,IAAIa,cAAY,EAAE;QAChBxI,OAAO,CAACqG,IAAI,EAAE;;QAGdnH,YAAY,CAACmC,IAAI,CAACJ,MAAM,CAAC;QAEzBjB,OAAO,CAACsG,SAAS,EAAE;QACnBkC,cAAY,CAACxI,OAAO,EAAEqI,QAAQ,CAACC,WAAW,CAAC;QAC3CtI,OAAO,CAACyI,SAAS,EAAE;QACnBzI,OAAO,CAACwG,IAAI,EAAE;;;;IAMlB,IAAI0B,aAAa,EAAE;MACjB,IAAI,CAACK,mBAAmB,CAACvI,OAAO,EAAEiB,MAAM,CAAC;MAEzCjB,OAAO,CAACqG,IAAI,EAAE;;MAGd,IAAI,CAACqC,wBAAwB,CAAC1I,OAAO,EAAEiB,MAAM,CAAC;;IAGhD,IAAImH,YAAY,EAAE;MAChBpI,OAAO,CAACsG,SAAS,EAAE;MACnB8B,YAAY,CAACpI,OAAO,EAAEiB,MAAM,CAACqH,WAAW,CAAC;MACzC,IACErH,MAAM,CAAC0G,QAAQ,KAAKgB,KAAK,CAACC,IAAI,IAC9B3H,MAAM,CAAC0G,QAAQ,KAAKgB,KAAK,CAACE,IAAI,IAC9B5H,MAAM,CAAC0G,QAAQ,KAAKgB,KAAK,CAACG,QAAQ,EAClC;QACA9I,OAAO,CAACyI,SAAS,EAAE;;;;IAKvB,IAAIP,aAAa,EAAE;MACjBA,aAAa,CAACX,MAAM,CAClBvH,OAAO,EACPiB,MAAM,CAACqH,WAAW,EAClBrH,MAAM,EACNyG,aAAa,EACb,IAAI,EACJzH,OAAO,CACR;;MAGDD,OAAO,CAACsH,OAAO,EAAE;;;IAInBrG,MAAM,CAAC8H,UAAU,CAACC,KAAK,GAAG,KAAK;GAChC;EAEOlK,oBAAgB,CAAAgB,SAAA,CAAAkF,gBAAA,GAAxB,UAAyB5D,IAAU;IACjC,IAAMsE,GAAG,GAAGtE,IAAI,CAAC6H,MAAM,EAAE;IACzB,IAAMpD,GAAG,GAAGzE,IAAI,CAAC8H,MAAM,EAAE;;;IAGzB,IAAM1E,IAAI,GAAGiB,IAAI,CAACO,KAAK,CAACN,GAAG,CAAC,CAAC,CAAC,CAAC;IAC/B,IAAMjB,IAAI,GAAGgB,IAAI,CAACO,KAAK,CAACN,GAAG,CAAC,CAAC,CAAC,CAAC;IAC/B,IAAMhB,IAAI,GAAGe,IAAI,CAACU,IAAI,CAACN,GAAG,CAAC,CAAC,CAAC,CAAC;IAC9B,IAAMlB,IAAI,GAAGc,IAAI,CAACU,IAAI,CAACN,GAAG,CAAC,CAAC,CAAC,CAAC;IAC9B,IAAM5D,KAAK,GAAGyC,IAAI,GAAGF,IAAI;IACzB,IAAMtC,MAAM,GAAGyC,IAAI,GAAGF,IAAI;IAE1B,OAAO;MAAEQ,CAAC,EAAET,IAAI;MAAEU,CAAC,EAAET,IAAI;MAAExC,KAAK,EAAAA,KAAA;MAAEC,MAAM,EAAAA;IAAA,CAAE;GAC3C;EAED;;;;AAIG;EACKpD,oBAAe,CAAAgB,SAAA,CAAAuE,eAAA,GAAvB,UAAwB2C,YAA6B;;;IAGnD,IAAM5F,IAAI,GAAG,IAAIwD,IAAI,EAAE;IACvBoC,YAAY,CAACpD,OAAO,CAAC,UAAC3C,MAAM;MAC1B,IAAMkI,YAAY,GAAGlI,MAAM,CAACmI,eAAe,EAAE;MAC7ChI,IAAI,CAACiI,GAAG,CAACF,YAAY,CAAC;MAEd,IAAAjF,iBAAiB,GAAKjD,MAAM,CAAC8H,UAAU,CAAA7E,iBAAtB;MACzB,IAAIA,iBAAiB,EAAE;QACrB9C,IAAI,CAACiI,GAAG,CAACnF,iBAAiB,CAAC;;IAE/B,CAAC,CAAC;IAEF,OAAO9C,IAAI;GACZ;EAEOtC,oBAAkB,CAAAgB,SAAA,CAAAmH,kBAAA,GAA1B,UAA2BqC,cAAoB;;IAEvC,IAAA7G,EAAA,GAAA6B,MAAA,CAAegF,cAAc,CAACL,MAAM,EAAE;MAArCzE,IAAI,GAAA/B,EAAA;MAAEgC,IAAI,GAAAhC,EAAA,GAA2B;IACtC,IAAAG,EAAA,GAAA0B,MAAA,CAAegF,cAAc,CAACJ,MAAM,EAAE;MAArCxE,IAAI,GAAA9B,EAAA;MAAE+B,IAAI,GAAA/B,EAAA,GAA2B;IAC5C,IAAM2G,UAAU,GAAG,IAAI,CAAC9I,KAAK,CAAC+I,MAAM,CAAC;MACnChF,IAAI,EAAAA,IAAA;MACJC,IAAI,EAAAA,IAAA;MACJC,IAAI,EAAAA,IAAA;MACJC,IAAI,EAAAA;IACL,EAAC;IAEF,OAAO4E,UAAU,CAAChF,GAAG,CAAC,UAAC9B,EAAiB;MAAf,IAAAgH,aAAa,GAAAhH,EAAA,CAAAgH,aAAA;MAAO,OAAAA,aAAa;IAAb,CAAa,CAAC;GAC5D;EAEO3K,oBAAa,CAAAgB,SAAA,CAAA0D,aAAA,GAArB,UAAsBvC,MAAqB;IACzC,IAAM8H,UAAU,GAAG9H,MAAM,CAAC8H,UAAU;IACpC,IAAI,CAACA,UAAU,CAAC7E,iBAAiB,EAAE;MACjC6E,UAAU,CAAC7E,iBAAiB,GAAG,IAAIU,IAAI,EAAE;;IAE3C,IAAMuE,YAAY,GAAGlI,MAAM,CAACmI,eAAe,EAAE;IAC7C,IAAID,YAAY,EAAE;;MAEhBJ,UAAU,CAAC7E,iBAAiB,CAACwF,MAAM,CACjCP,YAAY,CAACQ,MAAM,EACnBR,YAAY,CAACS,WAAW,CACzB;;GAEJ;EAED;;AAEG;EACK9K,oBAAA,CAAAgB,SAAA,CAAA4I,wBAAwB,GAAhC,UACE1I,OAAiC,EACjCiB,MAAqB;IAEf,IAAAwB,EAAA,GACJxB,MAAM,CAACqH,WAAmC;MADpCuB,MAAM,GAAApH,EAAA,CAAAoH,MAAA;MAAEC,IAAI,GAAArH,EAAA,CAAAqH,IAAA;MAAEC,OAAO,GAAAtH,EAAA,CAAAsH,OAAA;MAAEC,QAAQ,GAAAvH,EAAA,CAAAuH,QAAA;MAAEC,cAAc,GAAAxH,EAAA,CAAAwH,cACX;;IAE5C,IAAID,QAAQ,EAAE;MACZhK,OAAO,CAACkK,WAAW,CAACF,QAAQ,CAAC;;;IAI/B,IAAI,CAACG,KAAK,CAACF,cAAc,CAAC,EAAE;MAC1BjK,OAAO,CAACiK,cAAc,GAAGA,cAAc;;IAGzC,IAAI,CAACE,KAAK,CAACJ,OAAO,CAAC,EAAE;MACnB/J,OAAO,CAACoK,WAAW,IAAIL,OAAO;;IAGhC,IACE,CAACI,KAAK,CAACN,MAAM,CAAC,IACd,CAACQ,KAAK,CAACC,OAAO,CAACT,MAAM,CAAC,IACtB,CAAEA,MAAiB,CAACU,MAAM,EAC1B;MACAvK,OAAO,CAACwK,WAAW,GAAGvJ,MAAM,CAACwJ,UAAU,CAACZ,MAAM;;IAGhD,IAAI,CAACM,KAAK,CAACL,IAAI,CAAC,IAAI,CAACO,KAAK,CAACC,OAAO,CAACR,IAAI,CAAC,IAAI,CAAEA,IAAe,CAACS,MAAM,EAAE;MACpEvK,OAAO,CAACwH,SAAS,GAAGvG,MAAM,CAACwJ,UAAU,CAACX,IAAI;;GAE7C;EAEOhL,oBAAA,CAAAgB,SAAA,CAAAyI,mBAAmB,GAA3B,UACEvI,OAAiC,EACjCiB,MAAqB,EACrByJ,MAAa;IAEb,IAAIC,EAAE,GAAG,CAAC;IACV,IAAIC,EAAE,GAAG,CAAC;IACF,IAAAC,MAAM,GAAK,CAAC5J,MAAM,CAACqH,WAAW,IAAI,EAAE,EAAyBuC,MAAvD;IACd,IAAMC,OAAO,GAAID,MAAM,IAAIA,MAAM,CAAC,CAAC,CAAC,IAAK,CAAC;IAC1C,IAAME,OAAO,GAAIF,MAAM,IAAIA,MAAM,CAAC,CAAC,CAAC,IAAK,CAAC;IAC1C,IAAIC,OAAO,KAAK,CAAC,IAAIC,OAAO,KAAK,CAAC,EAAE;;MAElC,IAAMC,MAAM,GAAG/J,MAAM,CAACgK,QAAQ,CAACC,aAAa;MAC5C,IAAMjJ,KAAK,GAAI+I,MAAM,IAAIA,MAAM,CAACpB,WAAW,CAAC,CAAC,CAAC,GAAG,CAAC,IAAK,CAAC;MACxD,IAAM1H,MAAM,GAAI8I,MAAM,IAAIA,MAAM,CAACpB,WAAW,CAAC,CAAC,CAAC,GAAG,CAAC,IAAK,CAAC;MACzDe,EAAE,GAAG,EAAEG,OAAO,GAAG7I,KAAK,CAAC;MACvB2I,EAAE,GAAG,EAAEG,OAAO,GAAG7I,MAAM,CAAC;;;IAI1B,IAAIwI,MAAM,EAAE;MACVrL,IAAI,CAAC8L,IAAI,CAAC,IAAI,CAAC3L,OAAO,EAAEyB,MAAM,CAACmK,iBAAiB,EAAE,CAAC;MACnD,IAAI,CAAC3L,KAAK,CAAC,CAAC,CAAC,GAAGkL,EAAE;MAClB,IAAI,CAAClL,KAAK,CAAC,CAAC,CAAC,GAAGmL,EAAE;MAClB,IAAI,CAACnL,KAAK,CAAC,CAAC,CAAC,GAAG,CAAC;MACjBJ,IAAI,CAACgM,SAAS,CAAC,IAAI,CAAC7L,OAAO,EAAE,IAAI,CAACA,OAAO,EAAE,IAAI,CAACC,KAAK,CAAC;MACtDJ,IAAI,CAAC2E,QAAQ,CAAC,IAAI,CAACxE,OAAO,EAAEkL,MAAM,EAAE,IAAI,CAAClL,OAAO,CAAC;MACjDH,IAAI,CAAC2E,QAAQ,CAAC,IAAI,CAACxE,OAAO,EAAE,IAAI,CAACJ,QAAQ,EAAE,IAAI,CAACI,OAAO,CAAC;KACzD,MAAM;;MAELH,IAAI,CAAC8L,IAAI,CAAC,IAAI,CAAC3L,OAAO,EAAEyB,MAAM,CAACqK,iBAAiB,EAAE,CAAC;MACnD,IAAI,CAAC7L,KAAK,CAAC,CAAC,CAAC,GAAGkL,EAAE;MAClB,IAAI,CAAClL,KAAK,CAAC,CAAC,CAAC,GAAGmL,EAAE;MAClB,IAAI,CAACnL,KAAK,CAAC,CAAC,CAAC,GAAG,CAAC;MACjBJ,IAAI,CAACgM,SAAS,CAAC,IAAI,CAAC7L,OAAO,EAAE,IAAI,CAACA,OAAO,EAAE,IAAI,CAACC,KAAK,CAAC;MACtDJ,IAAI,CAAC2E,QAAQ,CAAC,IAAI,CAACxE,OAAO,EAAE,IAAI,CAACJ,QAAQ,EAAE,IAAI,CAACI,OAAO,CAAC;;;IAI1DQ,OAAO,CAACmD,YAAY,CAClB,IAAI,CAAC3D,OAAO,CAAC,CAAC,CAAC,EACf,IAAI,CAACA,OAAO,CAAC,CAAC,CAAC,EACf,IAAI,CAACA,OAAO,CAAC,CAAC,CAAC,EACf,IAAI,CAACA,OAAO,CAAC,CAAC,CAAC,EACf,IAAI,CAACA,OAAO,CAAC,EAAE,CAAC,EAChB,IAAI,CAACA,OAAO,CAAC,EAAE,CAAC,CACjB;GACF;EAEOV,oBAAA,CAAAgB,SAAA,CAAAqE,aAAa,GAArB;IAAsB,IAAgBoH,KAAA;SAAhB,IAAgBC,EAAA,MAAhBA,EAAgB,GAAAC,SAAA,CAAA5D,MAAA,EAAhB2D,EAAgB;MAAhBD,KAAgB,CAAAC,EAAA,IAAAC,SAAA,CAAAD,EAAA;;IACpC,IAAME,MAAM,GAAG,IAAI9G,IAAI,EAAE;IACzB2G,KAAK,CAAC3H,OAAO,CAAC,UAACxC,IAAI;MACjBsK,MAAM,CAACrC,GAAG,CAACjI,IAAI,CAAC;IAClB,CAAC,CAAC;IACF,OAAOsK,MAAM;GACd;EAhkBM5M,oBAAG,CAAA4C,GAAA,GAAG,gBAAH;EAikBZ,OAAC5C,oBAAA;AAAA,CAlkBD,EAkkBC;ACtlBD,IAAA6M,eAAA;EACE,SAAAA,gBAAoBC,SAAoB;IAApB,IAAS,CAAAA,SAAA,GAATA,SAAS;;EAE7BD,eAAA,CAAA7L,SAAA,CAAAyH,MAAM,GAAN,UACEvH,OAAiC,EACjCsI,WAAiC,EACjCrH,MAAqB,EACrByG,aAA4B,EAC5BmE,MAA4B,EAC5B5L,OAAsB;IAGpB,IAAA6J,IAAI,GAcFxB,WAAW,CAAAwB,IAdT;MACJgC,QAAQ,GAaNxD,WAAW,CAAAwD,QAbL;MACR/B,OAAO,GAYLzB,WAAW,CAAAyB,OAZN;MACPgC,WAAW,GAWTzD,WAAW,CAXFyD,WAAA;MACXlC,MAAM,GAUJvB,WAAW,CAVPuB,MAAA;MACNmC,aAAa,GASX1D,WAAW,CAAA0D,aATA;MACbC,SAAS,GAQP3D,WAAW,CAAA2D,SARJ;MACTC,OAAO,GAOL5D,WAAW,CAPN4D,OAAA;MACPC,QAAQ,GAMN7D,WAAW,CANL6D,QAAA;MACRC,UAAU,GAKR9D,WAAW,CAAA8D,UALH;MACVC,WAAW,GAIT/D,WAAW,CAAA+D,WAJF;MACXC,UAAU,GAGRhE,WAAW,CAAAgE,UAHH;MACVC,MAAM,GAEJjE,WAAW,CAAAiE,MAFP;MACNC,UAAU,GACRlE,WAAW,CAAAkE,UADH;IAEZ,IAAMC,OAAO,GAAG,CAACtC,KAAK,CAACL,IAAI,CAAC,IAAI,CAAEA,IAAe,CAACS,MAAM;IACxD,IAAMmC,SAAS,GACb,CAACvC,KAAK,CAACN,MAAM,CAAC,IAAI,CAAEA,MAAiB,CAACU,MAAM,IAAI0B,SAAS,GAAG,CAAC;IAC/D,IAAMU,iBAAiB,GAAI7C,IAAe,CAAC8C,KAAK,KAAK,CAAC;IACtD,IAAMC,SAAS,GAAG,CAAC,EAAEN,MAAM,IAAIA,MAAM,CAAC1E,MAAM,CAAC;IAC7C,IAAMiF,SAAS,GAAG,CAAC3C,KAAK,CAACkC,WAAW,CAAC,IAAIC,UAAU,GAAG,CAAC;IACvD,IAAM3E,QAAQ,GAAG1G,MAAM,CAAC0G,QAAQ;IAChC,IAAMoF,aAAa,GAAGX,UAAU,KAAK,OAAO;IAC5C,IAAMY,0BAA0B,GAC9BN,SAAS,IACTI,SAAS,KACRnF,QAAQ,KAAKgB,KAAK,CAACE,IAAI,IACtBlB,QAAQ,KAAKgB,KAAK,CAACC,IAAI,IACvBjB,QAAQ,KAAKgB,KAAK,CAACG,QAAQ,IAC3B6D,iBAAiB,IACjBI,aAAa,CAAC;IAElB,IAAIN,OAAO,EAAE;MACXzM,OAAO,CAACoK,WAAW,GAAGL,OAAO,GAAGgC,WAAW;MAE3C,IAAI,CAACiB,0BAA0B,EAAE;QAC/BC,kBAAkB,CAAChM,MAAM,EAAEjB,OAAO,EAAE8M,SAAS,CAAC;;MAGhD,IAAI,CAAChD,IAAI,CACP9J,OAAO,EACPiB,MAAM,EACN6I,IAAI,EACJgC,QAAQ,EACRpE,aAAa,EACbmE,MAAM,EACN5L,OAAO,CACR;MAED,IAAI,CAAC+M,0BAA0B,EAAE;QAC/B,IAAI,CAACE,oBAAoB,CAAClN,OAAO,EAAE6M,SAAS,EAAEC,SAAS,CAAC;;;IAI5D,IAAIJ,SAAS,EAAE;MACb1M,OAAO,CAACoK,WAAW,GAAGL,OAAO,GAAGiC,aAAa;MAC7ChM,OAAO,CAACiM,SAAS,GAAGA,SAAS;MAC7B,IAAI,CAAC9B,KAAK,CAACqC,UAAU,CAAC,EAAE;QACtBxM,OAAO,CAACwM,UAAU,GAAGA,UAAU;;MAGjC,IAAI,CAACrC,KAAK,CAAC+B,OAAO,CAAC,EAAE;QACnBlM,OAAO,CAACkM,OAAO,GAAGA,OAAO;;MAG3B,IAAI,CAAC/B,KAAK,CAACgC,QAAQ,CAAC,EAAE;QACpBnM,OAAO,CAACmM,QAAQ,GAAGA,QAAQ;;MAG7B,IAAIa,0BAA0B,EAAE;QAC9B,IAAID,aAAa,EAAE;UACjB/M,OAAO,CAACmN,wBAAwB,GAAG,aAAa;;QAElDF,kBAAkB,CAAChM,MAAM,EAAEjB,OAAO,EAAE,IAAI,CAAC;QAEzC,IAAI+M,aAAa,EAAE;UACjB,IAAI,CAAClD,MAAM,CAAC7J,OAAO,EAAEiB,MAAM,EAAE4I,MAAM,EAAEnC,aAAa,EAAEmE,MAAM,EAAE5L,OAAO,CAAC;UACpED,OAAO,CAACmN,wBAAwB,GAAG,aAAa;UAChD,IAAI,CAACD,oBAAoB,CAAClN,OAAO,EAAE6M,SAAS,EAAE,IAAI,CAAC;;;MAIvD,IAAI,CAAChD,MAAM,CAAC7J,OAAO,EAAEiB,MAAM,EAAE4I,MAAM,EAAEnC,aAAa,EAAEmE,MAAM,EAAE5L,OAAO,CAAC;;GAEvE;EAEO0L,eAAA,CAAA7L,SAAA,CAAAoN,oBAAoB,GAA5B,UACElN,OAAiC,EACjC6M,SAAkB,EAClBC,SAAkB;IAElB,IAAIA,SAAS,EAAE;MACb9M,OAAO,CAACqM,WAAW,GAAG,aAAa;MACnCrM,OAAO,CAACsM,UAAU,GAAG,CAAC;;IAGxB,IAAIO,SAAS,EAAE;;MAEb,IAAMO,SAAS,GAAGpN,OAAO,CAACuM,MAAM;MAChC,IAAI,CAACpC,KAAK,CAACiD,SAAS,CAAC,IAAIA,SAAS,CAACC,OAAO,CAAC,aAAa,CAAC,GAAG,CAAC,CAAC,EAAE;QAC9DrN,OAAO,CAACuM,MAAM,GACZa,SAAS,CAACE,OAAO,CAAC,sBAAsB,EAAE,EAAE,CAAC,CAACC,IAAI,EAAE,IAAI,MAAM;;;GAGrE;EAEO5B,eAAA,CAAA7L,SAAA,CAAAgK,IAAI,GAAZ,UACE9J,OAAiC,EACjCiB,MAAqB,EACrB6I,IAA2C,EAC3CgC,QAA+B,EAC/BpE,aAA4B,EAC5BmE,MAA4B,EAC5B5L,OAAsB;IAPxB,IA4BCC,KAAA;IAnBC,IAAImK,KAAK,CAACC,OAAO,CAACR,IAAI,CAAC,EAAE;MACvBA,IAAI,CAAClG,OAAO,CAAC,UAAC4J,QAAQ;QACpBxN,OAAO,CAACwH,SAAS,GAAGtH,KAAI,CAACuN,QAAQ,CAACD,QAAQ,EAAEvM,MAAM,EAAEjB,OAAO,CAAC;QAE5D8L,QAAQ,GAAG9L,OAAO,CAAC8J,IAAI,CAACgC,QAAQ,CAAC,GAAG9L,OAAO,CAAC8J,IAAI,EAAE;MACpD,CAAC,CAAC;KACH,MAAM;MACL,IAAI4D,SAAS,CAAC5D,IAAI,CAAC,EAAE;QACnB9J,OAAO,CAACwH,SAAS,GAAG,IAAI,CAACmG,UAAU,CACjC7D,IAAI,EACJ7I,MAAM,EACNjB,OAAO,EACP0H,aAAa,EACbmE,MAAM,EACN5L,OAAO,CACR;;MAEH6L,QAAQ,GAAG9L,OAAO,CAAC8J,IAAI,CAACgC,QAAQ,CAAC,GAAG9L,OAAO,CAAC8J,IAAI,EAAE;;GAErD;EAEO6B,eAAA,CAAA7L,SAAA,CAAA+J,MAAM,GAAd,UACE7J,OAAiC,EACjCiB,MAAqB,EACrB4I,MAA6C,EAC7CnC,aAA4B,EAC5BmE,MAA4B,EAC5B5L,OAAsB;IANxB,IA0BCC,KAAA;IAlBC,IAAImK,KAAK,CAACC,OAAO,CAACT,MAAM,CAAC,EAAE;MACzBA,MAAM,CAACjG,OAAO,CAAC,UAAC4J,QAAQ;QACtBxN,OAAO,CAACwK,WAAW,GAAGtK,KAAI,CAACuN,QAAQ,CAACD,QAAQ,EAAEvM,MAAM,EAAEjB,OAAO,CAAC;QAC9DA,OAAO,CAAC6J,MAAM,EAAE;MAClB,CAAC,CAAC;KACH,MAAM;MACL,IAAI6D,SAAS,CAAC7D,MAAM,CAAC,EAAE;QACrB7J,OAAO,CAACwK,WAAW,GAAG,IAAI,CAACmD,UAAU,CACnC9D,MAAM,EACN5I,MAAM,EACNjB,OAAO,EACP0H,aAAa,EACbmE,MAAM,EACN5L,OAAO,CACR;;MAEHD,OAAO,CAAC6J,MAAM,EAAE;;GAEnB;EAEO8B,eAAA,CAAA7L,SAAA,CAAA6N,UAAU,GAAlB,UACEC,OAAgB,EAChB3M,MAAqB,EACrBjB,OAAiC,EACjC0H,aAA4B,EAC5BmE,MAA4B,EAC5B5L,OAAsB;IAEtB,IAAI4N,gBAAmC;IACvC,IAAI9L,GAAW;IACf,IAAK6L,OAAO,CAACE,KAAc,CAACnG,QAAQ,KAAK,MAAM,EAAE;MACzC,IAAAlF,EAAqB,GAAAmL,OAAO,CAACE,KAAc,CAACxF,WAAW;QAArDrG,KAAK,GAAAQ,EAAA,CAAAR,KAAA;QAAEC,MAAM,GAAAO,EAAA,CAAAP,MAAwC;MAC7DH,GAAG,GAAG2F,aAAa,CAAChH,cAAc,CAACsB,MAAM,EAAE;MACnC,IAAA+L,eAAe,GAAKrG,aAAa,CAACvH,MAAM,CAAA4N,eAAzB;MACvBF,gBAAgB,GAAG5N,OAAO,CAAC+N,sBAAsB,CAACC,iBAAiB,CACjEF,eAAe,CACK;MAEtBF,gBAAgB,CAAC5L,KAAK,GAAGA,KAAK,GAAGF,GAAG;MACpC8L,gBAAgB,CAAC3L,MAAM,GAAGA,MAAM,GAAGH,GAAG;MAEtC,IAAMmM,wBAAsB,GAC1BjO,OAAO,CAAC+N,sBAAsB,CAACG,kBAAkB,CAC/CJ,eAAe,CACY;MAE/B,IAAMK,cAAY,GAAG,EAAE;;MAItBR,OAAO,CAACE,KAAc,CAAClK,OAAO,CAAC,UAAC3C,MAAqB;QACpD4K,MAAM,CAACtI,mBAAmB,CACxBtC,MAAM,EACNiN,wBAAsB,EACtBxG,aAAa,EACb0G,cAAY,EACZnO,OAAO,CACR;MACH,CAAC,CAAC;MAEFmO,cAAY,CAACxK,OAAO,CAAC;QACnBsK,wBAAsB,CAAC5G,OAAO,EAAE;MAClC,CAAC,CAAC;;IAGJ,IAAM+G,aAAa,GAAG,IAAI,CAACzC,SAAS,CAAC0C,sBAAsB,CACzDV,OAAO,EACP5N,OAAO,EACP6N,gBAAgB,EAChB9L,GAAG,EACH;;MAEEd,MAAM,CAAC8H,UAAU,CAACC,KAAK,GAAG,IAAI;MAC9BtB,aAAa,CAACrH,gBAAgB,CAACkO,OAAO,EAAE;IAC1C,CAAC,CACF;IAED,OAAOF,aAAa;GACrB;EAEO1C,eAAA,CAAA7L,SAAA,CAAA2N,QAAQ,GAAhB,UACEe,WAA6B,EAC7BvN,MAAqB,EACrBjB,OAAiC;IAEjC,IAAIyO,KAA8B;IAElC,IACED,WAAW,CAACE,IAAI,KAAKC,YAAY,CAACC,cAAc,IAChDJ,WAAW,CAACE,IAAI,KAAKC,YAAY,CAACE,cAAc,EAChD;MACA,IAAM7D,MAAM,GAAG/J,MAAM,CAAC6N,iBAAiB,EAAE;MACzC,IAAM7M,KAAK,GAAI+I,MAAM,IAAIA,MAAM,CAACpB,WAAW,CAAC,CAAC,CAAC,GAAG,CAAC,IAAK,CAAC;MACxD,IAAM1H,MAAM,GAAI8I,MAAM,IAAIA,MAAM,CAACpB,WAAW,CAAC,CAAC,CAAC,GAAG,CAAC,IAAK,CAAC;MACzD6E,KAAK,GAAG,IAAI,CAAC7C,SAAS,CAACmD,mBAAmB,CAEtCC,QAAA,CAAAA,QAAA;QAAAN,IAAI,EAAEF,WAAW,CAACE;MAAI,GAClBF,WAAW,CAACS,KAAyC;QACzDhN,KAAK,EAAAA,KAAA;QACLC,MAAM,EAAAA;MAAA,IAERlC,OAAO,CACR;;IAGH,OAAOyO,KAAK;GACb;EACH,OAAC9C,eAAA;AAAD,CAAC;AAED;;AAEG;SACasB,kBAAkBA,CAChChM,MAAqB,EACrBjB,OAAiC,EACjC8M,SAAkB;EAEZ,IAAArK,EAAA,GACJxB,MAAM,CAACqH,WAAmC;IADpCiE,MAAM,GAAA9J,EAAA,CAAA8J,MAAA;IAAEF,WAAW,GAAA5J,EAAA,CAAA4J,WAAA;IAAEC,UAAU,GAAA7J,EAAA,CAAA6J,UAAA;IAAE4C,aAAa,GAAAzM,EAAA,CAAAyM,aAAA;IAAEC,aAAa,GAAA1M,EAAA,CAAA0M,aACzB;EAE5C,IAAI5C,MAAM,IAAIA,MAAM,CAAC1E,MAAM,EAAE;;IAE3B7H,OAAO,CAACuM,MAAM,GAAGtL,MAAM,CAACmO,KAAK,CAAC7C,MAAM;;EAGtC,IAAIO,SAAS,EAAE;IACb9M,OAAO,CAACqM,WAAW,GAAGA,WAAW,CAACgD,QAAQ,EAAE;IAC5CrP,OAAO,CAACsM,UAAU,GAAGA,UAAU,IAAI,CAAC;IACpCtM,OAAO,CAACkP,aAAa,GAAGA,aAAa,IAAI,CAAC;IAC1ClP,OAAO,CAACmP,aAAa,GAAGA,aAAa,IAAI,CAAC;;AAE9C;AC3SA,IAAAG,aAAA;EACE,SAAAA,cAAoB1D,SAAoB;IAApB,IAAS,CAAAA,SAAA,GAATA,SAAS;;EAE7B0D,aAAA,CAAAxP,SAAA,CAAAyH,MAAM,GAAN,UACEvH,OAAiC,EACjCsI,WAAkC,EAClCrH,MAAqB;IAEb,IAAAgB,KAAK,GAA2CqG,WAAW,CAAtDrG,KAAA;MAAEC,MAAM,GAAmCoG,WAAW,CAA9CpG,MAAA;MAAEqN,GAAG,GAA8BjH,WAAW,CAAzCiH,GAAA;MAAElD,WAAW,GAAiB/D,WAAW,CAAA+D,WAA5B;MAAEC,UAAU,GAAKhE,WAAW,CAAAgE,UAAhB;IAEnD,IAAIwB,KAAuB;IAC3B,IAAI0B,EAAE,GAAGvN,KAAK;IACd,IAAIwN,EAAE,GAAGvN,MAAM;IAEf,IAAIwN,QAAQ,CAACH,GAAG,CAAC,EAAE;;MAEjBzB,KAAK,GAAG,IAAI,CAAClC,SAAS,CAAC+D,YAAY,CAACJ,GAAG,CAAC;KACzC,MAAM;MACLC,EAAE,KAAFA,EAAE,GAAKD,GAAG,CAACtN,KAAK,CAAC;MACjBwN,EAAE,KAAFA,EAAE,GAAKF,GAAG,CAACrN,MAAM,CAAC;MAClB4L,KAAK,GAAGyB,GAAG;;IAGb,IAAIzB,KAAK,EAAE;MACT,IAAMhB,SAAS,GAAG,CAAC3C,KAAK,CAACkC,WAAW,CAAC,IAAIC,UAAU,GAAG,CAAC;MACvDW,kBAAkB,CAAChM,MAAM,EAAEjB,OAAO,EAAE8M,SAAS,CAAC;;;MAI9C,IAAI;QACF9M,OAAO,CAAC4P,SAAS,CAAC9B,KAAK,EAAE,CAAC,EAAE,CAAC,EAAE0B,EAAE,EAAEC,EAAE,CAAC;OACvC,CAAC,OAAOzO,CAAC,EAAE;;GAEf;EACH,OAACsO,aAAA;AAAD,CAAC;AC3BD,IAAAO,YAAA;EAAA,SAAAA,aAAA,G;EACEA,YAAA,CAAA/P,SAAA,CAAAyH,MAAM,GAAN,UACEvH,OAAiC,EACjCsI,WAAiC,EACjCrH,MAAqB,EACrByG,aAA4B,EAC5BmE,MAA4B,EAC5B5L,OAAsB;IAEhB,IAAAwC,EAAA,GAiBF6F,WAAmC;MAhBrC2D,SAAS,GAAAxJ,EAAA,CAAAwJ,SAAA;MACT6D,SAAS,GAAArN,EAAA,CAAAqN,SAAA;MACTC,YAAY,GAAAtN,EAAA,CAAAsN,YAAA;MACZ5D,QAAQ,GAAA1J,EAAA,CAAA0J,QAAA;MACRK,UAAU,GAAA/J,EAAA,CAAA+J,UAAA;MACVwD,aAAa,GAAAvN,EAAA,CAAAuN,aAAA;MACbnG,MAAM,GAAApH,EAAA,CAAAoH,MAAA;MACNC,IAAI,GAAArH,EAAA,CAAAqH,IAAA;MACJiC,WAAW,GAAAtJ,EAAA,CAAAsJ,WAAA;MACXC,aAAa,GAAAvJ,EAAA,CAAAuJ,aAAA;MACbjC,OAAO,GAAAtH,EAAA,CAAAsH,OAAA;MACPkG,OAAO,GAAAxN,EAAA,CAAAwN,OAAA;MACPC,EAAE,GAAAzN,EAAA,CAAAyN,EAAA;MACFC,EAAE,GAAA1N,EAAA,CAAA0N,EAAA;MACF9D,WAAW,GAAA5J,EAAA,CAAA4J,WAAA;MACXC,UAAU,GAAA7J,EAAA,CAAA6J,UAC2B;IAE/B,IAAA8D,IAAI,GAA6CH,OAAO,CAApDG,IAAA;MAAEC,KAAK,GAAsCJ,OAAO,CAA7CI,KAAA;MAAEnO,MAAM,GAA8B+N,OAAO,CAArC/N,MAAA;MAAEoO,UAAU,GAAkBL,OAAO,CAAAK,UAAzB;MAAEC,WAAW,GAAKN,OAAO,CAAAM,WAAZ;IAEpDvQ,OAAO,CAACoQ,IAAI,GAAGA,IAAI;IACnBpQ,OAAO,CAACiM,SAAS,GAAGA,SAAS;IAC7BjM,OAAO,CAAC8P,SAAS,GAAGA,SAAS,KAAK,QAAQ,GAAG,QAAQ,GAAGA,SAAS;IAEjE,IAAIU,qBAAqB,GAAGT,YAAY;IACxC;;IAEE,CAAC9P,OAAO,CAACwQ,gBAAgB,IACzBD,qBAAqB,KAAK,YAAY,EACtC;MACAA,qBAAqB,GAAG,QAAQ;;IAGlCxQ,OAAO,CAACmM,QAAQ,GAAGA,QAAQ;IAC3B,IAAI,CAAChC,KAAK,CAACqC,UAAU,CAAC,EAAE;MACtBxM,OAAO,CAACwM,UAAU,GAAGA,UAAU;;IAGjC,IAAIkE,aAAa,GAAG,CAAC;;IAErB,IAAIX,YAAY,KAAK,QAAQ,EAAE;MAC7BW,aAAa,GAAG,CAACxO,MAAM,GAAG,CAAC,GAAGoO,UAAU,GAAG,CAAC;KAC7C,MAAM,IACLP,YAAY,KAAK,QAAQ,IACzBA,YAAY,KAAK,YAAY,IAC7BA,YAAY,KAAK,aAAa,EAC9B;MACAW,aAAa,GAAG,CAACxO,MAAM;KACxB,MAAM,IAAI6N,YAAY,KAAK,KAAK,IAAIA,YAAY,KAAK,SAAS,EAAE;MAC/DW,aAAa,GAAG,CAACJ,UAAU;;;IAI7B,IAAMK,OAAO,GAAGT,EAAE,IAAI,CAAC;IACvBQ,aAAa,IAAIP,EAAE,IAAI,CAAC;IAExB,IAAIE,KAAK,CAACxI,MAAM,KAAK,CAAC,EAAE;MACtB,IAAI2I,qBAAqB,KAAK,QAAQ,EAAE;QACtCA,qBAAqB,GAAG,QAAQ;QAChCE,aAAa,IAAI,GAAG,GAAGxO,MAAM;OAC9B,MAAM,IAAIsO,qBAAqB,KAAK,KAAK,EAAE;QAC1CA,qBAAqB,GAAG,QAAQ;QAChCE,aAAa,IAAI,GAAG,GAAGxO,MAAM;;;IAGjClC,OAAO,CAAC+P,YAAY,GAAGS,qBAAqB;IAE5C,IAAM1D,SAAS,GAAG,CAAC3C,KAAK,CAACkC,WAAW,CAAC,IAAIC,UAAU,GAAG,CAAC;IACvDW,kBAAkB,CAAChM,MAAM,EAAEjB,OAAO,EAAE8M,SAAS,CAAC;;IAG9C,KAAK,IAAI8D,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGP,KAAK,CAACxI,MAAM,EAAE+I,CAAC,EAAE,EAAE;MACrC,IAAMC,aAAa,GAAG5E,SAAS,GAAG,CAAC,GAAG0E,OAAO;MAC7CD,aAAa,IAAIJ,UAAU;;;MAI3B,IAAI,CAACnG,KAAK,CAACN,MAAM,CAAC,IAAI,CAAEA,MAAiB,CAACU,MAAM,IAAI0B,SAAS,EAAE;QAC7D,IAAI,CAAC6E,iBAAiB,CACpB9Q,OAAO,EACPqQ,KAAK,CAACO,CAAC,CAAC,EACRL,WAAW,CAACK,CAAC,CAAC,EACdd,SAAS,EACTe,aAAa,EACbH,aAAa,EACbV,aAAa,EACbjE,WAAW,EACXC,aAAa,EACbjC,OAAO,EACP,IAAI,CACL;;MAEH,IAAI,CAACI,KAAK,CAACL,IAAI,CAAC,EAAE;QAChB,IAAI,CAACgH,iBAAiB,CACpB9Q,OAAO,EACPqQ,KAAK,CAACO,CAAC,CAAC,EACRL,WAAW,CAACK,CAAC,CAAC,EACdd,SAAS,EACTe,aAAa,EACbH,aAAa,EACbV,aAAa,EACbjE,WAAW,EACXC,aAAa,EACbjC,OAAO,CACR;;;GAGN;EAEO8F,YAAiB,CAAA/P,SAAA,CAAAgR,iBAAA,GAAzB,UACE9Q,OAAiC,EACjC+Q,IAAY,EACZR,WAAsB,EACtBT,SAAqC,EACrC7K,CAAS,EACTC,CAAS,EACT8K,aAAqB,EACrBjE,WAA+B,EAC/BC,aAAiC,EACjCjC,OAA2B,EAC3BiH,QAAgB;IAAhB,IAAAA,QAAA;MAAAA,QAAgB;IAAA;;IAGhB,IAAIhB,aAAa,KAAK,CAAC,EAAE;MACvB,IAAIgB,QAAQ,EAAE;QACZ,IAAI,CAACC,UAAU,CAACjR,OAAO,EAAE+Q,IAAI,EAAE9L,CAAC,EAAEC,CAAC,EAAE8G,aAAa,CAAC;OACpD,MAAM;QACL,IAAI,CAACkF,QAAQ,CAAClR,OAAO,EAAE+Q,IAAI,EAAE9L,CAAC,EAAEC,CAAC,EAAE6G,WAAW,EAAEhC,OAAO,CAAC;;MAE1D;;;IAIF,IAAMoH,gBAAgB,GAAGnR,OAAO,CAAC8P,SAAS;IAC1C9P,OAAO,CAAC8P,SAAS,GAAG,MAAM;IAE1B,IAAIsB,eAAe,GAAGnM,CAAC;IACvB,IAAI6K,SAAS,KAAK,QAAQ,IAAIA,SAAS,KAAK,QAAQ,EAAE;MACpDsB,eAAe,GAAGnM,CAAC,GAAGsL,WAAW,CAACtO,KAAK,GAAG,CAAC;KAC5C,MAAM,IAAI6N,SAAS,KAAK,OAAO,IAAIA,SAAS,KAAK,KAAK,EAAE;MACvDsB,eAAe,GAAGnM,CAAC,GAAGsL,WAAW,CAACtO,KAAK;;IAGzC,IAAMoP,WAAW,GAAGhH,KAAK,CAACiH,IAAI,CAACP,IAAI,CAAC;IACpC,IAAIQ,aAAa,GAAGvR,OAAO,CAACwR,WAAW,CAACT,IAAI,CAAC,CAAC9O,KAAK;IACnD,IAAIwP,YAAY,GAAG,CAAC;IACpB,KAAK,IAAIb,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGS,WAAW,CAACxJ,MAAM,EAAE,EAAE+I,CAAC,EAAE;MAC3C,IAAMc,WAAW,GAAGL,WAAW,CAACT,CAAC,CAAC;MAClC,IAAII,QAAQ,EAAE;QACZ,IAAI,CAACC,UAAU,CACbjR,OAAO,EACP0R,WAAW,EACXN,eAAe,EACflM,CAAC,EACD8G,aAAa,CACd;OACF,MAAM;QACL,IAAI,CAACkF,QAAQ,CACXlR,OAAO,EACP0R,WAAW,EACXN,eAAe,EACflM,CAAC,EACD6G,WAAW,EACXhC,OAAO,CACR;;MAEH0H,YAAY,GAAGzR,OAAO,CAACwR,WAAW,CAACT,IAAI,CAACY,SAAS,CAACf,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC3O,KAAK;MAC/DmP,eAAe,IAAIG,aAAa,GAAGE,YAAY,GAAGzB,aAAa;MAC/DuB,aAAa,GAAGE,YAAY;;IAG9BzR,OAAO,CAAC8P,SAAS,GAAGqB,gBAAgB;GACrC;EAEOtB,YAAA,CAAA/P,SAAA,CAAAoR,QAAQ,GAAhB,UACElR,OAAiC,EACjC+Q,IAAY,EACZ9L,CAAS,EACTC,CAAS,EACT6G,WAA+B,EAC/BhC,OAA2B;IAE3B,IAAI6H,kBAA0B;IAC9B,IAAMC,YAAY,GAAG,CAAC1H,KAAK,CAAC4B,WAAW,CAAC,IAAIA,WAAW,KAAK,CAAC;IAC7D,IAAI8F,YAAY,EAAE;MAChBD,kBAAkB,GAAG5R,OAAO,CAACoK,WAAW;MACxCpK,OAAO,CAACoK,WAAW,GAAG2B,WAAW,GAAGhC,OAAO;;IAE7C/J,OAAO,CAACkR,QAAQ,CAACH,IAAI,EAAE9L,CAAC,EAAEC,CAAC,CAAC;IAC5B,IAAI2M,YAAY,EAAE;MAChB7R,OAAO,CAACoK,WAAW,GAAGwH,kBAAkB;;GAE3C;EAEO/B,YAAU,CAAA/P,SAAA,CAAAmR,UAAA,GAAlB,UACEjR,OAAiC,EACjC+Q,IAAY,EACZ9L,CAAS,EACTC,CAAS,EACT8G,aAAiC;IAEjC,IAAI4F,kBAA0B;IAC9B,IAAMC,YAAY,GAAG,CAAC1H,KAAK,CAAC6B,aAAa,CAAC,IAAIA,aAAa,KAAK,CAAC;IACjE,IAAI6F,YAAY,EAAE;MAChBD,kBAAkB,GAAG5R,OAAO,CAACoK,WAAW;MACxCpK,OAAO,CAACoK,WAAW,GAAG4B,aAAc;;IAEtChM,OAAO,CAACiR,UAAU,CAACF,IAAI,EAAE9L,CAAC,EAAEC,CAAC,CAAC;IAC9B,IAAI2M,YAAY,EAAE;MAChB7R,OAAO,CAACoK,WAAW,GAAGwH,kBAAkB;;GAE3C;EACH,OAAC/B,YAAA;AAAD,CAAC;ACzOD,IAAAiC,YAAA,0BAAAC,MAAA;EAAkCC,SAAe,CAAAF,YAAA,EAAAC,MAAA;EAAjD,SAAAD,aAAA;;;EAAmD,OAACA,YAAA;AAAD,CAAnD,CAAkCnG,eAAe,CAAG;ACApD,IAAAsG,cAAA,0BAAAF,MAAA;EAAoCC,SAAe,CAAAC,cAAA,EAAAF,MAAA;EAAnD,SAAAE,eAAA;;;EAAqD,OAACA,cAAA;AAAD,CAArD,CAAoCtG,eAAe,CAAG;ACAtD,IAAAuG,eAAA,0BAAAH,MAAA;EAAqCC,SAAe,CAAAE,eAAA,EAAAH,MAAA;EAApD,SAAAG,gBAAA;;;EAAsD,OAACA,eAAA;AAAD,CAAtD,CAAqCvG,eAAe,CAAG;ACAvD,IAAAwG,YAAA,0BAAAJ,MAAA;EAAkCC,SAAe,CAAAG,YAAA,EAAAJ,MAAA;EAAjD,SAAAI,aAAA;;;EAAmD,OAACA,YAAA;AAAD,CAAnD,CAAkCxG,eAAe,CAAG;ACApD,IAAAyG,gBAAA,0BAAAL,MAAA;EAAsCC,SAAe,CAAAI,gBAAA,EAAAL,MAAA;EAArD,SAAAK,iBAAA;;;EAAuD,OAACA,gBAAA;AAAD,CAAvD,CAAsCzG,eAAe,CAAG;ACAxD,IAAA0G,eAAA,0BAAAN,MAAA;EAAqCC,SAAe,CAAAK,eAAA,EAAAN,MAAA;EAApD,SAAAM,gBAAA;;;EAAsD,OAACA,eAAA;AAAD,CAAtD,CAAqC1G,eAAe,CAAG;ACAvD,IAAA2G,YAAA,0BAAAP,MAAA;EAAkCC,SAAe,CAAAM,YAAA,EAAAP,MAAA;EAAjD,SAAAO,aAAA;;;EAAmD,OAACA,YAAA;AAAD,CAAnD,CAAkC3G,eAAe,CAAG;ACQpD,IAAA4G,MAAA,0BAAAR,MAAA;EAA4BC,SAG1B,CAAAO,MAAA,EAAAR,MAAA;EAGA,SAAAQ,OAAoBC,OAAkD;IAAlD,IAAAA,OAAA;MAAAA,OAAkD;IAAA;IACpE,IAAAtS,KAAA,GAAA6R,MAAK,CAAAU,IAAA,MAAE,IAAC;IADUvS,KAAO,CAAAsS,OAAA,GAAPA,OAAO;IAF3BtS,KAAI,CAAAwS,IAAA,GAAG,iBAAiB;;;EAMxBH,MAAA,CAAAzS,SAAA,CAAA0B,IAAI,GAAJ;;IACE,IAAMzC,2BAA2B,GAAAiQ,QAAA;MAC/BtM,uBAAuB,EAAE,GAAG;MAC5BC,yBAAyB,EAAE;IAAG,CAC3B,MAAI,CAAC6P,OAAO,CAChB;;IAGD,IAAM5G,SAAS,GAAG,IAAI,CAAC5L,OAAO,CAAC4L,SAAS;IAExC,IAAM+G,eAAe,GAAG,IAAIhH,eAAe,CAACC,SAAS,CAAC;IAEtD,IAAMgH,2BAA2B,IAAAnQ,EAAA,OAC/BA,EAAA,CAACkG,KAAK,CAACkK,MAAM,IAAGF,eAAe,EAC/BlQ,EAAA,CAACkG,KAAK,CAACmK,OAAO,IAAGH,eAAe,EAChClQ,EAAA,CAACkG,KAAK,CAACoK,IAAI,IAAGJ,eAAe,EAC7BlQ,EAAC,CAAAkG,KAAK,CAACqK,KAAK,IAAG,IAAI1D,aAAa,CAAC1D,SAAS,CAAC,EAC3CnJ,EAAA,CAACkG,KAAK,CAACsK,IAAI,CAAG,OAAIpD,YAAY,EAAE,EAChCpN,EAAA,CAACkG,KAAK,CAACC,IAAI,IAAG+J,eAAe,EAC7BlQ,EAAA,CAACkG,KAAK,CAACG,QAAQ,IAAG6J,eAAe,EACjClQ,EAAA,CAACkG,KAAK,CAACuK,OAAO,IAAGP,eAAe,EAChClQ,EAAA,CAACkG,KAAK,CAACE,IAAI,IAAG8J,eAAe,EAC7BlQ,EAAA,CAACkG,KAAK,CAACwK,KAAK,IAAGC,SAAS,EACxB3Q,EAAA,CAACkG,KAAK,CAAC0K,IAAI,IAAGD,SAAS,EACvB3Q,EAAA,CAACkG,KAAK,CAAC2K,IAAI,IAAGF,SAAS,E,GACxB;IAED,IAAI,CAACpT,OAAO,CAAC4S,2BAA2B,GAAGA,2BAA2B;IACtE,IAAI,CAAC5S,OAAO,CAACmI,oBAAoB,GAAGyK,2BAA2B;IAE/D,IAAI,CAACW,kBAAkB,CAAC,IAAIzU,oBAAoB,CAACC,2BAA2B,CAAC,CAAC;GAC/E;EACDwT,MAAA,CAAAzS,SAAA,CAAAwC,OAAO,GAAP;IACE,IAAI,CAACkR,yBAAyB,EAAE;IAEhC,OAAO,IAAI,CAACxT,OAAO,CAAC4S,2BAA2B;IAC/C,OAAO,IAAI,CAAC5S,OAAO,CAACmI,oBAAoB;GACzC;EACH,OAACoK,MAAA;AAAD,CAhDA,CAA4BkB,sBAAsB,CAgDjD"},"metadata":{},"sourceType":"module","externalDependencies":[]}