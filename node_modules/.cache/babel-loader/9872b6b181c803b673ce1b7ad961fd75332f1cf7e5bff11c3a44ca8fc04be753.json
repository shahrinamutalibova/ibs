{"ast":null,"code":"import { __read, __rest } from \"tslib\";\nimport { transition } from '../../../animation';\nimport { normalize, parseSeriesAttr, percentTransform, renderExtDo, scale, select, splitStyle, subStyleProps } from '../../../util';\nimport { parsePosition } from '../../title';\nimport { CLASS_NAMES } from '../constant';\nfunction getTitlePosition(mainGroup, titleGroup, attr) {\n  var _a = attr.titlePosition,\n    position = _a === void 0 ? 'lb' : _a,\n    spacing = attr.titleSpacing;\n  var pos = parsePosition(position);\n  var _b = mainGroup.node().getLocalBounds(),\n    _c = __read(_b.min, 2),\n    mainX = _c[0],\n    mainY = _c[1],\n    _d = __read(_b.halfExtents, 2),\n    mainHalfWidth = _d[0],\n    mainHalfHeight = _d[1];\n  var _e = __read(titleGroup.node().getLocalBounds().halfExtents, 2),\n    titleHalfWidth = _e[0],\n    titleHalfHeight = _e[1];\n  var _f = __read([mainX + mainHalfWidth, mainY + mainHalfHeight], 2),\n    x = _f[0],\n    y = _f[1];\n  var _g = __read(parseSeriesAttr(spacing), 4),\n    spacingTop = _g[0],\n    spacingRight = _g[1],\n    spacingBottom = _g[2],\n    spacingLeft = _g[3];\n  if (['start', 'end'].includes(position) && attr.type === 'linear') {\n    var startPos = attr.startPos,\n      endPos = attr.endPos;\n    // todo did not consider the truncate case\n    var _h = __read(position === 'start' ? [startPos, endPos] : [endPos, startPos], 2),\n      from = _h[0],\n      to = _h[1];\n    var direction = normalize([-to[0] + from[0], -to[1] + from[1]]);\n    var _j = __read(scale(direction, spacingTop), 2),\n      dx = _j[0],\n      dy = _j[1];\n    return {\n      x: from[0] + dx,\n      y: from[1] + dy\n    };\n  }\n  if (pos.includes('t')) y -= mainHalfHeight + titleHalfHeight + spacingTop;\n  if (pos.includes('r')) x += mainHalfWidth + titleHalfWidth + spacingRight;\n  if (pos.includes('l')) x -= mainHalfWidth + titleHalfWidth * 2 + spacingLeft;\n  if (pos.includes('b')) y += mainHalfHeight + titleHalfHeight * 2 + spacingBottom;\n  return {\n    x: x,\n    y: y\n  };\n}\nfunction inferTransform(n, direction, position) {\n  var node = n.cloneNode(true);\n  node.style.transform = 'scale(1, 1)';\n  node.style.transform = 'none';\n  var height = node.getBBox().height;\n  if (direction === 'vertical') {\n    if (position === 'left') return \"rotate(-90) translate(0, \".concat(height / 2, \")\");\n    if (position === 'right') return \"rotate(-90) translate(0, -\".concat(height / 2, \")\");\n  }\n  return '';\n}\nfunction applyTitleStyle(title, group, axis, attr, animate) {\n  var style = subStyleProps(attr, 'title');\n  var _a = __read(splitStyle(style), 2),\n    titleStyle = _a[0],\n    _b = _a[1],\n    specified = _b.transform,\n    groupStyle = __rest(_b, [\"transform\"]);\n  title.styles(titleStyle);\n  group.styles(groupStyle);\n  var transform = specified || inferTransform(title.node(), titleStyle.direction, titleStyle.position);\n  percentTransform(title.node(), transform);\n  var _c = getTitlePosition(\n    // @ts-ignore\n    select(axis._offscreen || axis.querySelector(CLASS_NAMES.mainGroup.class)), group, attr),\n    x = _c.x,\n    y = _c.y;\n  var animation = transition(group.node(), {\n    x: x,\n    y: y\n  }, animate);\n  percentTransform(title.node(), transform);\n  return animation;\n}\nexport function renderTitle(container, axis, attr, animate) {\n  var titleText = attr.titleText;\n  return container.selectAll(CLASS_NAMES.title.class).data([{\n    title: titleText\n  }].filter(function (d) {\n    return !!d.title;\n  }), function (d, i) {\n    return d.title;\n  }).join(function (enter) {\n    return enter.append(function () {\n      return renderExtDo(titleText);\n    }).attr('className', CLASS_NAMES.title.name).transition(function () {\n      return applyTitleStyle(select(this), container, axis, attr, animate.enter);\n    });\n  }, function (update) {\n    return update.transition(function () {\n      return applyTitleStyle(select(this), container, axis, attr, animate.update);\n    });\n  }, function (exit) {\n    return exit.remove();\n  }).transitions();\n}","map":{"version":3,"names":["transition","normalize","parseSeriesAttr","percentTransform","renderExtDo","scale","select","splitStyle","subStyleProps","parsePosition","CLASS_NAMES","getTitlePosition","mainGroup","titleGroup","attr","_a","titlePosition","position","spacing","titleSpacing","pos","_b","node","getLocalBounds","_c","__read","min","mainX","mainY","_d","halfExtents","mainHalfWidth","mainHalfHeight","_e","titleHalfWidth","titleHalfHeight","_f","x","y","_g","spacingTop","spacingRight","spacingBottom","spacingLeft","includes","type","startPos","endPos","_h","from","to","direction","_j","dx","dy","inferTransform","n","cloneNode","style","transform","height","getBBox","concat","applyTitleStyle","title","group","axis","animate","titleStyle","specified","groupStyle","__rest","styles","_offscreen","querySelector","class","animation","renderTitle","container","titleText","selectAll","data","filter","d","i","join","enter","append","name","update","exit","remove","transitions"],"sources":["ui/axis/guides/title.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}