{"ast":null,"code":"import { __assign, __extends, __read, __rest, __spreadArray } from \"tslib\";\nimport { ElementEvent } from '@antv/g';\nimport { Component } from '../../core';\nimport { Group } from '../../shapes';\nimport { BBox, classNames, hide, isHorizontal, parseSeriesAttr, renderExtDo, select, show, splitStyle, subStyleProps } from '../../util';\nimport { DEFAULT_INDICATOR_STYLE_PROPS } from './constant';\nvar CLASS_NAMES = classNames({\n  background: 'background',\n  labelGroup: 'label-group',\n  label: 'label'\n}, 'indicator');\nvar Indicator = /** @class */function (_super) {\n  __extends(Indicator, _super);\n  function Indicator(options) {\n    var _this = _super.call(this, options, DEFAULT_INDICATOR_STYLE_PROPS) || this;\n    _this.point = [0, 0];\n    _this.group = _this.appendChild(new Group({}));\n    _this.isMutationObserved = true;\n    return _this;\n  }\n  Indicator.prototype.renderBackground = function () {\n    if (!this.label) return;\n    var _a = this.attributes,\n      position = _a.position,\n      padding = _a.padding;\n    var _b = __read(parseSeriesAttr(padding), 4),\n      t = _b[0],\n      r = _b[1],\n      b = _b[2],\n      l = _b[3];\n    var _c = this.label.node().getLocalBounds(),\n      min = _c.min,\n      max = _c.max;\n    var bbox = new BBox(min[0] - l, min[1] - t, max[0] + r - min[0] + l, max[1] + b - min[1] + t);\n    var path = this.getPath(position, bbox);\n    var style = subStyleProps(this.attributes, 'background');\n    this.background = select(this.group).maybeAppendByClassName(CLASS_NAMES.background, 'path').styles(__assign(__assign({}, style), {\n      path: path\n    }));\n    this.group.appendChild(this.label.node());\n  };\n  Indicator.prototype.renderLabel = function () {\n    var _a = this.attributes,\n      formatter = _a.formatter,\n      labelText = _a.labelText;\n    var style = subStyleProps(this.attributes, 'label');\n    var _b = __read(splitStyle(style), 2),\n      _c = _b[0],\n      groupStyle = _b[1],\n      rawText = _c.text,\n      textStyle = __rest(_c, [\"text\"]);\n    this.label = select(this.group).maybeAppendByClassName(CLASS_NAMES.labelGroup, 'g').styles(groupStyle);\n    if (!labelText) return;\n    var text = this.label.maybeAppendByClassName(CLASS_NAMES.label, function () {\n      return renderExtDo(formatter(labelText));\n    }).style('text', formatter(labelText).toString());\n    text.selectAll('text').styles(textStyle);\n  };\n  Indicator.prototype.adjustLayout = function () {\n    var _a = __read(this.point, 2),\n      dx = _a[0],\n      dy = _a[1];\n    this.group.attr('x', -dx).attr('y', -dy);\n  };\n  Indicator.prototype.getPath = function (position, bbox) {\n    var r = this.attributes.radius;\n    var x = bbox.x,\n      y = bbox.y,\n      width = bbox.width,\n      height = bbox.height;\n    var pathArray = [\n    // 0 开始路径\n    ['M', x + r, y],\n    // 1 上边线\n    ['L', x + width - r, y],\n    // 2 右上角圆弧\n    ['A', r, r, 0, 0, 1, x + width, y + r],\n    // 3 右边线\n    ['L', x + width, y + height - r],\n    // 4 右下角圆弧\n    ['A', r, r, 0, 0, 1, x + width - r, y + height],\n    // 5 下边线\n    ['L', x + r, y + height],\n    // 6 左下角圆弧\n    ['A', r, r, 0, 0, 1, x, y + height - r],\n    // 7 左边线\n    ['L', x, y + r],\n    // 8 左上角圆弧\n    ['A', r, r, 0, 0, 1, x + r, y],\n    // 9 关闭路径\n    ['Z']];\n    // 将 position 反方向的边线替换为带尖角的边线\n    var revertPositionMap = {\n      top: 4,\n      right: 6,\n      bottom: 0,\n      left: 2\n    };\n    var index = revertPositionMap[position];\n    var newPath = this.createCorner([pathArray[index].slice(-2), pathArray[index + 1].slice(-2)]);\n    // 替换\n    pathArray.splice.apply(pathArray, __spreadArray([index + 1, 1], __read(newPath), false));\n    pathArray[0][0] = 'M';\n    return pathArray;\n  };\n  Indicator.prototype.createCorner = function (edge, size) {\n    if (size === void 0) {\n      size = 10;\n    }\n    // intrinsic parameter\n    var cornerScale = 0.8;\n    var isH = isHorizontal.apply(void 0, __spreadArray([], __read(edge), false));\n    var _a = __read(edge, 2),\n      _b = __read(_a[0], 2),\n      x0 = _b[0],\n      y0 = _b[1],\n      _c = __read(_a[1], 2),\n      x1 = _c[0],\n      y1 = _c[1];\n    var _d = __read(isH ? [x1 - x0, [x0, x1]] : [y1 - y0, [y0, y1]], 2),\n      len = _d[0],\n      _e = __read(_d[1], 2),\n      b0 = _e[0],\n      b1 = _e[1];\n    var hL = len / 2;\n    var sign = len / Math.abs(len);\n    var cL = size * sign;\n    var hCL = cL / 2;\n    var cS = cL * Math.sqrt(3) / 2 * cornerScale;\n    var _f = __read([b0, b0 + hL - hCL, b0 + hL, b0 + hL + hCL, b1], 5),\n      a0 = _f[0],\n      a1 = _f[1],\n      a2 = _f[2],\n      a3 = _f[3],\n      a4 = _f[4];\n    if (isH) {\n      this.point = [a2, y0 - cS];\n      return [['L', a0, y0], ['L', a1, y0], ['L', a2, y0 - cS], ['L', a3, y0], ['L', a4, y0]];\n    }\n    this.point = [x0 + cS, a2];\n    return [['L', x0, a0], ['L', x0, a1], ['L', x0 + cS, a2], ['L', x0, a3], ['L', x0, a4]];\n  };\n  Indicator.prototype.applyVisibility = function () {\n    var visibility = this.attributes.visibility;\n    if (visibility === 'hidden') hide(this);else show(this);\n  };\n  Indicator.prototype.bindEvents = function () {\n    this.label.on(ElementEvent.BOUNDS_CHANGED, this.renderBackground);\n  };\n  Indicator.prototype.render = function () {\n    this.renderLabel();\n    this.renderBackground();\n    this.adjustLayout();\n    this.applyVisibility();\n  };\n  return Indicator;\n}(Component);\nexport { Indicator };","map":{"version":3,"names":["ElementEvent","Component","Group","BBox","classNames","hide","isHorizontal","parseSeriesAttr","renderExtDo","select","show","splitStyle","subStyleProps","DEFAULT_INDICATOR_STYLE_PROPS","CLASS_NAMES","background","labelGroup","label","Indicator","_super","__extends","options","_this","call","point","group","appendChild","isMutationObserved","prototype","renderBackground","_a","attributes","position","padding","_b","__read","t","r","b","l","_c","node","getLocalBounds","min","max","bbox","path","getPath","style","maybeAppendByClassName","styles","__assign","renderLabel","formatter","labelText","groupStyle","rawText","text","textStyle","__rest","toString","selectAll","adjustLayout","dx","dy","attr","radius","x","y","width","height","pathArray","revertPositionMap","top","right","bottom","left","index","newPath","createCorner","slice","splice","apply","__spreadArray","edge","size","cornerScale","isH","x0","y0","x1","y1","_d","len","_e","b0","b1","hL","sign","Math","abs","cL","hCL","cS","sqrt","_f","a0","a1","a2","a3","a4","applyVisibility","visibility","bindEvents","on","BOUNDS_CHANGED","render"],"sources":["ui/indicator/indicator.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}