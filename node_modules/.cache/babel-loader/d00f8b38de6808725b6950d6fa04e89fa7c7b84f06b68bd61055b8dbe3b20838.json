{"ast":null,"code":"import { __extends, __spreadArray, __read } from 'tslib';\nimport { isBrowser, parsedTransformToMat4, parseTransform, DisplayObject, GradientType, computeLinearGradient, computeRadialGradient, UnitType, ElementEvent, Shape, AbstractRendererPlugin } from '@antv/g-lite';\nimport { isString } from '@antv/util';\nimport { mat4 } from 'gl-matrix';\nvar ImagePool = /** @class */function () {\n  function ImagePool(canvasConfig) {\n    this.canvasConfig = canvasConfig;\n    this.imageCache = {};\n    this.gradientCache = {};\n    this.patternCache = {};\n  }\n  ImagePool.prototype.getImageSync = function (src, callback) {\n    if (!this.imageCache[src]) {\n      this.getOrCreateImage(src).then(function (img) {\n        if (callback) {\n          callback(img);\n        }\n      });\n    } else {\n      if (callback) {\n        callback(this.imageCache[src]);\n      }\n    }\n    return this.imageCache[src];\n  };\n  ImagePool.prototype.getOrCreateImage = function (src) {\n    var _this = this;\n    if (this.imageCache[src]) {\n      return Promise.resolve(this.imageCache[src]);\n    }\n    // @see https://github.com/antvis/g/issues/938\n    var createImage = this.canvasConfig.createImage;\n    return new Promise(function (resolve, reject) {\n      var image;\n      if (createImage) {\n        image = createImage(src);\n      } else if (isBrowser) {\n        image = new window.Image();\n      }\n      if (image) {\n        image.onload = function () {\n          _this.imageCache[src] = image;\n          resolve(image);\n        };\n        image.onerror = function (ev) {\n          reject(ev);\n        };\n        image.crossOrigin = 'Anonymous';\n        image.src = src;\n      }\n    });\n  };\n  ImagePool.prototype.getOrCreatePatternSync = function (pattern, context, $offscreenCanvas, dpr, callback) {\n    var patternKey = this.generatePatternKey(pattern);\n    if (patternKey && this.patternCache[patternKey]) {\n      return this.patternCache[patternKey];\n    }\n    var image = pattern.image,\n      repetition = pattern.repetition,\n      transform = pattern.transform;\n    var src;\n    var needScaleWithDPR = false;\n    // Image URL\n    if (isString(image)) {\n      src = this.getImageSync(image, callback);\n    } else if ($offscreenCanvas) {\n      src = $offscreenCanvas;\n      needScaleWithDPR = true;\n    } else {\n      src = image;\n    }\n    // @see https://developer.mozilla.org/zh-CN/docs/Web/API/CanvasRenderingContext2D/createPattern\n    var canvasPattern = src && context.createPattern(src, repetition);\n    if (canvasPattern) {\n      var mat = void 0;\n      // @see https://developer.mozilla.org/en-US/docs/Web/API/CanvasPattern/setTransform\n      if (transform) {\n        mat = parsedTransformToMat4(parseTransform(transform), new DisplayObject({}));\n      } else {\n        mat = mat4.identity(mat4.create());\n      }\n      if (needScaleWithDPR) {\n        mat4.scale(mat, mat, [1 / dpr, 1 / dpr, 1]);\n      }\n      canvasPattern.setTransform({\n        a: mat[0],\n        b: mat[1],\n        c: mat[4],\n        d: mat[5],\n        e: mat[12],\n        f: mat[13]\n      });\n    }\n    if (patternKey && canvasPattern) {\n      this.patternCache[patternKey] = canvasPattern;\n    }\n    return canvasPattern;\n  };\n  ImagePool.prototype.getOrCreateGradient = function (params, context) {\n    var key = this.generateGradientKey(params);\n    var type = params.type,\n      steps = params.steps,\n      width = params.width,\n      height = params.height,\n      angle = params.angle,\n      cx = params.cx,\n      cy = params.cy,\n      size = params.size;\n    if (this.gradientCache[key]) {\n      return this.gradientCache[key];\n    }\n    var gradient = null;\n    if (type === GradientType.LinearGradient) {\n      var _a = computeLinearGradient(width, height, angle),\n        x1 = _a.x1,\n        y1 = _a.y1,\n        x2 = _a.x2,\n        y2 = _a.y2;\n      // @see https://developer.mozilla.org/zh-CN/docs/Web/API/CanvasRenderingContext2D/createLinearGradient\n      gradient = context.createLinearGradient(x1, y1, x2, y2);\n    } else if (type === GradientType.RadialGradient) {\n      var _b = computeRadialGradient(width, height, cx, cy, size),\n        x = _b.x,\n        y = _b.y,\n        r = _b.r;\n      // @see https://developer.mozilla.org/zh-CN/docs/Web/API/CanvasRenderingContext2D/createRadialGradient\n      gradient = context.createRadialGradient(x, y, 0, x, y, r);\n    }\n    if (gradient) {\n      steps.forEach(function (_a) {\n        var offset = _a.offset,\n          color = _a.color;\n        if (offset.unit === UnitType.kPercentage) {\n          gradient === null || gradient === void 0 ? void 0 : gradient.addColorStop(offset.value / 100, color.toString());\n        }\n      });\n      this.gradientCache[key] = gradient;\n    }\n    return this.gradientCache[key];\n  };\n  ImagePool.prototype.generateGradientKey = function (params) {\n    var type = params.type,\n      width = params.width,\n      height = params.height,\n      steps = params.steps,\n      angle = params.angle,\n      cx = params.cx,\n      cy = params.cy,\n      size = params.size;\n    return \"gradient-\".concat(type, \"-\").concat((angle === null || angle === void 0 ? void 0 : angle.toString()) || 0, \"-\").concat((cx === null || cx === void 0 ? void 0 : cx.toString()) || 0, \"-\").concat((cy === null || cy === void 0 ? void 0 : cy.toString()) || 0, \"-\").concat((size === null || size === void 0 ? void 0 : size.toString()) || 0, \"-\").concat(width, \"-\").concat(height, \"-\").concat(steps.map(function (_a) {\n      var offset = _a.offset,\n        color = _a.color;\n      return \"\".concat(offset).concat(color);\n    }).join('-'));\n  };\n  ImagePool.prototype.generatePatternKey = function (pattern) {\n    var image = pattern.image,\n      repetition = pattern.repetition;\n    // only generate cache for Image\n    if (isString(image)) {\n      return \"pattern-\".concat(image, \"-\").concat(repetition);\n    } else if (image.nodeName === 'rect') {\n      return \"pattern-\".concat(image.entity, \"-\").concat(repetition);\n    }\n  };\n  return ImagePool;\n}();\nvar LoadImagePlugin = /** @class */function () {\n  function LoadImagePlugin() {}\n  LoadImagePlugin.prototype.apply = function (context) {\n    var renderingService = context.renderingService,\n      renderingContext = context.renderingContext,\n      imagePool = context.imagePool;\n    var canvas = renderingContext.root.ownerDocument.defaultView;\n    var calculateWithAspectRatio = function (object, imageWidth, imageHeight) {\n      var _a = object.parsedStyle,\n        width = _a.width,\n        height = _a.height;\n      if (width && !height) {\n        object.setAttribute('height', imageHeight / imageWidth * width);\n      } else if (!width && height) {\n        object.setAttribute('width', imageWidth / imageHeight * height);\n      }\n    };\n    var handleMounted = function (e) {\n      var object = e.target;\n      var nodeName = object.nodeName,\n        attributes = object.attributes;\n      if (nodeName === Shape.IMAGE) {\n        var img = attributes.img,\n          keepAspectRatio_1 = attributes.keepAspectRatio;\n        if (isString(img)) {\n          imagePool.getImageSync(img, function (_a) {\n            var width = _a.width,\n              height = _a.height;\n            if (keepAspectRatio_1) {\n              calculateWithAspectRatio(object, width, height);\n            }\n            // set dirty rectangle flag\n            object.renderable.dirty = true;\n            renderingService.dirtify();\n          });\n        }\n      }\n    };\n    var handleAttributeChanged = function (e) {\n      var object = e.target;\n      var attrName = e.attrName,\n        newValue = e.newValue;\n      if (object.nodeName === Shape.IMAGE) {\n        if (attrName === 'img') {\n          if (isString(newValue)) {\n            imagePool.getOrCreateImage(newValue).then(function (_a) {\n              var width = _a.width,\n                height = _a.height;\n              if (object.attributes.keepAspectRatio) {\n                calculateWithAspectRatio(object, width, height);\n              }\n              // set dirty rectangle flag\n              object.renderable.dirty = true;\n              renderingService.dirtify();\n            });\n          }\n        }\n      }\n    };\n    renderingService.hooks.init.tap(LoadImagePlugin.tag, function () {\n      canvas.addEventListener(ElementEvent.MOUNTED, handleMounted);\n      canvas.addEventListener(ElementEvent.ATTR_MODIFIED, handleAttributeChanged);\n    });\n    renderingService.hooks.destroy.tap(LoadImagePlugin.tag, function () {\n      canvas.removeEventListener(ElementEvent.MOUNTED, handleMounted);\n      canvas.removeEventListener(ElementEvent.ATTR_MODIFIED, handleAttributeChanged);\n    });\n  };\n  LoadImagePlugin.tag = 'LoadImage';\n  return LoadImagePlugin;\n}();\nvar Plugin = /** @class */function (_super) {\n  __extends(Plugin, _super);\n  function Plugin() {\n    var _this = _super.apply(this, __spreadArray([], __read(arguments), false)) || this;\n    _this.name = 'image-loader';\n    return _this;\n  }\n  Plugin.prototype.init = function () {\n    // @ts-ignore\n    this.context.imagePool = new ImagePool(this.context.config);\n    this.addRenderingPlugin(new LoadImagePlugin());\n  };\n  Plugin.prototype.destroy = function () {\n    this.removeAllRenderingPlugins();\n  };\n  return Plugin;\n}(AbstractRendererPlugin);\nexport { ImagePool, Plugin };","map":{"version":3,"names":["ImagePool","canvasConfig","imageCache","gradientCache","patternCache","prototype","getImageSync","src","callback","getOrCreateImage","then","img","_this","Promise","resolve","createImage","reject","image","isBrowser","window","Image","onload","onerror","ev","crossOrigin","getOrCreatePatternSync","pattern","context","$offscreenCanvas","dpr","patternKey","generatePatternKey","repetition","transform","needScaleWithDPR","isString","canvasPattern","createPattern","mat","parsedTransformToMat4","parseTransform","DisplayObject","mat4","identity","create","scale","setTransform","a","b","c","d","e","f","getOrCreateGradient","params","key","generateGradientKey","type","steps","width","height","angle","cx","cy","size","gradient","GradientType","LinearGradient","_a","computeLinearGradient","x1","y1","x2","y2","createLinearGradient","RadialGradient","_b","computeRadialGradient","x","y","r","createRadialGradient","forEach","offset","color","unit","UnitType","kPercentage","addColorStop","value","toString","concat","map","join","nodeName","entity","LoadImagePlugin","apply","renderingService","renderingContext","imagePool","canvas","root","ownerDocument","defaultView","calculateWithAspectRatio","object","imageWidth","imageHeight","parsedStyle","setAttribute","handleMounted","target","attributes","Shape","IMAGE","keepAspectRatio_1","keepAspectRatio","renderable","dirty","dirtify","handleAttributeChanged","attrName","newValue","hooks","init","tap","tag","addEventListener","ElementEvent","MOUNTED","ATTR_MODIFIED","destroy","removeEventListener","Plugin","_super","__extends","name","config","addRenderingPlugin","removeAllRenderingPlugins","AbstractRendererPlugin"],"sources":["../src/packages/g-plugin-image-loader/src/ImagePool.ts","../src/packages/g-plugin-image-loader/src/LoadImagePlugin.ts","../src/packages/g-plugin-image-loader/src/index.ts"],"sourcesContent":[null,null,null],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}