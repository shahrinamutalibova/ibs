{"ast":null,"code":"import { maxIndex } from 'd3-array';\nimport { parseToRGB } from '../utils/color';\nfunction getsRGB(s) {\n  let c = s / 255;\n  c = c <= 0.03928 ? c / 12.92 : Math.pow((c + 0.055) / 1.055, 2.4);\n  return c;\n}\nfunction getL(r, g, b) {\n  return 0.2126 * getsRGB(r) + 0.7152 * getsRGB(g) + 0.0722 * getsRGB(b);\n}\n/**\n * Calculate the contrast. see https://webaim.org/resources/contrastchecker/\n * @param foreground\n * @param background\n */\nfunction contrast(foreground, background) {\n  const {\n    r,\n    g,\n    b\n  } = foreground;\n  const {\n    r: rb,\n    g: gb,\n    b: bb\n  } = background;\n  const L1 = getL(r, g, b);\n  const L2 = getL(rb, gb, bb);\n  return (Math.max(L1, L2) + 0.05) / (Math.min(L1, L2) + 0.05);\n}\n/**\n * Reverse color for max contrast.\n */\nfunction mostContrast(color, palette) {\n  const i = maxIndex(palette, c => contrast(color, parseToRGB(c)));\n  return palette[i];\n}\n/**\n * Reverse the label color when the contrast is lower then `threshold`.\n * The default value of `threshold` is 4.5.\n * More about contract, see https://webaim.org/resources/contrastchecker/\n */\nexport const ContrastReverse = options => {\n  const {\n    threshold = 4.5,\n    palette = ['#000', '#fff']\n  } = options;\n  return labels => {\n    labels.forEach(l => {\n      const background = l.attr('dependentElement').parsedStyle.fill;\n      const foreground = l.parsedStyle.fill;\n      const c = contrast(foreground, background);\n      if (c < threshold) l.attr('fill', mostContrast(background, palette));\n    });\n    return labels;\n  };\n};","map":{"version":3,"names":["maxIndex","parseToRGB","getsRGB","s","c","Math","pow","getL","r","g","b","contrast","foreground","background","rb","gb","bb","L1","L2","max","min","mostContrast","color","palette","i","ContrastReverse","options","threshold","labels","forEach","l","attr","parsedStyle","fill"],"sources":["label-transform/contrastReverse.ts"],"sourcesContent":[null],"mappings":"AACA,SAASA,QAAQ,QAAQ,UAAU;AAGnC,SAASC,UAAU,QAAQ,gBAAgB;AAO3C,SAASC,OAAOA,CAACC,CAAS;EACxB,IAAIC,CAAC,GAAGD,CAAC,GAAG,GAAG;EACfC,CAAC,GAAGA,CAAC,IAAI,OAAO,GAAGA,CAAC,GAAG,KAAK,GAAGC,IAAI,CAACC,GAAG,CAAC,CAACF,CAAC,GAAG,KAAK,IAAI,KAAK,EAAE,GAAG,CAAC;EACjE,OAAOA,CAAC;AACV;AAEA,SAASG,IAAIA,CAACC,CAAS,EAAEC,CAAS,EAAEC,CAAS;EAC3C,OAAO,MAAM,GAAGR,OAAO,CAACM,CAAC,CAAC,GAAG,MAAM,GAAGN,OAAO,CAACO,CAAC,CAAC,GAAG,MAAM,GAAGP,OAAO,CAACQ,CAAC,CAAC;AACxE;AAEA;;;;;AAKA,SAASC,QAAQA,CAACC,UAAU,EAAEC,UAAU;EACtC,MAAM;IAAEL,CAAC;IAAEC,CAAC;IAAEC;EAAC,CAAE,GAAGE,UAAU;EAC9B,MAAM;IAAEJ,CAAC,EAAEM,EAAE;IAAEL,CAAC,EAAEM,EAAE;IAAEL,CAAC,EAAEM;EAAE,CAAE,GAAGH,UAAU;EAC1C,MAAMI,EAAE,GAAGV,IAAI,CAACC,CAAC,EAAEC,CAAC,EAAEC,CAAC,CAAC;EACxB,MAAMQ,EAAE,GAAGX,IAAI,CAACO,EAAE,EAAEC,EAAE,EAAEC,EAAE,CAAC;EAC3B,OAAO,CAACX,IAAI,CAACc,GAAG,CAACF,EAAE,EAAEC,EAAE,CAAC,GAAG,IAAI,KAAKb,IAAI,CAACe,GAAG,CAACH,EAAE,EAAEC,EAAE,CAAC,GAAG,IAAI,CAAC;AAC9D;AAEA;;;AAGA,SAASG,YAAYA,CAACC,KAAK,EAAEC,OAAiB;EAC5C,MAAMC,CAAC,GAAGxB,QAAQ,CAACuB,OAAO,EAAGnB,CAAC,IAAKO,QAAQ,CAACW,KAAK,EAAErB,UAAU,CAACG,CAAC,CAAC,CAAC,CAAC;EAClE,OAAOmB,OAAO,CAACC,CAAC,CAAC;AACnB;AAEA;;;;;AAKA,OAAO,MAAMC,eAAe,GAAiCC,OAAO,IAAI;EACtE,MAAM;IAAEC,SAAS,GAAG,GAAG;IAAEJ,OAAO,GAAG,CAAC,MAAM,EAAE,MAAM;EAAC,CAAE,GAAGG,OAAO;EAC/D,OAAQE,MAAuB,IAAI;IACjCA,MAAM,CAACC,OAAO,CAAEC,CAAC,IAAI;MACnB,MAAMjB,UAAU,GAAGiB,CAAC,CAACC,IAAI,CAAC,kBAAkB,CAAC,CAACC,WAAW,CAACC,IAAI;MAC9D,MAAMrB,UAAU,GAAGkB,CAAC,CAACE,WAAW,CAACC,IAAI;MACrC,MAAM7B,CAAC,GAAGO,QAAQ,CAACC,UAAU,EAAEC,UAAU,CAAC;MAC1C,IAAIT,CAAC,GAAGuB,SAAS,EAAEG,CAAC,CAACC,IAAI,CAAC,MAAM,EAAEV,YAAY,CAACR,UAAU,EAAEU,OAAO,CAAC,CAAC;IACtE,CAAC,CAAC;IACF,OAAOK,MAAM;EACf,CAAC;AACH,CAAC"},"metadata":{},"sourceType":"module","externalDependencies":[]}