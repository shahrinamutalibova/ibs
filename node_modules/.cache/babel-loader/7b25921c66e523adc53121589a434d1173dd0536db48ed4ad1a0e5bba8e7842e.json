{"ast":null,"code":"import { __awaiter, __generator, __values, __read, __extends, __spreadArray } from 'tslib';\nimport { Point, findClosestClipPathTarget, isFillOrStrokeAffected, getOrCalculatePathTotalLength, Shape, AbstractRendererPlugin } from '@antv/g-lite';\nimport { vec3, mat4 } from 'gl-matrix';\nimport { distance, linePointToLine, cubicPointDistance, quadPointDistance } from '@antv/g-math';\nimport { arcToCubic, clamp } from '@antv/util';\nvar tmpVec3a = vec3.create();\nvar tmpVec3b = vec3.create();\nvar tmpVec3c = vec3.create();\nvar tmpMat4 = mat4.create();\n/**\n * pick shape(s) with Mouse/Touch event\n *\n * 1. find AABB with r-tree\n * 2. do math calculation with geometry in an accurate way\n */\nvar CanvasPickerPlugin = /** @class */function () {\n  function CanvasPickerPlugin() {\n    var _this = this;\n    this.isHit = function (displayObject, position, worldTransform, isClipPath) {\n      // use picker for current shape's type\n      var pick = _this.context.pointInPathPickerFactory[displayObject.nodeName];\n      if (pick) {\n        // invert with world matrix\n        var invertWorldMat = mat4.invert(tmpMat4, worldTransform);\n        // transform client position to local space, do picking in local space\n        var localPosition = vec3.transformMat4(tmpVec3b, vec3.set(tmpVec3c, position[0], position[1], 0), invertWorldMat);\n        // account for anchor\n        var halfExtents = displayObject.getGeometryBounds().halfExtents;\n        var anchor = displayObject.parsedStyle.anchor;\n        localPosition[0] += (anchor && anchor[0] || 0) * halfExtents[0] * 2;\n        localPosition[1] += (anchor && anchor[1] || 0) * halfExtents[1] * 2;\n        if (pick(displayObject, new Point(localPosition[0], localPosition[1]), isClipPath, _this.isPointInPath, _this.context, _this.runtime)) {\n          return true;\n        }\n      }\n      return false;\n    };\n    /**\n     * use native picking method\n     * @see https://developer.mozilla.org/zh-CN/docs/Web/API/CanvasRenderingContext2D/isPointInPath\n     */\n    this.isPointInPath = function (displayObject, position) {\n      var context = _this.runtime.offscreenCanvasCreator.getOrCreateContext(_this.context.config.offscreenCanvas);\n      var generatePath = _this.context.pathGeneratorFactory[displayObject.nodeName];\n      if (generatePath) {\n        context.beginPath();\n        generatePath(context, displayObject.parsedStyle);\n        context.closePath();\n      }\n      return context.isPointInPath(position.x, position.y);\n    };\n  }\n  CanvasPickerPlugin.prototype.apply = function (context, runtime) {\n    var _this = this;\n    var _a;\n    var renderingService = context.renderingService,\n      renderingContext = context.renderingContext;\n    this.context = context;\n    this.runtime = runtime;\n    var document = (_a = renderingContext.root) === null || _a === void 0 ? void 0 : _a.ownerDocument;\n    renderingService.hooks.pick.tapPromise(CanvasPickerPlugin.tag, function (result) {\n      return __awaiter(_this, void 0, void 0, function () {\n        return __generator(this, function (_a) {\n          return [2 /*return*/, this.pick(document, result)];\n        });\n      });\n    });\n    renderingService.hooks.pickSync.tap(CanvasPickerPlugin.tag, function (result) {\n      return _this.pick(document, result);\n    });\n  };\n  CanvasPickerPlugin.prototype.pick = function (document, result) {\n    var e_1, _a;\n    var topmost = result.topmost,\n      _b = result.position,\n      x = _b.x,\n      y = _b.y;\n    // position in world space\n    var position = vec3.set(tmpVec3a, x, y, 0);\n    // query by AABB first with spatial index(r-tree)\n    var hitTestList = document.elementsFromBBox(position[0], position[1], position[0], position[1]);\n    // test with clip path & origin shape\n    // @see https://github.com/antvis/g/issues/1064\n    var pickedDisplayObjects = [];\n    try {\n      for (var hitTestList_1 = __values(hitTestList), hitTestList_1_1 = hitTestList_1.next(); !hitTestList_1_1.done; hitTestList_1_1 = hitTestList_1.next()) {\n        var displayObject = hitTestList_1_1.value;\n        var worldTransform = displayObject.getWorldTransform();\n        var isHitOriginShape = this.isHit(displayObject, position, worldTransform, false);\n        if (isHitOriginShape) {\n          // should look up in the ancestor node\n          var clipped = findClosestClipPathTarget(displayObject);\n          if (clipped) {\n            var clipPath = clipped.parsedStyle.clipPath;\n            var isHitClipPath = this.isHit(clipPath, position, clipPath.getWorldTransform(), true);\n            if (isHitClipPath) {\n              if (topmost) {\n                result.picked = [displayObject];\n                return result;\n              } else {\n                pickedDisplayObjects.push(displayObject);\n              }\n            }\n          } else {\n            if (topmost) {\n              result.picked = [displayObject];\n              return result;\n            } else {\n              pickedDisplayObjects.push(displayObject);\n            }\n          }\n        }\n      }\n    } catch (e_1_1) {\n      e_1 = {\n        error: e_1_1\n      };\n    } finally {\n      try {\n        if (hitTestList_1_1 && !hitTestList_1_1.done && (_a = hitTestList_1.return)) _a.call(hitTestList_1);\n      } finally {\n        if (e_1) throw e_1.error;\n      }\n    }\n    result.picked = pickedDisplayObjects;\n    return result;\n  };\n  CanvasPickerPlugin.tag = 'CanvasPicker';\n  return CanvasPickerPlugin;\n}();\nfunction isPointInPath$7(displayObject, position, isClipPath) {\n  var _a = displayObject.parsedStyle,\n    r = _a.r,\n    fill = _a.fill,\n    stroke = _a.stroke,\n    lineWidth = _a.lineWidth,\n    increasedLineWidthForHitTesting = _a.increasedLineWidthForHitTesting,\n    pointerEvents = _a.pointerEvents;\n  var halfLineWidth = ((lineWidth || 0) + (increasedLineWidthForHitTesting || 0)) / 2;\n  var absDistance = distance(r, r, position.x, position.y);\n  var _b = __read(isFillOrStrokeAffected(pointerEvents, fill, stroke), 2),\n    hasFill = _b[0],\n    hasStroke = _b[1];\n  if (hasFill && hasStroke || isClipPath) {\n    return absDistance <= r + halfLineWidth;\n  }\n  if (hasFill) {\n    return absDistance <= r;\n  }\n  if (hasStroke) {\n    return absDistance >= r - halfLineWidth && absDistance <= r + halfLineWidth;\n  }\n  return false;\n}\nfunction ellipseDistance(squareX, squareY, rx, ry) {\n  return squareX / (rx * rx) + squareY / (ry * ry);\n}\nfunction isPointInPath$6(displayObject, position, isClipPath) {\n  var _a = displayObject.parsedStyle,\n    rx = _a.rx,\n    ry = _a.ry,\n    fill = _a.fill,\n    stroke = _a.stroke,\n    lineWidth = _a.lineWidth,\n    increasedLineWidthForHitTesting = _a.increasedLineWidthForHitTesting,\n    pointerEvents = _a.pointerEvents;\n  var x = position.x,\n    y = position.y;\n  var _b = __read(isFillOrStrokeAffected(pointerEvents, fill, stroke), 2),\n    hasFill = _b[0],\n    hasStroke = _b[1];\n  var halfLineWith = ((lineWidth || 0) + (increasedLineWidthForHitTesting || 0)) / 2;\n  var squareX = (x - rx) * (x - rx);\n  var squareY = (y - ry) * (y - ry);\n  // 使用椭圆的公式： x*x/rx*rx + y*y/ry*ry = 1;\n  if (hasFill && hasStroke || isClipPath) {\n    return ellipseDistance(squareX, squareY, rx + halfLineWith, ry + halfLineWith) <= 1;\n  }\n  if (hasFill) {\n    return ellipseDistance(squareX, squareY, rx, ry) <= 1;\n  }\n  if (hasStroke) {\n    return ellipseDistance(squareX, squareY, rx - halfLineWith, ry - halfLineWith) >= 1 && ellipseDistance(squareX, squareY, rx + halfLineWith, ry + halfLineWith) <= 1;\n  }\n  return false;\n}\nfunction inBox(minX, minY, width, height, x, y) {\n  return x >= minX && x <= minX + width && y >= minY && y <= minY + height;\n}\nfunction inRect(minX, minY, width, height, lineWidth, x, y) {\n  var halfWidth = lineWidth / 2;\n  // 将四个边看做矩形来检测，比边的检测算法要快\n  return inBox(minX - halfWidth, minY - halfWidth, width, lineWidth, x, y) ||\n  // 上边\n  inBox(minX + width - halfWidth, minY - halfWidth, lineWidth, height, x, y) ||\n  // 右边\n  inBox(minX + halfWidth, minY + height - halfWidth, width, lineWidth, x, y) ||\n  // 下边\n  inBox(minX - halfWidth, minY + halfWidth, lineWidth, height, x, y); // 左边\n}\nfunction inArc(cx, cy, r, startAngle, endAngle, lineWidth, x, y) {\n  var angle = (Math.atan2(y - cy, x - cx) + Math.PI * 2) % (Math.PI * 2); // 转换到 0 - 2 * Math.PI 之间\n  // if (angle < startAngle || angle > endAngle) {\n  //   return false;\n  // }\n  var point = {\n    x: cx + r * Math.cos(angle),\n    y: cy + r * Math.sin(angle)\n  };\n  return distance(point.x, point.y, x, y) <= lineWidth / 2;\n}\nfunction inLine(x1, y1, x2, y2, lineWidth, x, y) {\n  var minX = Math.min(x1, x2);\n  var maxX = Math.max(x1, x2);\n  var minY = Math.min(y1, y2);\n  var maxY = Math.max(y1, y2);\n  var halfWidth = lineWidth / 2;\n  // 因为目前的方案是计算点到直线的距离，而有可能会在延长线上，所以要先判断是否在包围盒内\n  // 这种方案会在水平或者竖直的情况下载线的延长线上有半 lineWidth 的误差\n  if (!(x >= minX - halfWidth && x <= maxX + halfWidth && y >= minY - halfWidth && y <= maxY + halfWidth)) {\n    return false;\n  }\n  // 因为已经计算了包围盒，所以仅需要计算到直线的距离即可，可以显著提升性能\n  return linePointToLine(x1, y1, x2, y2, x, y) <= lineWidth / 2;\n}\nfunction inPolyline(points, lineWidth, x, y, isClose) {\n  var count = points.length;\n  if (count < 2) {\n    return false;\n  }\n  for (var i = 0; i < count - 1; i++) {\n    var x1 = points[i][0];\n    var y1 = points[i][1];\n    var x2 = points[i + 1][0];\n    var y2 = points[i + 1][1];\n    if (inLine(x1, y1, x2, y2, lineWidth, x, y)) {\n      return true;\n    }\n  }\n  // 如果封闭，则计算起始点和结束点的边\n  if (isClose) {\n    var first = points[0];\n    var last = points[count - 1];\n    if (inLine(first[0], first[1], last[0], last[1], lineWidth, x, y)) {\n      return true;\n    }\n  }\n  return false;\n}\n// 多边形的射线检测，参考：https://blog.csdn.net/WilliamSun0122/article/details/77994526\nvar tolerance = 1e-6;\n// 三态函数，判断两个double在eps精度下的大小关系\nfunction dcmp(x) {\n  if (Math.abs(x) < tolerance) {\n    return 0;\n  }\n  return x < 0 ? -1 : 1;\n}\n// 判断点Q是否在p1和p2的线段上\nfunction onSegment(p1, p2, q) {\n  if ((q[0] - p1[0]) * (p2[1] - p1[1]) === (p2[0] - p1[0]) * (q[1] - p1[1]) && Math.min(p1[0], p2[0]) <= q[0] && q[0] <= Math.max(p1[0], p2[0]) && Math.min(p1[1], p2[1]) <= q[1] && q[1] <= Math.max(p1[1], p2[1])) {\n    return true;\n  }\n  return false;\n}\n// 判断点P在多边形内-射线法\nfunction inPolygon(points, x, y) {\n  var isHit = false;\n  var n = points.length;\n  if (n <= 2) {\n    // svg 中点小于 3 个时，不显示，也无法被拾取\n    return false;\n  }\n  for (var i = 0; i < n; i++) {\n    var p1 = points[i];\n    var p2 = points[(i + 1) % n];\n    if (onSegment(p1, p2, [x, y])) {\n      // 点在多边形一条边上\n      return true;\n    }\n    // 前一个判断min(p1[1],p2[1])<P.y<=max(p1[1],p2[1])\n    // 后一个判断被测点 在 射线与边交点 的左边\n    if (dcmp(p1[1] - y) > 0 !== dcmp(p2[1] - y) > 0 && dcmp(x - (y - p1[1]) * (p1[0] - p2[0]) / (p1[1] - p2[1]) - p1[0]) < 0) {\n      isHit = !isHit;\n    }\n  }\n  return isHit;\n}\nfunction inPolygons(polygons, x, y) {\n  var isHit = false;\n  for (var i = 0; i < polygons.length; i++) {\n    var points = polygons[i];\n    isHit = inPolygon(points, x, y);\n    if (isHit) {\n      break;\n    }\n  }\n  return isHit;\n}\nfunction isPointInPath$5(displayObject, position, isClipPath) {\n  var _a = displayObject.parsedStyle,\n    x1 = _a.x1,\n    y1 = _a.y1,\n    x2 = _a.x2,\n    y2 = _a.y2,\n    lineWidth = _a.lineWidth,\n    increasedLineWidthForHitTesting = _a.increasedLineWidthForHitTesting,\n    _b = _a.defX,\n    x = _b === void 0 ? 0 : _b,\n    _c = _a.defY,\n    y = _c === void 0 ? 0 : _c,\n    pointerEvents = _a.pointerEvents,\n    fill = _a.fill,\n    stroke = _a.stroke;\n  var _d = __read(isFillOrStrokeAffected(pointerEvents, fill, stroke), 2),\n    hasStroke = _d[1];\n  if (!hasStroke && !isClipPath || !lineWidth) {\n    return false;\n  }\n  return inLine(x1, y1, x2, y2, (lineWidth || 0) + (increasedLineWidthForHitTesting || 0), position.x + x, position.y + y);\n}\n\n// TODO: replace it with method in @antv/util\nfunction isPointInStroke(segments, lineWidth, px, py, length) {\n  var isHit = false;\n  var halfWidth = lineWidth / 2;\n  for (var i = 0; i < segments.length; i++) {\n    var segment = segments[i];\n    var currentPoint = segment.currentPoint,\n      params = segment.params,\n      prePoint = segment.prePoint,\n      box = segment.box;\n    // 如果在前面已经生成过包围盒，直接按照包围盒计算\n    if (box && !inBox(box.x - halfWidth, box.y - halfWidth, box.width + lineWidth, box.height + lineWidth, px, py)) {\n      continue;\n    }\n    switch (segment.command) {\n      // L 和 Z 都是直线， M 不进行拾取\n      case 'L':\n      case 'Z':\n        isHit = inLine(prePoint[0], prePoint[1], currentPoint[0], currentPoint[1], lineWidth, px, py);\n        if (isHit) {\n          return true;\n        }\n        break;\n      case 'Q':\n        var qDistance = quadPointDistance(prePoint[0], prePoint[1], params[1], params[2], params[3], params[4], px, py);\n        isHit = qDistance <= lineWidth / 2;\n        if (isHit) {\n          return true;\n        }\n        break;\n      case 'C':\n        var cDistance = cubicPointDistance(prePoint[0],\n        // 上一段结束位置, 即 C 的起始点\n        prePoint[1], params[1],\n        // 'C' 的参数，1、2 为第一个控制点，3、4 为第二个控制点，5、6 为结束点\n        params[2], params[3], params[4], params[5], params[6], px, py, length);\n        isHit = cDistance <= lineWidth / 2;\n        if (isHit) {\n          return true;\n        }\n        break;\n      case 'A':\n        // cache conversion result\n        if (!segment.cubicParams) {\n          segment.cubicParams = arcToCubic(prePoint[0], prePoint[1], params[1], params[2], params[3], params[4], params[5], params[6], params[7], undefined);\n        }\n        var args = segment.cubicParams;\n        // fixArc\n        var prePointInCubic = prePoint;\n        for (var i_1 = 0; i_1 < args.length; i_1 += 6) {\n          var cDistance_1 = cubicPointDistance(prePointInCubic[0],\n          // 上一段结束位置, 即 C 的起始点\n          prePointInCubic[1], args[i_1], args[i_1 + 1], args[i_1 + 2], args[i_1 + 3], args[i_1 + 4], args[i_1 + 5], px, py, length);\n          prePointInCubic = [args[i_1 + 4], args[i_1 + 5]];\n          isHit = cDistance_1 <= lineWidth / 2;\n          if (isHit) {\n            return true;\n          }\n        }\n        break;\n    }\n  }\n  return isHit;\n}\nfunction isPointInPath$4(displayObject, position, isClipPath, isPointInPath, renderingPluginContext, runtime) {\n  var _a = displayObject.parsedStyle,\n    lineWidth = _a.lineWidth,\n    increasedLineWidthForHitTesting = _a.increasedLineWidthForHitTesting,\n    stroke = _a.stroke,\n    fill = _a.fill,\n    _b = _a.defX,\n    x = _b === void 0 ? 0 : _b,\n    _c = _a.defY,\n    y = _c === void 0 ? 0 : _c,\n    path = _a.path,\n    pointerEvents = _a.pointerEvents;\n  var segments = path.segments,\n    hasArc = path.hasArc,\n    polylines = path.polylines,\n    polygons = path.polygons;\n  var _d = __read(isFillOrStrokeAffected(pointerEvents,\n    // Only a closed path can be filled.\n    (polygons === null || polygons === void 0 ? void 0 : polygons.length) && fill, stroke), 2),\n    hasFill = _d[0],\n    hasStroke = _d[1];\n  var totalLength = getOrCalculatePathTotalLength(displayObject);\n  var isHit = false;\n  if (hasFill || isClipPath) {\n    if (hasArc) {\n      // 存在曲线时，暂时使用 canvas 的 api 计算，后续可以进行多边形切割\n      isHit = isPointInPath(displayObject, position);\n    } else {\n      // 提取出来的多边形包含闭合的和非闭合的，在这里统一按照多边形处理\n      isHit = inPolygons(polygons, position.x + x, position.y + y) || inPolygons(polylines, position.x + x, position.y + y);\n    }\n    return isHit;\n  } else if (hasStroke || isClipPath) {\n    isHit = isPointInStroke(segments, (lineWidth || 0) + (increasedLineWidthForHitTesting || 0), position.x + x, position.y + y, totalLength);\n  }\n  return isHit;\n}\nfunction isPointInPath$3(displayObject, position, isClipPath) {\n  var _a = displayObject.parsedStyle,\n    stroke = _a.stroke,\n    fill = _a.fill,\n    lineWidth = _a.lineWidth,\n    increasedLineWidthForHitTesting = _a.increasedLineWidthForHitTesting,\n    points = _a.points,\n    _b = _a.defX,\n    x = _b === void 0 ? 0 : _b,\n    _c = _a.defY,\n    y = _c === void 0 ? 0 : _c,\n    pointerEvents = _a.pointerEvents;\n  var _d = __read(isFillOrStrokeAffected(pointerEvents, fill, stroke), 2),\n    hasFill = _d[0],\n    hasStroke = _d[1];\n  var isHit = false;\n  if (hasStroke || isClipPath) {\n    isHit = inPolyline(points.points, (lineWidth || 0) + (increasedLineWidthForHitTesting || 0), position.x + x, position.y + y, true);\n  }\n  if (!isHit && (hasFill || isClipPath)) {\n    isHit = inPolygon(points.points, position.x + x, position.y + y);\n  }\n  return isHit;\n}\nfunction isPointInPath$2(displayObject, position, isClipPath) {\n  var _a = displayObject.parsedStyle,\n    lineWidth = _a.lineWidth,\n    increasedLineWidthForHitTesting = _a.increasedLineWidthForHitTesting,\n    points = _a.points,\n    _b = _a.defX,\n    x = _b === void 0 ? 0 : _b,\n    _c = _a.defY,\n    y = _c === void 0 ? 0 : _c,\n    pointerEvents = _a.pointerEvents,\n    fill = _a.fill,\n    stroke = _a.stroke;\n  var _d = __read(isFillOrStrokeAffected(pointerEvents, fill, stroke), 2),\n    hasStroke = _d[1];\n  if (!hasStroke && !isClipPath || !lineWidth) {\n    return false;\n  }\n  return inPolyline(points.points, (lineWidth || 0) + (increasedLineWidthForHitTesting || 0), position.x + x, position.y + y, false);\n}\nfunction isPointInPath$1(displayObject, position, isClipPath, isPointInPath, runtime) {\n  var _a = displayObject.parsedStyle,\n    radius = _a.radius,\n    fill = _a.fill,\n    stroke = _a.stroke,\n    lineWidth = _a.lineWidth,\n    increasedLineWidthForHitTesting = _a.increasedLineWidthForHitTesting,\n    width = _a.width,\n    height = _a.height,\n    pointerEvents = _a.pointerEvents;\n  var _b = __read(isFillOrStrokeAffected(pointerEvents, fill, stroke), 2),\n    hasFill = _b[0],\n    hasStroke = _b[1];\n  var hasRadius = radius && radius.some(function (r) {\n    return r !== 0;\n  });\n  var lineWidthForHitTesting = (lineWidth || 0) + (increasedLineWidthForHitTesting || 0);\n  // 无圆角时的策略\n  if (!hasRadius) {\n    var halfWidth = lineWidthForHitTesting / 2;\n    // 同时填充和带有边框\n    if (hasFill && hasStroke || isClipPath) {\n      return inBox(0 - halfWidth, 0 - halfWidth, width + halfWidth, height + halfWidth, position.x, position.y);\n    }\n    // 仅填充\n    if (hasFill) {\n      return inBox(0, 0, width, height, position.x, position.y);\n    }\n    if (hasStroke) {\n      return inRect(0, 0, width, height, lineWidthForHitTesting, position.x, position.y);\n    }\n  } else {\n    var isHit = false;\n    if (hasStroke || isClipPath) {\n      isHit = inRectWithRadius(0, 0, width, height, radius.map(function (r) {\n        return clamp(r, 0, Math.min(Math.abs(width) / 2, Math.abs(height) / 2));\n      }), lineWidthForHitTesting, position.x, position.y);\n    }\n    // 仅填充时带有圆角的矩形直接通过图形拾取\n    // 以后可以改成纯数学的近似拾取，将圆弧切割成多边形\n    if (!isHit && (hasFill || isClipPath)) {\n      isHit = isPointInPath(displayObject, position);\n    }\n    return isHit;\n  }\n  return false;\n}\nfunction inRectWithRadius(minX, minY, width, height, radiusArray, lineWidth, x, y) {\n  var _a = __read(radiusArray, 4),\n    tlr = _a[0],\n    trr = _a[1],\n    brr = _a[2],\n    blr = _a[3];\n  return inLine(minX + tlr, minY, minX + width - trr, minY, lineWidth, x, y) || inLine(minX + width, minY + trr, minX + width, minY + height - brr, lineWidth, x, y) || inLine(minX + width - brr, minY + height, minX + blr, minY + height, lineWidth, x, y) || inLine(minX, minY + height - blr, minX, minY + tlr, lineWidth, x, y) || inArc(minX + width - trr, minY + trr, trr, 1.5 * Math.PI, 2 * Math.PI, lineWidth, x, y) || inArc(minX + width - brr, minY + height - brr, brr, 0, 0.5 * Math.PI, lineWidth, x, y) || inArc(minX + blr, minY + height - blr, blr, 0.5 * Math.PI, Math.PI, lineWidth, x, y) || inArc(minX + tlr, minY + tlr, tlr, Math.PI, 1.5 * Math.PI, lineWidth, x, y);\n}\nfunction isPointInPath(displayObject, position, isClipPath, isPointInPath, renderingPluginContext, runtime) {\n  var _a = displayObject.parsedStyle,\n    pointerEvents = _a.pointerEvents,\n    width = _a.width,\n    height = _a.height;\n  if (pointerEvents === 'non-transparent-pixel') {\n    var offscreenCanvas = renderingPluginContext.config.offscreenCanvas;\n    var canvas = runtime.offscreenCanvasCreator.getOrCreateCanvas(offscreenCanvas);\n    var context = runtime.offscreenCanvasCreator.getOrCreateContext(offscreenCanvas, {\n      willReadFrequently: true\n    });\n    canvas.width = width;\n    canvas.height = height;\n    renderingPluginContext.defaultStyleRendererFactory[Shape.IMAGE].render(context, displayObject.parsedStyle, displayObject, undefined, undefined, undefined);\n    var imagedata = context.getImageData(position.x, position.y, 1, 1).data;\n    return imagedata.every(function (component) {\n      return component !== 0;\n    });\n  }\n  return true;\n}\nvar Plugin = /** @class */function (_super) {\n  __extends(Plugin, _super);\n  function Plugin() {\n    var _this = _super.apply(this, __spreadArray([], __read(arguments), false)) || this;\n    _this.name = 'canvas-picker';\n    return _this;\n  }\n  Plugin.prototype.init = function () {\n    var _a;\n    var trueFunc = function () {\n      return true;\n    };\n    var pointInPathPickerFactory = (_a = {}, _a[Shape.CIRCLE] = isPointInPath$7, _a[Shape.ELLIPSE] = isPointInPath$6, _a[Shape.RECT] = isPointInPath$1, _a[Shape.LINE] = isPointInPath$5, _a[Shape.POLYLINE] = isPointInPath$2, _a[Shape.POLYGON] = isPointInPath$3, _a[Shape.PATH] = isPointInPath$4, _a[Shape.TEXT] = trueFunc, _a[Shape.GROUP] = null, _a[Shape.IMAGE] = isPointInPath, _a[Shape.HTML] = null, _a[Shape.MESH] = null, _a);\n    // @ts-ignore\n    this.context.pointInPathPickerFactory = pointInPathPickerFactory;\n    this.addRenderingPlugin(new CanvasPickerPlugin());\n  };\n  Plugin.prototype.destroy = function () {\n    // @ts-ignore\n    delete this.context.pointInPathPickerFactory;\n    this.removeAllRenderingPlugins();\n  };\n  return Plugin;\n}(AbstractRendererPlugin);\nexport { Plugin };","map":{"version":3,"names":["tmpVec3a","vec3","create","tmpVec3b","tmpVec3c","tmpMat4","mat4","CanvasPickerPlugin","_this","isHit","displayObject","position","worldTransform","isClipPath","pick","context","pointInPathPickerFactory","nodeName","invertWorldMat","invert","localPosition","transformMat4","set","halfExtents","getGeometryBounds","anchor","parsedStyle","Point","isPointInPath","runtime","offscreenCanvasCreator","getOrCreateContext","config","offscreenCanvas","generatePath","pathGeneratorFactory","beginPath","closePath","x","y","prototype","apply","renderingService","renderingContext","document","_a","root","ownerDocument","hooks","tapPromise","tag","result","__awaiter","pickSync","tap","topmost","_b","hitTestList","elementsFromBBox","pickedDisplayObjects","hitTestList_1","__values","hitTestList_1_1","next","done","value","getWorldTransform","isHitOriginShape","clipped","findClosestClipPathTarget","clipPath","isHitClipPath","picked","push","isPointInPath$7","r","fill","stroke","lineWidth","increasedLineWidthForHitTesting","pointerEvents","halfLineWidth","absDistance","distance","__read","isFillOrStrokeAffected","hasFill","hasStroke","ellipseDistance","squareX","squareY","rx","ry","isPointInPath$6","halfLineWith","inBox","minX","minY","width","height","inRect","halfWidth","inArc","cx","cy","startAngle","endAngle","angle","Math","atan2","PI","point","cos","sin","inLine","x1","y1","x2","y2","min","maxX","max","maxY","linePointToLine","inPolyline","points","isClose","count","length","i","first","last","tolerance","dcmp","abs","onSegment","p1","p2","q","inPolygon","n","inPolygons","polygons","isPointInPath$5","defX","_c","defY","_d","isPointInStroke","segments","px","py","segment","currentPoint","params","prePoint","box","command","qDistance","quadPointDistance","cDistance","cubicPointDistance","cubicParams","arcToCubic","undefined","args","prePointInCubic","i_1","cDistance_1","isPointInPath$4","renderingPluginContext","path","hasArc","polylines","totalLength","getOrCalculatePathTotalLength","isPointInPath$3","isPointInPath$2","isPointInPath$1","radius","hasRadius","some","lineWidthForHitTesting","inRectWithRadius","map","clamp","radiusArray","tlr","trr","brr","blr","canvas","getOrCreateCanvas","willReadFrequently","defaultStyleRendererFactory","Shape","IMAGE","render","imagedata","getImageData","data","every","component","Plugin","_super","__extends","name","init","trueFunc","CIRCLE","ELLIPSE","RECT","LINE","POLYLINE","POLYGON","PATH","TEXT","GROUP","HTML","MESH","addRenderingPlugin","destroy","removeAllRenderingPlugins","AbstractRendererPlugin"],"sources":["../src/packages/g-plugin-canvas-picker/src/CanvasPickerPlugin.ts","../src/packages/g-plugin-canvas-picker/src/Circle.ts","../src/packages/g-plugin-canvas-picker/src/Ellipse.ts","../src/packages/g-plugin-canvas-picker/src/utils/math.ts","../src/packages/g-plugin-canvas-picker/src/Line.ts","../src/packages/g-plugin-canvas-picker/src/Path.ts","../src/packages/g-plugin-canvas-picker/src/Polygon.ts","../src/packages/g-plugin-canvas-picker/src/Polyline.ts","../src/packages/g-plugin-canvas-picker/src/Rect.ts","../src/packages/g-plugin-canvas-picker/src/Image.ts","../src/packages/g-plugin-canvas-picker/src/index.ts"],"sourcesContent":[null,null,null,null,null,null,null,null,null,null,null],"mappings":";;;;;AAwBA,IAAMA,QAAQ,GAAGC,IAAI,CAACC,MAAM,EAAE;AAC9B,IAAMC,QAAQ,GAAGF,IAAI,CAACC,MAAM,EAAE;AAC9B,IAAME,QAAQ,GAAGH,IAAI,CAACC,MAAM,EAAE;AAC9B,IAAMG,OAAO,GAAGC,IAAI,CAACJ,MAAM,EAAE;AAO7B;;;;;AAKG;AACH,IAAAK,kBAAA;EAAA,SAAAA,mBAAA;IAAA,IAuJCC,KAAA;IA7DS,IAAK,CAAAC,KAAA,GAAG,UACdC,aAA4B,EAC5BC,QAAc,EACdC,cAAoB,EACpBC,UAAmB;;MAGnB,IAAMC,IAAI,GACRN,KAAI,CAACO,OAAO,CAACC,wBAAwB,CAACN,aAAa,CAACO,QAAiB,CAAC;MACxE,IAAIH,IAAI,EAAE;;QAER,IAAMI,cAAc,GAAGZ,IAAI,CAACa,MAAM,CAACd,OAAO,EAAEO,cAAc,CAAC;;QAG3D,IAAMQ,aAAa,GAAGnB,IAAI,CAACoB,aAAa,CACtClB,QAAQ,EACRF,IAAI,CAACqB,GAAG,CAAClB,QAAQ,EAAEO,QAAQ,CAAC,CAAC,CAAC,EAAEA,QAAQ,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,EAC/CO,cAAc,CACf;;QAGO,IAAAK,WAAW,GAAKb,aAAa,CAACc,iBAAiB,EAAE,CAAAD,WAAtC;QACX,IAAAE,MAAM,GAAKf,aAAa,CAACgB,WAAmC,CAAAD,MAAtD;QACdL,aAAa,CAAC,CAAC,CAAC,IAAI,CAAEK,MAAM,IAAIA,MAAM,CAAC,CAAC,CAAC,IAAK,CAAC,IAAIF,WAAW,CAAC,CAAC,CAAC,GAAG,CAAC;QACrEH,aAAa,CAAC,CAAC,CAAC,IAAI,CAAEK,MAAM,IAAIA,MAAM,CAAC,CAAC,CAAC,IAAK,CAAC,IAAIF,WAAW,CAAC,CAAC,CAAC,GAAG,CAAC;QACrE,IACET,IAAI,CACFJ,aAAa,EACb,IAAIiB,KAAK,CAACP,aAAa,CAAC,CAAC,CAAC,EAAEA,aAAa,CAAC,CAAC,CAAC,CAAC,EAC7CP,UAAU,EACVL,KAAI,CAACoB,aAAa,EAClBpB,KAAI,CAACO,OAAO,EACZP,KAAI,CAACqB,OAAO,CACb,EACD;UACA,OAAO,IAAI;;;MAIf,OAAO,KAAK;IACd,CAAC;IAED;;;AAGG;IACK,KAAAD,aAAa,GAAG,UAAClB,aAA4B,EAAEC,QAAe;MACpE,IAAMI,OAAO,GAAGP,KAAI,CAACqB,OAAO,CAACC,sBAAsB,CAACC,kBAAkB,CACpEvB,KAAI,CAACO,OAAO,CAACiB,MAAM,CAACC,eAAe,CACR;MAE7B,IAAMC,YAAY,GAChB1B,KAAI,CAACO,OAAO,CAACoB,oBAAoB,CAACzB,aAAa,CAACO,QAAQ,CAAC;MAC3D,IAAIiB,YAAY,EAAE;QAChBnB,OAAO,CAACqB,SAAS,EAAE;QACnBF,YAAY,CAACnB,OAAO,EAAEL,aAAa,CAACgB,WAAW,CAAC;QAChDX,OAAO,CAACsB,SAAS,EAAE;;MAGrB,OAAOtB,OAAO,CAACa,aAAa,CAACjB,QAAQ,CAAC2B,CAAC,EAAE3B,QAAQ,CAAC4B,CAAC,CAAC;IACtD,CAAC;;EAhJDhC,kBAAA,CAAAiC,SAAA,CAAAC,KAAK,GAAL,UAAM1B,OAA+B,EAAEc,OAAsB;IAA7D,IAoBCrB,KAAA;;IAnBS,IAAAkC,gBAAgB,GAAuB3B,OAAO,CAAA2B,gBAA9B;MAAEC,gBAAgB,GAAK5B,OAAO,CAAA4B,gBAAZ;IAC1C,IAAI,CAAC5B,OAAO,GAAGA,OAA4C;IAC3D,IAAI,CAACc,OAAO,GAAGA,OAAO;IAEtB,IAAMe,QAAQ,GAAG,CAAAC,EAAA,GAAAF,gBAAgB,CAACG,IAAI,cAAAD,EAAA,uBAAAA,EAAA,CAAEE,aAAa;IAErDL,gBAAgB,CAACM,KAAK,CAAClC,IAAI,CAACmC,UAAU,CACpC1C,kBAAkB,CAAC2C,GAAG,EACtB,UAAOC,MAAqB;MAAA,OAAAC,SAAA,CAAA5C,KAAA;;UAC1B,OAAO,mBAAI,CAACM,IAAI,CAAC8B,QAAQ,EAAEO,MAAM,CAAC,CAAC;;MACpC;IAAA,EACF;IAEDT,gBAAgB,CAACM,KAAK,CAACK,QAAQ,CAACC,GAAG,CACjC/C,kBAAkB,CAAC2C,GAAG,EACtB,UAACC,MAAqB;MACpB,OAAO3C,KAAI,CAACM,IAAI,CAAC8B,QAAQ,EAAEO,MAAM,CAAC;IACpC,CAAC,CACF;GACF;EAEO5C,kBAAA,CAAAiC,SAAA,CAAA1B,IAAI,GAAZ,UAAa8B,QAAmB,EAAEO,MAAqB;;IAEnD,IAAAI,OAAO,GAELJ,MAAM,CAAAI,OAFD;MACPC,EACE,GAAAL,MAAM,CADUxC,QAAA;MAAN2B,CAAC,GAAAkB,EAAA,CAAAlB,CAAA;MAAEC,CAAC,GAAAiB,EAAA,CAAAjB,CAAE;;IAIpB,IAAM5B,QAAQ,GAAGV,IAAI,CAACqB,GAAG,CAACtB,QAAQ,EAAEsC,CAAC,EAAEC,CAAC,EAAE,CAAC,CAAC;;IAG5C,IAAMkB,WAAW,GAAGb,QAAQ,CAACc,gBAAgB,CAC3C/C,QAAQ,CAAC,CAAC,CAAC,EACXA,QAAQ,CAAC,CAAC,CAAC,EACXA,QAAQ,CAAC,CAAC,CAAC,EACXA,QAAQ,CAAC,CAAC,CAAC,CACZ;;;IAID,IAAMgD,oBAAoB,GAAoB,EAAE;;MAChD,KAA4B,IAAAC,aAAA,GAAAC,QAAA,CAAAJ,WAAW,GAAAK,eAAA,GAAAF,aAAA,CAAAG,IAAA,KAAAD,eAAA,CAAAE,IAAA,EAAAF,eAAA,GAAAF,aAAA,CAAAG,IAAA,IAAE;QAApC,IAAMrD,aAAa,GAAAoD,eAAA,CAAAG,KAAA;QACtB,IAAMrD,cAAc,GAAGF,aAAa,CAACwD,iBAAiB,EAAE;QACxD,IAAMC,gBAAgB,GAAG,IAAI,CAAC1D,KAAK,CACjCC,aAAa,EACbC,QAAQ,EACRC,cAAc,EACd,KAAK,CACN;QACD,IAAIuD,gBAAgB,EAAE;;UAEpB,IAAMC,OAAO,GAAGC,yBAAyB,CAAC3D,aAAa,CAAC;UACxD,IAAI0D,OAAO,EAAE;YACH,IAAAE,QAAQ,GAAKF,OAAO,CAAC1C,WAAmC,CAAA4C,QAAhD;YAChB,IAAMC,aAAa,GAAG,IAAI,CAAC9D,KAAK,CAC9B6D,QAAQ,EACR3D,QAAQ,EACR2D,QAAQ,CAACJ,iBAAiB,EAAE,EAC5B,IAAI,CACL;YACD,IAAIK,aAAa,EAAE;cACjB,IAAIhB,OAAO,EAAE;gBACXJ,MAAM,CAACqB,MAAM,GAAG,CAAC9D,aAAa,CAAC;gBAC/B,OAAOyC,MAAM;eACd,MAAM;gBACLQ,oBAAoB,CAACc,IAAI,CAAC/D,aAAa,CAAC;;;WAG7C,MAAM;YACL,IAAI6C,OAAO,EAAE;cACXJ,MAAM,CAACqB,MAAM,GAAG,CAAC9D,aAAa,CAAC;cAC/B,OAAOyC,MAAM;aACd,MAAM;cACLQ,oBAAoB,CAACc,IAAI,CAAC/D,aAAa,CAAC;;;;;;;;;;;;;;;;IAMhDyC,MAAM,CAACqB,MAAM,GAAGb,oBAAoB;IACpC,OAAOR,MAAM;GACd;EAvFM5C,kBAAG,CAAA2C,GAAA,GAAG,cAAH;EAsJZ,OAAC3C,kBAAA;AAAA,CAvJD,EAuJC;SCtLemE,eAAa9C,CAC3BlB,aAA8C,EAC9CC,QAAe,EACfE,UAAmB;EAEb,IAAAgC,EAAA,GAOFnC,aAAa,CAACgB,WAAqC;IANrDiD,CAAC,GAAA9B,EAAA,CAAA8B,CAAA;IACDC,IAAI,GAAA/B,EAAA,CAAA+B,IAAA;IACJC,MAAM,GAAAhC,EAAA,CAAAgC,MAAA;IACNC,SAAS,GAAAjC,EAAA,CAAAiC,SAAA;IACTC,+BAA+B,GAAAlC,EAAA,CAAAkC,+BAAA;IAC/BC,aAAa,GAAAnC,EAAA,CAAAmC,aACwC;EACvD,IAAMC,aAAa,GACjB,CAAC,CAACH,SAAS,IAAI,CAAC,KAAKC,+BAA+B,IAAI,CAAC,CAAC,IAAI,CAAC;EACjE,IAAMG,WAAW,GAAGC,QAAQ,CAACR,CAAC,EAAEA,CAAC,EAAEhE,QAAQ,CAAC2B,CAAC,EAAE3B,QAAQ,CAAC4B,CAAC,CAAC;EAEpD,IAAAiB,EAAA,GAAA4B,MAAuB,CAAAC,sBAAsB,CACjDL,aAAa,EACbJ,IAAI,EACJC,MAAM,CACP;IAJMS,OAAO,GAAA9B,EAAA;IAAE+B,SAAS,GAAA/B,EAAA,GAIxB;EAED,IAAK8B,OAAO,IAAIC,SAAS,IAAK1E,UAAU,EAAE;IACxC,OAAOqE,WAAW,IAAIP,CAAC,GAAGM,aAAa;;EAEzC,IAAIK,OAAO,EAAE;IACX,OAAOJ,WAAW,IAAIP,CAAC;;EAEzB,IAAIY,SAAS,EAAE;IACb,OAAOL,WAAW,IAAIP,CAAC,GAAGM,aAAa,IAAIC,WAAW,IAAIP,CAAC,GAAGM,aAAa;;EAE7E,OAAO,KAAK;AACd;AClCA,SAASO,eAAeA,CACtBC,OAAe,EACfC,OAAe,EACfC,EAAU,EACVC,EAAU;EAEV,OAAOH,OAAO,IAAIE,EAAE,GAAGA,EAAE,CAAC,GAAGD,OAAO,IAAIE,EAAE,GAAGA,EAAE,CAAC;AAClD;SAEgBC,eAAajE,CAC3BlB,aAA+C,EAC/CC,QAAe,EACfE,UAAmB;EAEb,IAAAgC,EAAA,GAQFnC,aAAa,CAACgB,WAAsC;IAPtDiE,EAAE,GAAA9C,EAAA,CAAA8C,EAAA;IACFC,EAAE,GAAA/C,EAAA,CAAA+C,EAAA;IACFhB,IAAI,GAAA/B,EAAA,CAAA+B,IAAA;IACJC,MAAM,GAAAhC,EAAA,CAAAgC,MAAA;IACNC,SAAS,GAAAjC,EAAA,CAAAiC,SAAA;IACTC,+BAA+B,GAAAlC,EAAA,CAAAkC,+BAAA;IAC/BC,aAAa,GAAAnC,EAAA,CAAAmC,aACyC;EAEhD,IAAA1C,CAAC,GAAQ3B,QAAQ,CAAA2B,CAAhB;IAAEC,CAAC,GAAK5B,QAAQ,CAAA4B,CAAb;EACN,IAAAiB,EAAA,GAAA4B,MAAuB,CAAAC,sBAAsB,CACjDL,aAAa,EACbJ,IAAI,EACJC,MAAM,CACP;IAJMS,OAAO,GAAA9B,EAAA;IAAE+B,SAAS,GAAA/B,EAAA,GAIxB;EAED,IAAMsC,YAAY,GAChB,CAAC,CAAChB,SAAS,IAAI,CAAC,KAAKC,+BAA+B,IAAI,CAAC,CAAC,IAAI,CAAC;EACjE,IAAMU,OAAO,GAAG,CAACnD,CAAC,GAAGqD,EAAE,KAAKrD,CAAC,GAAGqD,EAAE,CAAC;EACnC,IAAMD,OAAO,GAAG,CAACnD,CAAC,GAAGqD,EAAE,KAAKrD,CAAC,GAAGqD,EAAE,CAAC;;EAEnC,IAAKN,OAAO,IAAIC,SAAS,IAAK1E,UAAU,EAAE;IACxC,OACE2E,eAAe,CAACC,OAAO,EAAEC,OAAO,EAAEC,EAAE,GAAGG,YAAY,EAAEF,EAAE,GAAGE,YAAY,CAAC,IACvE,CAAC;;EAGL,IAAIR,OAAO,EAAE;IACX,OAAOE,eAAe,CAACC,OAAO,EAAEC,OAAO,EAAEC,EAAE,EAAEC,EAAE,CAAC,IAAI,CAAC;;EAEvD,IAAIL,SAAS,EAAE;IACb,OACEC,eAAe,CAACC,OAAO,EAAEC,OAAO,EAAEC,EAAE,GAAGG,YAAY,EAAEF,EAAE,GAAGE,YAAY,CAAC,IACrE,CAAC,IACHN,eAAe,CAACC,OAAO,EAAEC,OAAO,EAAEC,EAAE,GAAGG,YAAY,EAAEF,EAAE,GAAGE,YAAY,CAAC,IACrE,CAAC;;EAGP,OAAO,KAAK;AACd;AC5DgB,SAAAC,KAAKA,CACnBC,IAAY,EACZC,IAAY,EACZC,KAAa,EACbC,MAAc,EACd7D,CAAS,EACTC,CAAS;EAET,OAAOD,CAAC,IAAI0D,IAAI,IAAI1D,CAAC,IAAI0D,IAAI,GAAGE,KAAK,IAAI3D,CAAC,IAAI0D,IAAI,IAAI1D,CAAC,IAAI0D,IAAI,GAAGE,MAAM;AAC1E;AAEgB,SAAAC,MAAMA,CACpBJ,IAAY,EACZC,IAAY,EACZC,KAAa,EACbC,MAAc,EACdrB,SAAiB,EACjBxC,CAAS,EACTC,CAAS;EAET,IAAM8D,SAAS,GAAGvB,SAAS,GAAG,CAAC;;EAE/B,OACEiB,KAAK,CAACC,IAAI,GAAGK,SAAS,EAAEJ,IAAI,GAAGI,SAAS,EAAEH,KAAK,EAAEpB,SAAS,EAAExC,CAAC,EAAEC,CAAC,CAAC;EAAA;EACjEwD,KAAK,CACHC,IAAI,GAAGE,KAAK,GAAGG,SAAS,EACxBJ,IAAI,GAAGI,SAAS,EAChBvB,SAAS,EACTqB,MAAM,EACN7D,CAAC,EACDC,CAAC,CACF;EAAA;EACDwD,KAAK,CACHC,IAAI,GAAGK,SAAS,EAChBJ,IAAI,GAAGE,MAAM,GAAGE,SAAS,EACzBH,KAAK,EACLpB,SAAS,EACTxC,CAAC,EACDC,CAAC,CACF;EAAA;EACDwD,KAAK,CAACC,IAAI,GAAGK,SAAS,EAAEJ,IAAI,GAAGI,SAAS,EAAEvB,SAAS,EAAEqB,MAAM,EAAE7D,CAAC,EAAEC,CAAC,CAAC,CAClE;AACJ;SAEgB+D,KAAKA,CACnBC,EAAU,EACVC,EAAU,EACV7B,CAAS,EACT8B,UAAkB,EAClBC,QAAgB,EAChB5B,SAAiB,EACjBxC,CAAS,EACTC,CAAS;EAET,IAAMoE,KAAK,GAAG,CAACC,IAAI,CAACC,KAAK,CAACtE,CAAC,GAAGiE,EAAE,EAAElE,CAAC,GAAGiE,EAAE,CAAC,GAAGK,IAAI,CAACE,EAAE,GAAG,CAAC,KAAKF,IAAI,CAACE,EAAE,GAAG,CAAC,CAAC,CAAC;;;;EAIzE,IAAMC,KAAK,GAAG;IACZzE,CAAC,EAAEiE,EAAE,GAAG5B,CAAC,GAAGiC,IAAI,CAACI,GAAG,CAACL,KAAK,CAAC;IAC3BpE,CAAC,EAAEiE,EAAE,GAAG7B,CAAC,GAAGiC,IAAI,CAACK,GAAG,CAACN,KAAK;GAC3B;EAED,OAAOxB,QAAQ,CAAC4B,KAAK,CAACzE,CAAC,EAAEyE,KAAK,CAACxE,CAAC,EAAED,CAAC,EAAEC,CAAC,CAAC,IAAIuC,SAAS,GAAG,CAAC;AAC1D;AAEgB,SAAAoC,MAAMA,CACpBC,EAAU,EACVC,EAAU,EACVC,EAAU,EACVC,EAAU,EACVxC,SAAiB,EACjBxC,CAAS,EACTC,CAAS;EAET,IAAMyD,IAAI,GAAGY,IAAI,CAACW,GAAG,CAACJ,EAAE,EAAEE,EAAE,CAAC;EAC7B,IAAMG,IAAI,GAAGZ,IAAI,CAACa,GAAG,CAACN,EAAE,EAAEE,EAAE,CAAC;EAC7B,IAAMpB,IAAI,GAAGW,IAAI,CAACW,GAAG,CAACH,EAAE,EAAEE,EAAE,CAAC;EAC7B,IAAMI,IAAI,GAAGd,IAAI,CAACa,GAAG,CAACL,EAAE,EAAEE,EAAE,CAAC;EAC7B,IAAMjB,SAAS,GAAGvB,SAAS,GAAG,CAAC;;;EAG/B,IACE,EACExC,CAAC,IAAI0D,IAAI,GAAGK,SAAS,IACrB/D,CAAC,IAAIkF,IAAI,GAAGnB,SAAS,IACrB9D,CAAC,IAAI0D,IAAI,GAAGI,SAAS,IACrB9D,CAAC,IAAImF,IAAI,GAAGrB,SAAS,CACtB,EACD;IACA,OAAO,KAAK;;;EAGd,OAAOsB,eAAe,CAACR,EAAE,EAAEC,EAAE,EAAEC,EAAE,EAAEC,EAAE,EAAEhF,CAAC,EAAEC,CAAC,CAAC,IAAIuC,SAAS,GAAG,CAAC;AAC/D;AAEM,SAAU8C,UAAUA,CACxBC,MAAa,EACb/C,SAAiB,EACjBxC,CAAS,EACTC,CAAS,EACTuF,OAAgB;EAEhB,IAAMC,KAAK,GAAGF,MAAM,CAACG,MAAM;EAC3B,IAAID,KAAK,GAAG,CAAC,EAAE;IACb,OAAO,KAAK;;EAEd,KAAK,IAAIE,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGF,KAAK,GAAG,CAAC,EAAEE,CAAC,EAAE,EAAE;IAClC,IAAMd,EAAE,GAAGU,MAAM,CAACI,CAAC,CAAC,CAAC,CAAC,CAAC;IACvB,IAAMb,EAAE,GAAGS,MAAM,CAACI,CAAC,CAAC,CAAC,CAAC,CAAC;IACvB,IAAMZ,EAAE,GAAGQ,MAAM,CAACI,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC;IAC3B,IAAMX,EAAE,GAAGO,MAAM,CAACI,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC;IAE3B,IAAIf,MAAM,CAACC,EAAE,EAAEC,EAAE,EAAEC,EAAE,EAAEC,EAAE,EAAExC,SAAS,EAAExC,CAAC,EAAEC,CAAC,CAAC,EAAE;MAC3C,OAAO,IAAI;;;;EAKf,IAAIuF,OAAO,EAAE;IACX,IAAMI,KAAK,GAAGL,MAAM,CAAC,CAAC,CAAC;IACvB,IAAMM,IAAI,GAAGN,MAAM,CAACE,KAAK,GAAG,CAAC,CAAC;IAC9B,IAAIb,MAAM,CAACgB,KAAK,CAAC,CAAC,CAAC,EAAEA,KAAK,CAAC,CAAC,CAAC,EAAEC,IAAI,CAAC,CAAC,CAAC,EAAEA,IAAI,CAAC,CAAC,CAAC,EAAErD,SAAS,EAAExC,CAAC,EAAEC,CAAC,CAAC,EAAE;MACjE,OAAO,IAAI;;;EAIf,OAAO,KAAK;AACd;AAEA;AACA,IAAM6F,SAAS,GAAG,IAAI;AACtB;AACA,SAASC,IAAIA,CAAC/F,CAAS;EACrB,IAAIsE,IAAI,CAAC0B,GAAG,CAAChG,CAAC,CAAC,GAAG8F,SAAS,EAAE;IAC3B,OAAO,CAAC;;EAGV,OAAO9F,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC,GAAG,CAAC;AACvB;AAEA;AACA,SAASiG,SAASA,CAACC,EAAO,EAAEC,EAAO,EAAEC,CAAM;EACzC,IACE,CAACA,CAAC,CAAC,CAAC,CAAC,GAAGF,EAAE,CAAC,CAAC,CAAC,KAAKC,EAAE,CAAC,CAAC,CAAC,GAAGD,EAAE,CAAC,CAAC,CAAC,CAAC,KAAK,CAACC,EAAE,CAAC,CAAC,CAAC,GAAGD,EAAE,CAAC,CAAC,CAAC,KAAKE,CAAC,CAAC,CAAC,CAAC,GAAGF,EAAE,CAAC,CAAC,CAAC,CAAC,IACrE5B,IAAI,CAACW,GAAG,CAACiB,EAAE,CAAC,CAAC,CAAC,EAAEC,EAAE,CAAC,CAAC,CAAC,CAAC,IAAIC,CAAC,CAAC,CAAC,CAAC,IAC9BA,CAAC,CAAC,CAAC,CAAC,IAAI9B,IAAI,CAACa,GAAG,CAACe,EAAE,CAAC,CAAC,CAAC,EAAEC,EAAE,CAAC,CAAC,CAAC,CAAC,IAC9B7B,IAAI,CAACW,GAAG,CAACiB,EAAE,CAAC,CAAC,CAAC,EAAEC,EAAE,CAAC,CAAC,CAAC,CAAC,IAAIC,CAAC,CAAC,CAAC,CAAC,IAC9BA,CAAC,CAAC,CAAC,CAAC,IAAI9B,IAAI,CAACa,GAAG,CAACe,EAAE,CAAC,CAAC,CAAC,EAAEC,EAAE,CAAC,CAAC,CAAC,CAAC,EAC9B;IACA,OAAO,IAAI;;EAEb,OAAO,KAAK;AACd;AAEA;SACgBE,SAASA,CAACd,MAAa,EAAEvF,CAAS,EAAEC,CAAS;EAC3D,IAAI9B,KAAK,GAAG,KAAK;EACjB,IAAMmI,CAAC,GAAGf,MAAM,CAACG,MAAM;EACvB,IAAIY,CAAC,IAAI,CAAC,EAAE;;IAEV,OAAO,KAAK;;EAEd,KAAK,IAAIX,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGW,CAAC,EAAEX,CAAC,EAAE,EAAE;IAC1B,IAAMO,EAAE,GAAGX,MAAM,CAACI,CAAC,CAAC;IACpB,IAAMQ,EAAE,GAAGZ,MAAM,CAAC,CAACI,CAAC,GAAG,CAAC,IAAIW,CAAC,CAAC;IAC9B,IAAIL,SAAS,CAACC,EAAE,EAAEC,EAAE,EAAE,CAACnG,CAAC,EAAEC,CAAC,CAAC,CAAC,EAAE;;MAE7B,OAAO,IAAI;;;;IAIb,IACE8F,IAAI,CAACG,EAAE,CAAC,CAAC,CAAC,GAAGjG,CAAC,CAAC,GAAG,CAAC,KAAK8F,IAAI,CAACI,EAAE,CAAC,CAAC,CAAC,GAAGlG,CAAC,CAAC,GAAG,CAAC,IAC3C8F,IAAI,CAAC/F,CAAC,GAAI,CAACC,CAAC,GAAGiG,EAAE,CAAC,CAAC,CAAC,KAAKA,EAAE,CAAC,CAAC,CAAC,GAAGC,EAAE,CAAC,CAAC,CAAC,CAAC,IAAKD,EAAE,CAAC,CAAC,CAAC,GAAGC,EAAE,CAAC,CAAC,CAAC,CAAC,GAAGD,EAAE,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,EACvE;MACA/H,KAAK,GAAG,CAACA,KAAK;;;EAGlB,OAAOA,KAAK;AACd;SACgBoI,UAAUA,CAACC,QAAe,EAAExG,CAAS,EAAEC,CAAS;EAC9D,IAAI9B,KAAK,GAAG,KAAK;EACjB,KAAK,IAAIwH,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGa,QAAQ,CAACd,MAAM,EAAEC,CAAC,EAAE,EAAE;IACxC,IAAMJ,MAAM,GAAGiB,QAAQ,CAACb,CAAC,CAAC;IAC1BxH,KAAK,GAAGkI,SAAS,CAACd,MAAM,EAAEvF,CAAC,EAAEC,CAAC,CAAC;IAC/B,IAAI9B,KAAK,EAAE;MACT;;;EAGJ,OAAOA,KAAK;AACd;SCxLgBsI,eAAanH,CAC3BlB,aAA4C,EAC5CC,QAAe,EACfE,UAAmB;EAEb,IAAAgC,EAAA,GAYFnC,aAAa,CAACgB,WAAmC;IAXnDyF,EAAE,GAAAtE,EAAA,CAAAsE,EAAA;IACFC,EAAE,GAAAvE,EAAA,CAAAuE,EAAA;IACFC,EAAE,GAAAxE,EAAA,CAAAwE,EAAA;IACFC,EAAE,GAAAzE,EAAA,CAAAyE,EAAA;IACFxC,SAAS,GAAAjC,EAAA,CAAAiC,SAAA;IACTC,+BAA+B,GAAAlC,EAAA,CAAAkC,+BAAA;IAC/BvB,EAAW,GAAAX,EAAA,CAAAmG,IAAA;IAAL1G,CAAC,GAAGkB,EAAA,eAAC,GAAAA,EAAA;IACXyF,EAAA,GAAApG,EAAA,CAAAqG,IAAW;IAAL3G,CAAC,GAAA0G,EAAA,cAAG,CAAC,GAAAA,EAAA;IACXjE,aAAa,GAAAnC,EAAA,CAAAmC,aAAA;IACbJ,IAAI,GAAA/B,EAAA,CAAA+B,IAAA;IACJC,MAAM,GAAAhC,EAAA,CAAAgC,MAC6C;EAE/C,IAAAsE,EAAA,GAAA/D,MAAA,CAAgBC,sBAAsB,CAACL,aAAa,EAAEJ,IAAI,EAAEC,MAAM,CAAC;IAAhEU,SAAS,GAAA4D,EAAA,GAAuD;EAEzE,IAAK,CAAC5D,SAAS,IAAI,CAAC1E,UAAU,IAAK,CAACiE,SAAS,EAAE;IAC7C,OAAO,KAAK;;EAGd,OAAOoC,MAAM,CACXC,EAAE,EACFC,EAAE,EACFC,EAAE,EACFC,EAAE,EACF,CAACxC,SAAS,IAAI,CAAC,KAAKC,+BAA+B,IAAI,CAAC,CAAC,EACzDpE,QAAQ,CAAC2B,CAAC,GAAGA,CAAC,EACd3B,QAAQ,CAAC4B,CAAC,GAAGA,CAAC,CACf;AACH;;ACzBA;AACA,SAAS6G,eAAeA,CACtBC,QAAuB,EACvBvE,SAAiB,EACjBwE,EAAU,EACVC,EAAU,EACVvB,MAAc;EAEd,IAAIvH,KAAK,GAAG,KAAK;EACjB,IAAM4F,SAAS,GAAGvB,SAAS,GAAG,CAAC;EAC/B,KAAK,IAAImD,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGoB,QAAQ,CAACrB,MAAM,EAAEC,CAAC,EAAE,EAAE;IACxC,IAAMuB,OAAO,GAAGH,QAAQ,CAACpB,CAAC,CAAC;IACnB,IAAAwB,YAAY,GAA4BD,OAAO,CAAAC,YAAnC;MAAEC,MAAM,GAAoBF,OAAO,CAAAE,MAA3B;MAAEC,QAAQ,GAAUH,OAAO,CAAjBG,QAAA;MAAEC,GAAG,GAAKJ,OAAO,CAAAI,GAAZ;;IAE3C,IACEA,GAAG,IACH,CAAC7D,KAAK,CACJ6D,GAAG,CAACtH,CAAC,GAAG+D,SAAS,EACjBuD,GAAG,CAACrH,CAAC,GAAG8D,SAAS,EACjBuD,GAAG,CAAC1D,KAAK,GAAGpB,SAAS,EACrB8E,GAAG,CAACzD,MAAM,GAAGrB,SAAS,EACtBwE,EAAE,EACFC,EAAE,CACH,EACD;MACA;;IAEF,QAAQC,OAAO,CAACK,OAAO;;MAErB,KAAK,GAAG;MACR,KAAK,GAAG;QACNpJ,KAAK,GAAGyG,MAAM,CACZyC,QAAQ,CAAC,CAAC,CAAC,EACXA,QAAQ,CAAC,CAAC,CAAC,EACXF,YAAY,CAAC,CAAC,CAAC,EACfA,YAAY,CAAC,CAAC,CAAC,EACf3E,SAAS,EACTwE,EAAE,EACFC,EAAE,CACH;QACD,IAAI9I,KAAK,EAAE;UACT,OAAO,IAAI;;QAEb;MACF,KAAK,GAAG;QACN,IAAMqJ,SAAS,GAAGC,iBAAiB,CACjCJ,QAAQ,CAAC,CAAC,CAAC,EACXA,QAAQ,CAAC,CAAC,CAAC,EACXD,MAAM,CAAC,CAAC,CAAC,EACTA,MAAM,CAAC,CAAC,CAAC,EACTA,MAAM,CAAC,CAAC,CAAC,EACTA,MAAM,CAAC,CAAC,CAAC,EACTJ,EAAE,EACFC,EAAE,CACH;QACD9I,KAAK,GAAGqJ,SAAS,IAAIhF,SAAS,GAAG,CAAC;QAClC,IAAIrE,KAAK,EAAE;UACT,OAAO,IAAI;;QAEb;MACF,KAAK,GAAG;QACN,IAAMuJ,SAAS,GAAGC,kBAAkB,CAClCN,QAAQ,CAAC,CAAC,CAAC;QAAA;QACXA,QAAQ,CAAC,CAAC,CAAC,EACXD,MAAM,CAAC,CAAC,CAAC;QAAA;QACTA,MAAM,CAAC,CAAC,CAAC,EACTA,MAAM,CAAC,CAAC,CAAC,EACTA,MAAM,CAAC,CAAC,CAAC,EACTA,MAAM,CAAC,CAAC,CAAC,EACTA,MAAM,CAAC,CAAC,CAAC,EACTJ,EAAE,EACFC,EAAE,EACFvB,MAAM,CACP;QACDvH,KAAK,GAAGuJ,SAAS,IAAIlF,SAAS,GAAG,CAAC;QAClC,IAAIrE,KAAK,EAAE;UACT,OAAO,IAAI;;QAEb;MACF,KAAK,GAAG;;QAEN,IAAI,CAAC+I,OAAO,CAACU,WAAW,EAAE;UACxBV,OAAO,CAACU,WAAW,GAAGC,UAAU,CAC9BR,QAAQ,CAAC,CAAC,CAAC,EACXA,QAAQ,CAAC,CAAC,CAAC,EACXD,MAAM,CAAC,CAAC,CAAC,EACTA,MAAM,CAAC,CAAC,CAAC,EACTA,MAAM,CAAC,CAAC,CAAC,EACTA,MAAM,CAAC,CAAC,CAAC,EACTA,MAAM,CAAC,CAAC,CAAC,EACTA,MAAM,CAAC,CAAC,CAAC,EACTA,MAAM,CAAC,CAAC,CAAC,EACTU,SAAS,CAC0C;;QAGvD,IAAMC,IAAI,GAAGb,OAAO,CAACU,WAAW;;QAGhC,IAAII,eAAe,GAAGX,QAAQ;QAC9B,KAAK,IAAIY,GAAC,GAAG,CAAC,EAAEA,GAAC,GAAGF,IAAI,CAACrC,MAAM,EAAEuC,GAAC,IAAI,CAAC,EAAE;UACvC,IAAMC,WAAS,GAAGP,kBAAkB,CAClCK,eAAe,CAAC,CAAC,CAAC;UAAA;UAClBA,eAAe,CAAC,CAAC,CAAC,EAClBD,IAAI,CAACE,GAAC,CAAC,EACPF,IAAI,CAACE,GAAC,GAAG,CAAC,CAAC,EACXF,IAAI,CAACE,GAAC,GAAG,CAAC,CAAC,EACXF,IAAI,CAACE,GAAC,GAAG,CAAC,CAAC,EACXF,IAAI,CAACE,GAAC,GAAG,CAAC,CAAC,EACXF,IAAI,CAACE,GAAC,GAAG,CAAC,CAAC,EACXjB,EAAE,EACFC,EAAE,EACFvB,MAAM,CACP;UACDsC,eAAe,GAAG,CAACD,IAAI,CAACE,GAAC,GAAG,CAAC,CAAC,EAAEF,IAAI,CAACE,GAAC,GAAG,CAAC,CAAC,CAAC;UAC5C9J,KAAK,GAAG+J,WAAS,IAAI1F,SAAS,GAAG,CAAC;UAElC,IAAIrE,KAAK,EAAE;YACT,OAAO,IAAI;;;QAGf;;;EAKN,OAAOA,KAAK;AACd;AAEgB,SAAAgK,eAAa7I,CAC3BlB,aAA4C,EAC5CC,QAAe,EACfE,UAAmB,EACnBe,aAGY,EACZ8I,sBAA8C,EAC9C7I,OAAsB;EAEhB,IAAAgB,EAAA,GASFnC,aAAa,CAACgB,WAAmC;IARnDoD,SAAS,GAAAjC,EAAA,CAAAiC,SAAA;IACTC,+BAA+B,GAAAlC,EAAA,CAAAkC,+BAAA;IAC/BF,MAAM,GAAAhC,EAAA,CAAAgC,MAAA;IACND,IAAI,GAAA/B,EAAA,CAAA+B,IAAA;IACJpB,EAAA,GAAAX,EAAA,CAAAmG,IAAW;IAAL1G,CAAC,GAAAkB,EAAA,cAAG,CAAC,GAAAA,EAAA;IACXyF,EAAA,GAAApG,EAAA,CAAAqG,IAAW;IAAL3G,CAAC,GAAA0G,EAAA,cAAG,CAAC,GAAAA,EAAA;IACX0B,IAAI,GAAA9H,EAAA,CAAA8H,IAAA;IACJ3F,aAAa,GAAAnC,EAAA,CAAAmC,aACsC;EAE7C,IAAAqE,QAAQ,GAAkCsB,IAAI,CAAAtB,QAAtC;IAAEuB,MAAM,GAA0BD,IAAI,CAAAC,MAA9B;IAAEC,SAAS,GAAeF,IAAI,CAAnBE,SAAA;IAAE/B,QAAQ,GAAK6B,IAAI,CAAA7B,QAAT;EACvC,IAAAK,EAAA,GAAA/D,MAAA,CAAuBC,sBAAsB,CACjDL,aAAa;;IAEb,CAAA8D,QAAQ,KAAR,QAAAA,QAAQ,uBAARA,QAAQ,CAAEd,MAAM,KAAIpD,IAAI,EACxBC,MAAM,CACP;IALMS,OAAO,GAAA6D,EAAA;IAAE5D,SAAS,GAAA4D,EAAA,GAKxB;EAED,IAAM2B,WAAW,GAAGC,6BAA6B,CAACrK,aAAqB,CAAC;EAExE,IAAID,KAAK,GAAG,KAAK;EAEjB,IAAI6E,OAAO,IAAIzE,UAAU,EAAE;IACzB,IAAI+J,MAAM,EAAE;;MAEVnK,KAAK,GAAGmB,aAAa,CAAClB,aAAa,EAAEC,QAAQ,CAAC;KAC/C,MAAM;;MAELF,KAAK,GACHoI,UAAU,CAACC,QAAQ,EAAEnI,QAAQ,CAAC2B,CAAC,GAAGA,CAAC,EAAE3B,QAAQ,CAAC4B,CAAC,GAAGA,CAAC,CAAC,IACpDsG,UAAU,CAACgC,SAAS,EAAElK,QAAQ,CAAC2B,CAAC,GAAGA,CAAC,EAAE3B,QAAQ,CAAC4B,CAAC,GAAGA,CAAC,CAAC;;IAEzD,OAAO9B,KAAK;GACb,MAAM,IAAI8E,SAAS,IAAI1E,UAAU,EAAE;IAClCJ,KAAK,GAAG2I,eAAe,CACrBC,QAAQ,EACR,CAACvE,SAAS,IAAI,CAAC,KAAKC,+BAA+B,IAAI,CAAC,CAAC,EACzDpE,QAAQ,CAAC2B,CAAC,GAAGA,CAAC,EACd3B,QAAQ,CAAC4B,CAAC,GAAGA,CAAC,EACduI,WAAW,CACZ;;EAGH,OAAOrK,KAAK;AACd;SClMgBuK,eAAapJ,CAC3BlB,aAAgD,EAChDC,QAAe,EACfE,UAAmB;EAEb,IAAAgC,EAAA,GASFnC,aAAa,CAACgB,WAAsC;IARtDmD,MAAM,GAAAhC,EAAA,CAAAgC,MAAA;IACND,IAAI,GAAA/B,EAAA,CAAA+B,IAAA;IACJE,SAAS,GAAAjC,EAAA,CAAAiC,SAAA;IACTC,+BAA+B,GAAAlC,EAAA,CAAAkC,+BAAA;IAC/B8C,MAAM,GAAAhF,EAAA,CAAAgF,MAAA;IACNrE,EAAA,GAAAX,EAAA,CAAAmG,IAAW;IAAL1G,CAAC,GAAGkB,EAAA,eAAC,GAAAA,EAAA;IACXyF,EAAA,GAAApG,EAAA,CAAAqG,IAAW;IAAL3G,CAAC,GAAA0G,EAAA,cAAG,CAAC,GAAAA,EAAA;IACXjE,aAAa,GAAAnC,EAAA,CAAAmC,aACyC;EAClD,IAAAmE,EAAA,GAAA/D,MAAuB,CAAAC,sBAAsB,CACjDL,aAAa,EACbJ,IAAI,EACJC,MAAM,CACP;IAJMS,OAAO,GAAA6D,EAAA;IAAE5D,SAAS,GAAA4D,EAAA,GAIxB;EAED,IAAI1I,KAAK,GAAG,KAAK;EACjB,IAAI8E,SAAS,IAAI1E,UAAU,EAAE;IAC3BJ,KAAK,GAAGmH,UAAU,CAChBC,MAAM,CAACA,MAAM,EACb,CAAC/C,SAAS,IAAI,CAAC,KAAKC,+BAA+B,IAAI,CAAC,CAAC,EACzDpE,QAAQ,CAAC2B,CAAC,GAAGA,CAAC,EACd3B,QAAQ,CAAC4B,CAAC,GAAGA,CAAC,EACd,IAAI,CACL;;EAEH,IAAI,CAAC9B,KAAK,KAAK6E,OAAO,IAAIzE,UAAU,CAAC,EAAE;IACrCJ,KAAK,GAAGkI,SAAS,CAACd,MAAM,CAACA,MAAM,EAAElH,QAAQ,CAAC2B,CAAC,GAAGA,CAAC,EAAE3B,QAAQ,CAAC4B,CAAC,GAAGA,CAAC,CAAC;;EAElE,OAAO9B,KAAK;AACd;SCnCgBwK,eAAarJ,CAC3BlB,aAAgD,EAChDC,QAAe,EACfE,UAAmB;EAEb,IAAAgC,EAAA,GASFnC,aAAa,CAACgB,WAAuC;IARvDoD,SAAS,GAAAjC,EAAA,CAAAiC,SAAA;IACTC,+BAA+B,GAAAlC,EAAA,CAAAkC,+BAAA;IAC/B8C,MAAM,GAAAhF,EAAA,CAAAgF,MAAA;IACNrE,EAAA,GAAAX,EAAA,CAAAmG,IAAW;IAAL1G,CAAC,GAAAkB,EAAA,cAAG,CAAC,GAAAA,EAAA;IACXyF,EAAW,GAAApG,EAAA,CAAAqG,IAAA;IAAL3G,CAAC,GAAA0G,EAAA,cAAG,CAAC,GAAAA,EAAA;IACXjE,aAAa,GAAAnC,EAAA,CAAAmC,aAAA;IACbJ,IAAI,GAAA/B,EAAA,CAAA+B,IAAA;IACJC,MAAM,GAAAhC,EAAA,CAAAgC,MACiD;EACnD,IAAAsE,EAAA,GAAA/D,MAAA,CAAgBC,sBAAsB,CAACL,aAAa,EAAEJ,IAAI,EAAEC,MAAM,CAAC;IAAhEU,SAAS,GAAA4D,EAAA,GAAuD;EAEzE,IAAK,CAAC5D,SAAS,IAAI,CAAC1E,UAAU,IAAK,CAACiE,SAAS,EAAE;IAC7C,OAAO,KAAK;;EAGd,OAAO8C,UAAU,CACfC,MAAM,CAACA,MAAM,EACb,CAAC/C,SAAS,IAAI,CAAC,KAAKC,+BAA+B,IAAI,CAAC,CAAC,EACzDpE,QAAQ,CAAC2B,CAAC,GAAGA,CAAC,EACd3B,QAAQ,CAAC4B,CAAC,GAAGA,CAAC,EACd,KAAK,CACN;AACH;AC3BM,SAAU2I,eAAatJ,CAC3BlB,aAA4C,EAC5CC,QAAe,EACfE,UAAmB,EACnBe,aAGY,EACZC,OAAsB;EAEhB,IAAAgB,EASF,GAAAnC,aAAa,CAACgB,WAAmC;IARnDyJ,MAAM,GAAAtI,EAAA,CAAAsI,MAAA;IACNvG,IAAI,GAAA/B,EAAA,CAAA+B,IAAA;IACJC,MAAM,GAAAhC,EAAA,CAAAgC,MAAA;IACNC,SAAS,GAAAjC,EAAA,CAAAiC,SAAA;IACTC,+BAA+B,GAAAlC,EAAA,CAAAkC,+BAAA;IAC/BmB,KAAK,GAAArD,EAAA,CAAAqD,KAAA;IACLC,MAAM,GAAAtD,EAAA,CAAAsD,MAAA;IACNnB,aAAa,GAAAnC,EAAA,CAAAmC,aACsC;EAE/C,IAAAxB,EAAA,GAAA4B,MAAuB,CAAAC,sBAAsB,CACjDL,aAAa,EACbJ,IAAI,EACJC,MAAM,CACP;IAJMS,OAAO,GAAA9B,EAAA;IAAE+B,SAAS,GAAA/B,EAAA,GAIxB;EAED,IAAM4H,SAAS,GAAGD,MAAM,IAAIA,MAAM,CAACE,IAAI,CAAC,UAAC1G,CAAC;IAAK,OAAAA,CAAC,KAAK,CAAC;EAAP,CAAO,CAAC;EAEvD,IAAM2G,sBAAsB,GAC1B,CAACxG,SAAS,IAAI,CAAC,KAAKC,+BAA+B,IAAI,CAAC,CAAC;;EAG3D,IAAI,CAACqG,SAAS,EAAE;IACd,IAAM/E,SAAS,GAAGiF,sBAAsB,GAAG,CAAC;;IAE5C,IAAKhG,OAAO,IAAIC,SAAS,IAAK1E,UAAU,EAAE;MACxC,OAAOkF,KAAK,CACV,CAAC,GAAGM,SAAS,EACb,CAAC,GAAGA,SAAS,EACbH,KAAK,GAAGG,SAAS,EACjBF,MAAM,GAAGE,SAAS,EAClB1F,QAAQ,CAAC2B,CAAC,EACV3B,QAAQ,CAAC4B,CAAC,CACX;;;IAGH,IAAI+C,OAAO,EAAE;MACX,OAAOS,KAAK,CAAC,CAAC,EAAE,CAAC,EAAEG,KAAK,EAAEC,MAAM,EAAExF,QAAQ,CAAC2B,CAAC,EAAE3B,QAAQ,CAAC4B,CAAC,CAAC;;IAE3D,IAAIgD,SAAS,EAAE;MACb,OAAOa,MAAM,CACX,CAAC,EACD,CAAC,EACDF,KAAK,EACLC,MAAM,EACNmF,sBAAsB,EACtB3K,QAAQ,CAAC2B,CAAC,EACV3B,QAAQ,CAAC4B,CAAC,CACX;;GAEJ,MAAM;IACL,IAAI9B,KAAK,GAAG,KAAK;IACjB,IAAI8E,SAAS,IAAI1E,UAAU,EAAE;MAC3BJ,KAAK,GAAG8K,gBAAgB,CACtB,CAAC,EACD,CAAC,EACDrF,KAAK,EACLC,MAAM,EACNgF,MAAM,CAACK,GAAG,CAAC,UAAC7G,CAAC;QACX,OAAA8G,KAAK,CAAC9G,CAAC,EAAE,CAAC,EAAEiC,IAAI,CAACW,GAAG,CAACX,IAAI,CAAC0B,GAAG,CAACpC,KAAK,CAAC,GAAG,CAAC,EAAEU,IAAI,CAAC0B,GAAG,CAACnC,MAAM,CAAC,GAAG,CAAC,CAAC,CAAC;MAAhE,CAAgE,CAC7B,EACrCmF,sBAAsB,EACtB3K,QAAQ,CAAC2B,CAAC,EACV3B,QAAQ,CAAC4B,CAAC,CACX;;;;IAIH,IAAI,CAAC9B,KAAK,KAAK6E,OAAO,IAAIzE,UAAU,CAAC,EAAE;MACrCJ,KAAK,GAAGmB,aAAa,CAAClB,aAAa,EAAEC,QAAQ,CAAC;;IAEhD,OAAOF,KAAK;;EAGd,OAAO,KAAK;AACd;AAEA,SAAS8K,gBAAgBA,CACvBvF,IAAY,EACZC,IAAY,EACZC,KAAa,EACbC,MAAc,EACduF,WAA6C,EAC7C5G,SAAiB,EACjBxC,CAAS,EACTC,CAAS;EAEH,IAAAM,EAAA,GAAAuC,MAAuB,CAAAsG,WAAW;IAAjCC,GAAG,GAAA9I,EAAA;IAAE+I,GAAG,GAAA/I,EAAA;IAAEgJ,GAAG,GAAAhJ,EAAA;IAAEiJ,GAAG,GAAAjJ,EAAA,GAAe;EACxC,OACEqE,MAAM,CAAClB,IAAI,GAAG2F,GAAG,EAAE1F,IAAI,EAAED,IAAI,GAAGE,KAAK,GAAG0F,GAAG,EAAE3F,IAAI,EAAEnB,SAAS,EAAExC,CAAC,EAAEC,CAAC,CAAC,IACnE2E,MAAM,CACJlB,IAAI,GAAGE,KAAK,EACZD,IAAI,GAAG2F,GAAG,EACV5F,IAAI,GAAGE,KAAK,EACZD,IAAI,GAAGE,MAAM,GAAG0F,GAAG,EACnB/G,SAAS,EACTxC,CAAC,EACDC,CAAC,CACF,IACD2E,MAAM,CACJlB,IAAI,GAAGE,KAAK,GAAG2F,GAAG,EAClB5F,IAAI,GAAGE,MAAM,EACbH,IAAI,GAAG8F,GAAG,EACV7F,IAAI,GAAGE,MAAM,EACbrB,SAAS,EACTxC,CAAC,EACDC,CAAC,CACF,IACD2E,MAAM,CAAClB,IAAI,EAAEC,IAAI,GAAGE,MAAM,GAAG2F,GAAG,EAAE9F,IAAI,EAAEC,IAAI,GAAG0F,GAAG,EAAE7G,SAAS,EAAExC,CAAC,EAAEC,CAAC,CAAC,IACpE+D,KAAK,CACHN,IAAI,GAAGE,KAAK,GAAG0F,GAAG,EAClB3F,IAAI,GAAG2F,GAAG,EACVA,GAAG,EACH,GAAG,GAAGhF,IAAI,CAACE,EAAE,EACb,CAAC,GAAGF,IAAI,CAACE,EAAE,EACXhC,SAAS,EACTxC,CAAC,EACDC,CAAC,CACF,IACD+D,KAAK,CACHN,IAAI,GAAGE,KAAK,GAAG2F,GAAG,EAClB5F,IAAI,GAAGE,MAAM,GAAG0F,GAAG,EACnBA,GAAG,EACH,CAAC,EACD,GAAG,GAAGjF,IAAI,CAACE,EAAE,EACbhC,SAAS,EACTxC,CAAC,EACDC,CAAC,CACF,IACD+D,KAAK,CACHN,IAAI,GAAG8F,GAAG,EACV7F,IAAI,GAAGE,MAAM,GAAG2F,GAAG,EACnBA,GAAG,EACH,GAAG,GAAGlF,IAAI,CAACE,EAAE,EACbF,IAAI,CAACE,EAAE,EACPhC,SAAS,EACTxC,CAAC,EACDC,CAAC,CACF,IACD+D,KAAK,CAACN,IAAI,GAAG2F,GAAG,EAAE1F,IAAI,GAAG0F,GAAG,EAAEA,GAAG,EAAE/E,IAAI,CAACE,EAAE,EAAE,GAAG,GAAGF,IAAI,CAACE,EAAE,EAAEhC,SAAS,EAAExC,CAAC,EAAEC,CAAC,CAAC;AAE/E;ACvJgB,SAAAX,aAAaA,CAC3BlB,aAA6C,EAC7CC,QAAe,EACfE,UAAmB,EACnBe,aAGY,EACZ8I,sBAA8C,EAC9C7I,OAAsB;EAEhB,IAAAgB,EACJ,GAAAnC,aAAa,CAACgB,WAAoC;IAD5CsD,aAAa,GAAAnC,EAAA,CAAAmC,aAAA;IAAEkB,KAAK,GAAArD,EAAA,CAAAqD,KAAA;IAAEC,MAAM,GAAAtD,EAAA,CAAAsD,MACgB;EAEpD,IAAInB,aAAa,KAAK,uBAAuB,EAAE;IACrC,IAAA/C,eAAe,GAAKyI,sBAAsB,CAAC1I,MAAM,CAAAC,eAAlC;IACvB,IAAM8J,MAAM,GACVlK,OAAO,CAACC,sBAAsB,CAACkK,iBAAiB,CAAC/J,eAAe,CAAC;IACnE,IAAMlB,OAAO,GAAGc,OAAO,CAACC,sBAAsB,CAACC,kBAAkB,CAC/DE,eAAe,EACf;MACEgK,kBAAkB,EAAE;IACrB,EAC0B;IAC7BF,MAAM,CAAC7F,KAAK,GAAGA,KAAK;IACpB6F,MAAM,CAAC5F,MAAM,GAAGA,MAAM;IAGnBuE,sBAA8B,CAACwB,2BAIjC,CAACC,KAAK,CAACC,KAAK,CAAC,CAACC,MAAM,CACnBtL,OAAO,EACPL,aAAa,CAACgB,WAAW,EACzBhB,aAAa,EACb0J,SAAS,EACTA,SAAS,EACTA,SAAS,CACV;IAED,IAAMkC,SAAS,GAAGvL,OAAO,CAACwL,YAAY,CAAC5L,QAAQ,CAAC2B,CAAC,EAAE3B,QAAQ,CAAC4B,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAACiK,IAAI;IACzE,OAAOF,SAAS,CAACG,KAAK,CAAC,UAACC,SAAS;MAAK,OAAAA,SAAS,KAAK,CAAC;IAAf,CAAe,CAAC;;EAGxD,OAAO,IAAI;AACb;AC7CA,IAAAC,MAAA,0BAAAC,MAAA;EAA4BC,SAAsB,CAAAF,MAAA,EAAAC,MAAA;EAAlD,SAAAD,OAAA;;IACEnM,KAAI,CAAAsM,IAAA,GAAG,eAAe;;;EACtBH,MAAA,CAAAnK,SAAA,CAAAuK,IAAI,GAAJ;;IACE,IAAMC,QAAQ,GAAG,SAAAA,CAAA;MAAM,WAAI;IAAA;IAC3B,IAAMhM,wBAAwB,IAAA6B,EAAA,OAC5BA,EAAA,CAACsJ,KAAK,CAACc,MAAM,IAAGvI,eAAY,EAC5B7B,EAAA,CAACsJ,KAAK,CAACe,OAAO,IAAGrH,eAAa,EAC9BhD,EAAA,CAACsJ,KAAK,CAACgB,IAAI,IAAGjC,eAAU,EACxBrI,EAAA,CAACsJ,KAAK,CAACiB,IAAI,IAAGrE,eAAU,EACxBlG,EAAA,CAACsJ,KAAK,CAACkB,QAAQ,IAAGpC,eAAc,EAChCpI,EAAA,CAACsJ,KAAK,CAACmB,OAAO,IAAGtC,eAAa,EAC9BnI,EAAA,CAACsJ,KAAK,CAACoB,IAAI,IAAG9C,eAAU,EACxB5H,EAAA,CAACsJ,KAAK,CAACqB,IAAI,IAAGR,QAAQ,EACtBnK,EAAA,CAACsJ,KAAK,CAACsB,KAAK,IAAG,IAAI,EACnB5K,EAAA,CAACsJ,KAAK,CAACC,KAAK,IAAGxK,aAAW,EAC1BiB,EAAA,CAACsJ,KAAK,CAACuB,IAAI,IAAG,IAAI,EAClB7K,EAAA,CAACsJ,KAAK,CAACwB,IAAI,IAAG,IAAI,E,GACnB;;IAGD,IAAI,CAAC5M,OAAO,CAACC,wBAAwB,GAAGA,wBAAwB;IAEhE,IAAI,CAAC4M,kBAAkB,CAAC,IAAIrN,kBAAkB,EAAE,CAAC;GAClD;EACDoM,MAAA,CAAAnK,SAAA,CAAAqL,OAAO,GAAP;;IAEE,OAAO,IAAI,CAAC9M,OAAO,CAACC,wBAAwB;IAC5C,IAAI,CAAC8M,yBAAyB,EAAE;GACjC;EACH,OAACnB,MAAA;AAAD,CA7BA,CAA4BoB,sBAAsB,CA6BjD"},"metadata":{},"sourceType":"module","externalDependencies":[]}