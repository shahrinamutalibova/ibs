{"ast":null,"code":"import { deepMix } from '@antv/util';\nimport { defined } from '../utils/helper';\nimport { columnOf } from './utils/helper';\nfunction normalizeValue(value) {\n  if (typeof value === 'object') return [value.value, value.ordinal];else return [value, true];\n}\n/**\n * The Filter transform filter channels.\n */\nexport const Filter = (options = {}) => {\n  return (I, mark) => {\n    const {\n      encode,\n      data\n    } = mark;\n    const filters = Object.entries(options).map(([key, v]) => {\n      const [V] = columnOf(encode, key);\n      // Skip empty channel.\n      if (!V) return null;\n      const [value, ordinal = true] = normalizeValue(v);\n      if (typeof value === 'function') return i => value(V[i]);\n      if (ordinal) {\n        const expectedValues = Array.isArray(value) ? value : [value];\n        // Skip empty expected values.\n        if (expectedValues.length === 0) return null;\n        return i => expectedValues.includes(V[i]);\n      } else {\n        const [start, end] = value;\n        return i => V[i] >= start && V[i] <= end;\n      }\n    }).filter(defined);\n    // Skip empty filters.\n    if (filters.length === 0) return [I, mark];\n    // Filter index and channels.\n    const totalFilter = i => filters.every(f => f(i));\n    const FI = I.filter(totalFilter);\n    const newIndex = FI.map((_, i) => i);\n    const newEncodes = Object.entries(encode).map(([key, encode]) => {\n      return [key, Object.assign(Object.assign({}, encode), {\n        value: newIndex.map(i => encode.value[FI[i]]).filter(v => v !== undefined)\n      })];\n    });\n    return [newIndex, deepMix({}, mark, {\n      encode: Object.fromEntries(newEncodes),\n      // Filter data for tooltip item.\n      data: FI.map(i => data[i])\n    })];\n  };\n};\nFilter.props = {};","map":{"version":3,"names":["deepMix","defined","columnOf","normalizeValue","value","ordinal","Filter","options","I","mark","encode","data","filters","Object","entries","map","key","v","V","i","expectedValues","Array","isArray","length","includes","start","end","filter","totalFilter","every","f","FI","newIndex","_","newEncodes","undefined","fromEntries","props"],"sources":["transform/filter.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}