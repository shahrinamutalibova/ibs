{"ast":null,"code":"var __rest = this && this.__rest || function (s, e) {\n  var t = {};\n  for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0) t[p] = s[p];\n  if (s != null && typeof Object.getOwnPropertySymbols === \"function\") for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n    if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i])) t[p[i]] = s[p[i]];\n  }\n  return t;\n};\nimport { group } from 'd3-array';\nimport { deepMix } from '@antv/util';\nimport { subObject } from '../utils/helper';\nimport { createValueof, createDatumof, selectG2Elements, useState, renderLink, renderBackground, selectPlotArea, offsetTransform, mergeState, selectElementByData } from './utils';\n/**\n * Active a group of elements.\n */\nexport function elementSelect(root, {\n  elements: elementsof,\n  // given the root of chart returns elements to be manipulated\n  datum,\n  // given each element returns the datum of it\n  groupKey = d => d,\n  // group elements by specified key\n  link = false,\n  // draw link or not\n  single = false,\n  // single select or not\n  coordinate,\n  background = false,\n  scale,\n  emitter,\n  state = {}\n}) {\n  var _a;\n  const elements = elementsof(root);\n  const elementSet = new Set(elements);\n  const keyGroup = group(elements, groupKey);\n  const valueof = createValueof(elements, datum);\n  const [appendLink, removeLink] = renderLink(Object.assign({\n    link,\n    elements,\n    valueof,\n    coordinate\n  }, subObject(state.selected, 'link')));\n  const [appendBackground, removeBackground] = renderBackground(Object.assign({\n    document: root.ownerDocument,\n    background,\n    coordinate,\n    scale,\n    valueof\n  }, subObject(state.selected, 'background')));\n  const elementStyle = deepMix(state, {\n    selected: Object.assign({}, ((_a = state.selected) === null || _a === void 0 ? void 0 : _a.offset) && {\n      //Apply translate to mock slice out.\n      transform: (...params) => {\n        const value = state.selected.offset(...params);\n        const [, i] = params;\n        return offsetTransform(elements[i], value, coordinate);\n      }\n    })\n  });\n  const {\n    setState,\n    removeState,\n    hasState\n  } = useState(elementStyle, valueof);\n  const clear = (nativeEvent = true) => {\n    for (const e of elements) {\n      removeState(e, 'selected', 'unselected');\n      removeLink(e);\n      removeBackground(e);\n    }\n    if (nativeEvent) emitter.emit('element:unselect', {\n      nativeEvent: true\n    });\n    return;\n  };\n  const singleSelect = (event, element, nativeEvent = true) => {\n    // Clear states if clicked selected element.\n    if (hasState(element, 'selected')) clear();else {\n      const k = groupKey(element);\n      const group = keyGroup.get(k);\n      const groupSet = new Set(group);\n      for (const e of elements) {\n        if (groupSet.has(e)) setState(e, 'selected');else {\n          setState(e, 'unselected');\n          removeLink(e);\n        }\n        if (e !== element) removeBackground(e);\n      }\n      appendLink(group);\n      appendBackground(element);\n      if (!nativeEvent) return;\n      emitter.emit('element:select', Object.assign(Object.assign({}, event), {\n        nativeEvent,\n        data: {\n          data: [datum(element), ...group.map(datum)]\n        }\n      }));\n    }\n  };\n  const multipleSelect = (event, element, nativeEvent = true) => {\n    const k = groupKey(element);\n    const group = keyGroup.get(k);\n    const groupSet = new Set(group);\n    if (!hasState(element, 'selected')) {\n      const hasSelectedGroup = group.some(e => hasState(e, 'selected'));\n      for (const e of elements) {\n        if (groupSet.has(e)) setState(e, 'selected');else if (!hasState(e, 'selected')) setState(e, 'unselected');\n      }\n      // Append link for each group only once.\n      if (!hasSelectedGroup && link) appendLink(group);\n      appendBackground(element);\n    } else {\n      // If there is no selected elements after resetting this group,\n      // clear the states.\n      const hasSelected = elements.some(e => !groupSet.has(e) && hasState(e, 'selected'));\n      if (!hasSelected) return clear();\n      // If there are still some selected elements after resetting this group,\n      // only remove the link.\n      for (const e of group) {\n        setState(e, 'unselected');\n        removeLink(e);\n        removeBackground(e);\n      }\n    }\n    if (!nativeEvent) return;\n    emitter.emit('element:select', Object.assign(Object.assign({}, event), {\n      nativeEvent,\n      data: {\n        data: elements.filter(e => hasState(e, 'selected')).map(datum)\n      }\n    }));\n  };\n  const click = event => {\n    const {\n      target: element,\n      nativeEvent = true\n    } = event;\n    // Click non-element shape, reset.\n    // Such as the rest of content area(background).\n    if (!elementSet.has(element)) return clear();\n    if (single) return singleSelect(event, element, nativeEvent);\n    return multipleSelect(event, element, nativeEvent);\n  };\n  root.addEventListener('click', click);\n  const onSelect = e => {\n    const {\n      nativeEvent,\n      data\n    } = e;\n    if (nativeEvent) return;\n    const selectedData = single ? data.data.slice(0, 1) : data.data;\n    for (const d of selectedData) {\n      const element = selectElementByData(elements, d, datum);\n      click({\n        target: element,\n        nativeEvent: false\n      });\n    }\n  };\n  const onUnSelect = () => {\n    clear(false);\n  };\n  emitter.on('element:select', onSelect);\n  emitter.on('element:unselect', onUnSelect);\n  return () => {\n    for (const e of elements) removeLink(e);\n    root.removeEventListener('click', click);\n    emitter.off('element:select', onSelect);\n    emitter.off('element:unselect', onUnSelect);\n  };\n}\nexport function ElementSelect(_a) {\n  var {\n      createGroup,\n      background = false,\n      link = false\n    } = _a,\n    rest = __rest(_a, [\"createGroup\", \"background\", \"link\"]);\n  return (context, _, emitter) => {\n    const {\n      container,\n      view,\n      options\n    } = context;\n    const {\n      coordinate,\n      scale\n    } = view;\n    const plotArea = selectPlotArea(container);\n    return elementSelect(plotArea, Object.assign({\n      elements: selectG2Elements,\n      datum: createDatumof(view),\n      groupKey: createGroup ? createGroup(view) : undefined,\n      coordinate,\n      scale,\n      state: mergeState(options, [['selected', background ? {} : {\n        lineWidth: '1',\n        stroke: '#000'\n      }], 'unselected']),\n      background,\n      link,\n      emitter\n    }, rest));\n  };\n}\nElementSelect.props = {\n  reapplyWhenUpdate: true\n};","map":{"version":3,"names":["group","deepMix","subObject","createValueof","createDatumof","selectG2Elements","useState","renderLink","renderBackground","selectPlotArea","offsetTransform","mergeState","selectElementByData","elementSelect","root","elements","elementsof","datum","groupKey","d","link","single","coordinate","background","scale","emitter","state","elementSet","Set","keyGroup","valueof","appendLink","removeLink","Object","assign","selected","appendBackground","removeBackground","document","ownerDocument","elementStyle","_a","offset","transform","params","value","i","setState","removeState","hasState","clear","nativeEvent","e","emit","singleSelect","event","element","k","get","groupSet","has","data","map","multipleSelect","hasSelectedGroup","some","hasSelected","filter","click","target","addEventListener","onSelect","selectedData","slice","onUnSelect","on","removeEventListener","off","ElementSelect","createGroup","rest","__rest","context","_","container","view","options","plotArea","undefined","lineWidth","stroke","props","reapplyWhenUpdate"],"sources":["interaction/elementSelect.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}