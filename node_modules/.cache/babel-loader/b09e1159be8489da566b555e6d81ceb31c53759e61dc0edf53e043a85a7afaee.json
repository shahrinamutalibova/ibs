{"ast":null,"code":"import { __assign, __extends, __read } from \"tslib\";\nimport { Component } from '../../core';\nimport { BBox, select, splitStyle, subStyleProps } from '../../util';\nimport { getBBox, Title } from '../title';\nimport { CategoryItems } from './category/items';\nimport { CATEGORY_DEFAULT_OPTIONS, CLASS_NAMES } from './constant';\nvar Category = /** @class */function (_super) {\n  __extends(Category, _super);\n  function Category(options) {\n    return _super.call(this, options, CATEGORY_DEFAULT_OPTIONS) || this;\n  }\n  Category.prototype.renderTitle = function (container, width, height) {\n    var _a = this.attributes,\n      showTitle = _a.showTitle,\n      titleText = _a.titleText;\n    var style = subStyleProps(this.attributes, 'title');\n    var _b = __read(splitStyle(style), 2),\n      titleStyle = _b[0],\n      groupStyle = _b[1];\n    this.titleGroup = container.maybeAppendByClassName(CLASS_NAMES.titleGroup, 'g').styles(groupStyle);\n    var finalTitleStyle = __assign(__assign({\n      width: width,\n      height: height\n    }, titleStyle), {\n      text: showTitle ? titleText : ''\n    });\n    this.title = this.titleGroup.maybeAppendByClassName(CLASS_NAMES.title, function () {\n      return new Title({\n        style: finalTitleStyle\n      });\n    }).update(finalTitleStyle);\n  };\n  Category.prototype.renderItems = function (container, bbox) {\n    var x = bbox.x,\n      y = bbox.y,\n      width = bbox.width,\n      height = bbox.height;\n    var style = subStyleProps(this.attributes, 'title', true);\n    var _a = __read(splitStyle(style), 2),\n      partialItemStyle = _a[0],\n      groupStyle = _a[1];\n    // overwrite width and height to available space\n    // overwrite x and y to 0\n    var itemStyle = __assign(__assign({}, partialItemStyle), {\n      width: width,\n      height: height,\n      x: 0,\n      y: 0\n    });\n    this.itemsGroup = container.maybeAppendByClassName(CLASS_NAMES.itemsGroup, 'g').styles(__assign({\n      x: x,\n      y: y\n    }, groupStyle));\n    var that = this;\n    this.itemsGroup.selectAll(CLASS_NAMES.items.class).data(['items']).join(function (enter) {\n      return enter.append(function () {\n        return new CategoryItems({\n          style: itemStyle\n        });\n      }).attr('className', CLASS_NAMES.items.name).each(function () {\n        that.items = select(this);\n      });\n    }, function (update) {\n      return update.update(itemStyle);\n    }, function (exit) {\n      return exit.remove();\n    });\n  };\n  Category.prototype.adjustLayout = function () {\n    var showTitle = this.attributes.showTitle;\n    if (showTitle) {\n      var _a = this.title.node().getAvailableSpace(),\n        x = _a.x,\n        y = _a.y;\n      this.itemsGroup.node().setLocalPosition(x, y);\n    }\n  };\n  Object.defineProperty(Category.prototype, \"availableSpace\", {\n    get: function () {\n      var _a = this.attributes,\n        showTitle = _a.showTitle,\n        width = _a.width,\n        height = _a.height;\n      if (!showTitle) return new BBox(0, 0, width, height);\n      return this.title.node().getAvailableSpace();\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Category.prototype.getBBox = function () {\n    var _a, _b;\n    var title = (_a = this.title) === null || _a === void 0 ? void 0 : _a.node();\n    var items = (_b = this.items) === null || _b === void 0 ? void 0 : _b.node();\n    if (!title || !items) return _super.prototype.getBBox.call(this);\n    return getBBox(title, items);\n  };\n  Category.prototype.render = function (attributes, container) {\n    var width = attributes.width,\n      height = attributes.height;\n    var ctn = select(container);\n    this.renderTitle(ctn, width, height);\n    this.renderItems(ctn, this.availableSpace);\n    this.adjustLayout();\n  };\n  return Category;\n}(Component);\nexport { Category };","map":{"version":3,"names":["Component","BBox","select","splitStyle","subStyleProps","getBBox","Title","CategoryItems","CATEGORY_DEFAULT_OPTIONS","CLASS_NAMES","Category","_super","__extends","options","call","prototype","renderTitle","container","width","height","_a","attributes","showTitle","titleText","style","_b","__read","titleStyle","groupStyle","titleGroup","maybeAppendByClassName","styles","finalTitleStyle","__assign","text","title","update","renderItems","bbox","x","y","partialItemStyle","itemStyle","itemsGroup","that","selectAll","items","class","data","join","enter","append","attr","name","each","exit","remove","adjustLayout","node","getAvailableSpace","setLocalPosition","Object","defineProperty","get","render","ctn","availableSpace"],"sources":["ui/legend/category.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}