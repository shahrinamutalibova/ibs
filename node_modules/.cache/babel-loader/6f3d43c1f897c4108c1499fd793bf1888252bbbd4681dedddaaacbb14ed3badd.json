{"ast":null,"code":"import { __assign, __extends, __read, __spreadArray } from \"tslib\";\nimport { Component } from '../../core';\nimport { Group, Rect } from '../../shapes';\nimport { deepAssign, parseSeriesAttr, subStyleProps } from '../../util';\nimport { Backward, ChartType, Forward, PlayPause, Reset, SelectionType, SpeedSelect, Split } from './icons';\nvar componentsMap = {\n  reset: Reset,\n  speed: SpeedSelect,\n  backward: Backward,\n  playPause: PlayPause,\n  forward: Forward,\n  selectionType: SelectionType,\n  chartType: ChartType,\n  split: Split\n};\nvar Controller = /** @class */function (_super) {\n  __extends(Controller, _super);\n  function Controller(options) {\n    var _this = _super.call(this, deepAssign({}, Controller.defaultOptions, options)) || this;\n    _this.background = _this.appendChild(new Rect({}));\n    _this.functions = _this.appendChild(new Group({}));\n    return _this;\n  }\n  Object.defineProperty(Controller.prototype, \"padding\", {\n    get: function () {\n      return parseSeriesAttr(this.attributes.padding);\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Controller.prototype.renderBackground = function () {\n    var _a = this.style,\n      width = _a.width,\n      height = _a.height;\n    var backgroundStyle = subStyleProps(this.attributes, 'background');\n    this.background.attr(__assign({\n      width: width,\n      height: height\n    }, backgroundStyle));\n  };\n  Controller.prototype.renderFunctions = function () {\n    var _this = this;\n    var _a;\n    var _b = this.attributes,\n      functions = _b.functions,\n      iconSize = _b.iconSize,\n      iconSpacing = _b.iconSpacing,\n      width = _b.width,\n      height = _b.height,\n      align = _b.align;\n    var _c = __read(this.padding, 4),\n      right = _c[1],\n      left = _c[3];\n    var components = functions.reduce(function (prev, curr) {\n      if (prev.length && curr.length) {\n        return prev.concat.apply(prev, __spreadArray(['split'], __read(curr), false));\n      }\n      return prev.concat.apply(prev, __spreadArray([], __read(curr), false));\n    }, []);\n    var componentsWidth = components.length * (iconSize + iconSpacing) - iconSpacing;\n    var xOffset = {\n      left: left + iconSize / 2,\n      center: (width - componentsWidth) / 2 + iconSize / 2,\n      right: width - componentsWidth - left - right + iconSize / 2\n    }[align] || 0;\n    (_a = this.speedSelect) === null || _a === void 0 ? void 0 : _a.destroy();\n    this.functions.removeChildren();\n    components.forEach(function (name, index) {\n      var _a;\n      var Ctor = componentsMap[name];\n      var style = {\n        x: index * (iconSize + iconSpacing) + xOffset,\n        y: height / 2,\n        size: iconSize\n      };\n      if (Ctor === SpeedSelect) {\n        style.speed = _this.attributes.speed;\n        style.onSelect = function (value) {\n          return _this.handleFunctionChange(name, {\n            value: value\n          });\n        };\n      } else if ([PlayPause, SelectionType, ChartType].includes(Ctor)) {\n        style.onChange = function (value) {\n          return _this.handleFunctionChange(name, {\n            value: value\n          });\n        };\n        if (Ctor === PlayPause) style.type = _this.attributes.state === 'play' ? 'pause' : 'play';\n        if (Ctor === SelectionType) style.type = _this.attributes.selectionType === 'range' ? 'value' : 'range';\n        if (Ctor === ChartType) style.type = _this.attributes.chartType === 'line' ? 'column' : 'line';\n      } else {\n        // IconBase\n        style.onClick = function () {\n          return _this.handleFunctionChange(name, {\n            value: name\n          });\n        };\n      }\n      if (Ctor === SpeedSelect) {\n        // SpeedSelect 直接插入到 canvas\n        var _b = _this.getBBox(),\n          baseX = _b.x,\n          baseY = _b.y;\n        var x = style.x,\n          y = style.y;\n        var canvas = (_a = _this.ownerDocument) === null || _a === void 0 ? void 0 : _a.defaultView;\n        if (canvas) {\n          _this.speedSelect = new Ctor({\n            style: __assign(__assign({}, style), {\n              zIndex: 100,\n              x: baseX + x,\n              y: baseY + y\n            })\n          });\n          canvas.appendChild(_this.speedSelect);\n        }\n      } else {\n        _this.functions.appendChild(new Ctor({\n          style: style\n        }));\n      }\n    });\n  };\n  Controller.prototype.disconnectedCallback = function () {\n    var _a;\n    _super.prototype.disconnectedCallback.call(this);\n    (_a = this.speedSelect) === null || _a === void 0 ? void 0 : _a.destroy();\n  };\n  Controller.prototype.render = function () {\n    this.renderBackground();\n    this.renderFunctions();\n  };\n  Controller.prototype.handleFunctionChange = function (name, value) {\n    var onChange = this.attributes.onChange;\n    onChange === null || onChange === void 0 ? void 0 : onChange(name, value);\n  };\n  Controller.defaultOptions = {\n    style: {\n      width: 300,\n      height: 40,\n      padding: 0,\n      align: 'center',\n      iconSize: 25,\n      iconSpacing: 0,\n      speed: 1,\n      state: 'pause',\n      chartType: 'line',\n      selectionType: 'range',\n      backgroundFill: '#fbfdff',\n      backgroundStroke: '#ebedf0',\n      functions: [['reset', 'speed'], ['backward', 'playPause', 'forward'], ['selectionType', 'chartType']]\n    }\n  };\n  return Controller;\n}(Component);\nexport { Controller };","map":{"version":3,"names":["Component","Group","Rect","deepAssign","parseSeriesAttr","subStyleProps","Backward","ChartType","Forward","PlayPause","Reset","SelectionType","SpeedSelect","Split","componentsMap","reset","speed","backward","playPause","forward","selectionType","chartType","split","Controller","_super","__extends","options","_this","call","defaultOptions","background","appendChild","functions","Object","defineProperty","prototype","get","attributes","padding","renderBackground","_a","style","width","height","backgroundStyle","attr","__assign","renderFunctions","_b","iconSize","iconSpacing","align","_c","__read","right","left","components","reduce","prev","curr","length","concat","apply","__spreadArray","componentsWidth","xOffset","center","speedSelect","destroy","removeChildren","forEach","name","index","Ctor","x","y","size","onSelect","value","handleFunctionChange","includes","onChange","type","state","onClick","getBBox","baseX","baseY","canvas","ownerDocument","defaultView","zIndex","disconnectedCallback","render","backgroundFill","backgroundStroke"],"sources":["ui/timebar/controller.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}