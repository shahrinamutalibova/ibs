{"ast":null,"code":"import { __extends, __read } from \"tslib\";\nimport { ElementEvent } from '@antv/g';\nimport { Group } from '../../shapes';\nimport { BBox } from '../../util';\nimport { calcLayout } from '../../util/layout';\nimport { parseSeriesAttr } from '../../util/series';\nvar Layout = /** @class */function (_super) {\n  __extends(Layout, _super);\n  function Layout(options) {\n    var _this = _super.call(this, options) || this;\n    _this.layoutEvents = [ElementEvent.BOUNDS_CHANGED, ElementEvent.INSERTED, ElementEvent.REMOVED];\n    _this.$margin = parseSeriesAttr(0);\n    _this.$padding = parseSeriesAttr(0);\n    var _a = options.style || {},\n      _b = _a.margin,\n      margin = _b === void 0 ? 0 : _b,\n      _c = _a.padding,\n      padding = _c === void 0 ? 0 : _c;\n    _this.margin = margin;\n    _this.padding = padding;\n    _this.isMutationObserved = true;\n    _this.bindEvents();\n    return _this;\n  }\n  Object.defineProperty(Layout.prototype, \"margin\", {\n    get: function () {\n      return this.$margin;\n    },\n    set: function (value) {\n      this.$margin = parseSeriesAttr(value);\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(Layout.prototype, \"padding\", {\n    get: function () {\n      return this.$padding;\n    },\n    set: function (value) {\n      this.$padding = parseSeriesAttr(value);\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Layout.prototype.getBBox = function () {\n    var _a = this.attributes,\n      _b = _a.x,\n      x = _b === void 0 ? 0 : _b,\n      _c = _a.y,\n      y = _c === void 0 ? 0 : _c,\n      width = _a.width,\n      height = _a.height;\n    var _d = __read(this.$margin, 4),\n      marginTop = _d[0],\n      marginRight = _d[1],\n      marginBottom = _d[2],\n      marginLeft = _d[3];\n    return new BBox(x - marginLeft, y - marginTop, width + marginLeft + marginRight, height + marginTop + marginBottom);\n  };\n  Layout.prototype.appendChild = function (child, index) {\n    child.isMutationObserved = true;\n    _super.prototype.appendChild.call(this, child, index);\n    return child;\n  };\n  Layout.prototype.getAvailableSpace = function () {\n    var _a = this.attributes,\n      width = _a.width,\n      height = _a.height;\n    var _b = __read(this.$padding, 4),\n      paddingTop = _b[0],\n      paddingRight = _b[1],\n      paddingBottom = _b[2],\n      paddingLeft = _b[3];\n    var _c = __read(this.$margin, 4),\n      marginTop = _c[0],\n      marginLeft = _c[3];\n    return new BBox(paddingLeft + marginLeft, paddingTop + marginTop, width - paddingLeft - paddingRight, height - paddingTop - paddingBottom);\n  };\n  Layout.prototype.layout = function () {\n    if (!this.attributes.display || !this.isConnected) return;\n    if (this.children.some(function (child) {\n      return !child.isConnected;\n    })) return;\n    try {\n      var bboxes_1 = calcLayout(this.getAvailableSpace(), this.children.map(function (child) {\n        return child.getBBox();\n      }), this.attributes);\n      this.children.forEach(function (child, index) {\n        var _a = bboxes_1[index],\n          x = _a.x,\n          y = _a.y;\n        child.attr({\n          x: x,\n          y: y\n        });\n      });\n    } catch (e) {\n      // do nothing\n    }\n  };\n  Layout.prototype.bindEvents = function () {\n    var _this = this;\n    this.layoutEvents.forEach(function (event) {\n      _this.addEventListener(event, function (e) {\n        e.target.isMutationObserved = true;\n        _this.layout();\n      });\n    });\n  };\n  Layout.prototype.attributeChangedCallback = function (name, oldValue, newValue) {\n    if (name === 'margin') this.margin = newValue;else if (name === 'padding') this.padding = newValue;\n    this.layout();\n  };\n  return Layout;\n}(Group);\nexport { Layout };","map":{"version":3,"names":["ElementEvent","Group","BBox","calcLayout","parseSeriesAttr","Layout","_super","__extends","options","_this","call","layoutEvents","BOUNDS_CHANGED","INSERTED","REMOVED","$margin","$padding","_a","style","_b","margin","_c","padding","isMutationObserved","bindEvents","Object","defineProperty","prototype","get","set","value","getBBox","attributes","x","y","width","height","_d","__read","marginTop","marginRight","marginBottom","marginLeft","appendChild","child","index","getAvailableSpace","paddingTop","paddingRight","paddingBottom","paddingLeft","layout","display","isConnected","children","some","bboxes_1","map","forEach","attr","e","event","addEventListener","target","attributeChangedCallback","name","oldValue","newValue"],"sources":["ui/layout/layout.ts"],"sourcesContent":[null],"mappings":";AACA,SAASA,YAAY,QAAQ,SAAS;AAEtC,SAASC,KAAK,QAAQ,cAAc;AACpC,SAASC,IAAI,QAAQ,YAAY;AACjC,SAASC,UAAU,QAAQ,mBAAmB;AAE9C,SAASC,eAAe,QAAQ,mBAAmB;AAKnD,IAAAC,MAAA,0BAAAC,MAAA;EAA4BC,SAAA,CAAAF,MAAA,EAAAC,MAAA;EA+C1B,SAAAD,OAAYG,OAAsB;IAChC,IAAAC,KAAA,GAAAH,MAAK,CAAAI,IAAA,OAACF,OAAO,CAAC;IA/CRC,KAAA,CAAAE,YAAY,GAAmB,CAACX,YAAY,CAACY,cAAc,EAAEZ,YAAY,CAACa,QAAQ,EAAEb,YAAY,CAACc,OAAO,CAAC;IAEzGL,KAAA,CAAAM,OAAO,GAAuBX,eAAe,CAAC,CAAC,CAAC;IAEhDK,KAAA,CAAAO,QAAQ,GAAuBZ,eAAe,CAAC,CAAC,CAAC;IA4CjD,IAAAa,EAAA,GAA8BT,OAAO,CAACU,KAAK,IAAI,EAAE;MAA/CC,EAAA,GAAAF,EAAA,CAAAG,MAAU;MAAVA,MAAM,GAAAD,EAAA,cAAG,CAAC,GAAAA,EAAA;MAAEE,EAAA,GAAAJ,EAAA,CAAAK,OAAW;MAAXA,OAAO,GAAAD,EAAA,cAAG,CAAC,GAAAA,EAAwB;IACvDZ,KAAI,CAACW,MAAM,GAAGA,MAAM;IACpBX,KAAI,CAACa,OAAO,GAAGA,OAAO;IAEtBb,KAAI,CAACc,kBAAkB,GAAG,IAAI;IAC9Bd,KAAI,CAACe,UAAU,EAAE;;EACnB;EAhDAC,MAAA,CAAAC,cAAA,CAAWrB,MAAA,CAAAsB,SAAA,UAAM;SAIjB,SAAAC,CAAA;MACE,OAAO,IAAI,CAACb,OAAO;IACrB,CAAC;SAND,SAAAc,CAAkBC,KAAiB;MACjC,IAAI,CAACf,OAAO,GAAGX,eAAe,CAAC0B,KAAK,CAAC;IACvC,CAAC;;;;EAMDL,MAAA,CAAAC,cAAA,CAAWrB,MAAA,CAAAsB,SAAA,WAAO;SAIlB,SAAAC,CAAA;MACE,OAAO,IAAI,CAACZ,QAAQ;IACtB,CAAC;SAND,SAAAa,CAAmBC,KAAiB;MAClC,IAAI,CAACd,QAAQ,GAAGZ,eAAe,CAAC0B,KAAK,CAAC;IACxC,CAAC;;;;EAMMzB,MAAA,CAAAsB,SAAA,CAAAI,OAAO,GAAd;IACQ,IAAAd,EAAA,GAAkC,IAAI,CAACe,UAAU;MAA/Cb,EAAA,GAAAF,EAAA,CAAAgB,CAAK;MAALA,CAAC,GAAAd,EAAA,cAAG,CAAC,GAAAA,EAAA;MAAEE,EAAA,GAAAJ,EAAA,CAAAiB,CAAK;MAALA,CAAC,GAAAb,EAAA,cAAG,CAAC,GAAAA,EAAA;MAAEc,KAAK,GAAAlB,EAAA,CAAAkB,KAAA;MAAEC,MAAM,GAAAnB,EAAA,CAAAmB,MAAoB;IACjD,IAAAC,EAAA,GAAAC,MAAA,CAAqD,IAAI,CAACvB,OAAO;MAAhEwB,SAAS,GAAAF,EAAA;MAAEG,WAAW,GAAAH,EAAA;MAAEI,YAAY,GAAAJ,EAAA;MAAEK,UAAU,GAAAL,EAAA,GAAgB;IACvE,OAAO,IAAInC,IAAI,CAAC+B,CAAC,GAAGS,UAAU,EAAER,CAAC,GAAGK,SAAS,EAAEJ,KAAK,GAAGO,UAAU,GAAGF,WAAW,EAAEJ,MAAM,GAAGG,SAAS,GAAGE,YAAY,CAAC;EACrH,CAAC;EAEMpC,MAAA,CAAAsB,SAAA,CAAAgB,WAAW,GAAlB,UAAoCC,KAAQ,EAAEC,KAAc;IACzDD,KAAkC,CAACrB,kBAAkB,GAAG,IAAI;IAC7DjB,MAAA,CAAAqB,SAAK,CAACgB,WAAW,CAAAjC,IAAA,OAACkC,KAAK,EAAEC,KAAK,CAAC;IAC/B,OAAOD,KAAK;EACd,CAAC;EAEMvC,MAAA,CAAAsB,SAAA,CAAAmB,iBAAiB,GAAxB;IACQ,IAAA7B,EAAA,GAAoB,IAAI,CAACe,UAAU;MAAjCG,KAAK,GAAAlB,EAAA,CAAAkB,KAAA;MAAEC,MAAM,GAAAnB,EAAA,CAAAmB,MAAoB;IACnC,IAAAjB,EAAA,GAAAmB,MAAA,CAAyD,IAAI,CAACtB,QAAQ;MAArE+B,UAAU,GAAA5B,EAAA;MAAE6B,YAAY,GAAA7B,EAAA;MAAE8B,aAAa,GAAA9B,EAAA;MAAE+B,WAAW,GAAA/B,EAAA,GAAiB;IACtE,IAAAE,EAAA,GAAAiB,MAAA,CAA8B,IAAI,CAACvB,OAAO;MAAzCwB,SAAS,GAAAlB,EAAA;MAAMqB,UAAU,GAAArB,EAAA,GAAgB;IAChD,OAAO,IAAInB,IAAI,CACbgD,WAAW,GAAGR,UAAU,EACxBK,UAAU,GAAGR,SAAS,EACtBJ,KAAK,GAAGe,WAAW,GAAGF,YAAY,EAClCZ,MAAM,GAAGW,UAAU,GAAGE,aAAa,CACpC;EACH,CAAC;EAYD5C,MAAA,CAAAsB,SAAA,CAAAwB,MAAM,GAAN;IACE,IAAI,CAAC,IAAI,CAACnB,UAAU,CAACoB,OAAO,IAAI,CAAC,IAAI,CAACC,WAAW,EAAE;IACnD,IAAI,IAAI,CAACC,QAAQ,CAACC,IAAI,CAAC,UAACX,KAAK;MAAK,QAACA,KAAK,CAACS,WAAW;IAAlB,CAAkB,CAAC,EAAE;IACvD,IAAI;MACF,IAAMG,QAAM,GAAGrD,UAAU,CACvB,IAAI,CAAC2C,iBAAiB,EAAE,EACxB,IAAI,CAACQ,QAAQ,CAACG,GAAG,CAAC,UAACb,KAAK;QAAK,OAACA,KAAuB,CAACb,OAAO,EAAE;MAAlC,CAAkC,CAAC,EAChE,IAAI,CAACC,UAAU,CAChB;MAED,IAAI,CAACsB,QAAQ,CAACI,OAAO,CAAC,UAACd,KAAK,EAAEC,KAAK;QAC3B,IAAA5B,EAAA,GAAWuC,QAAM,CAACX,KAAK,CAAC;UAAtBZ,CAAC,GAAAhB,EAAA,CAAAgB,CAAA;UAAEC,CAAC,GAAAjB,EAAA,CAAAiB,CAAkB;QAC7BU,KAAuB,CAACe,IAAI,CAAC;UAAE1B,CAAC,EAAAA,CAAA;UAAEC,CAAC,EAAAA;QAAA,CAAE,CAAC;MACzC,CAAC,CAAC;IACJ,CAAC,CAAC,OAAO0B,CAAC,EAAE;MACV;IAAA;EAEJ,CAAC;EAEDvD,MAAA,CAAAsB,SAAA,CAAAH,UAAU,GAAV;IAAA,IAAAf,KAAA;IACE,IAAI,CAACE,YAAY,CAAC+C,OAAO,CAAC,UAACG,KAAK;MAC9BpD,KAAI,CAACqD,gBAAgB,CAACD,KAAK,EAAE,UAACD,CAAiB;QAC5CA,CAAC,CAACG,MAAwB,CAACxC,kBAAkB,GAAG,IAAI;QACrDd,KAAI,CAAC0C,MAAM,EAAE;MACf,CAAC,CAAC;IACJ,CAAC,CAAC;EACJ,CAAC;EAED9C,MAAA,CAAAsB,SAAA,CAAAqC,wBAAwB,GAAxB,UAAyBC,IAAY,EAAEC,QAAa,EAAEC,QAAa;IACjE,IAAIF,IAAI,KAAK,QAAQ,EAAE,IAAI,CAAC7C,MAAM,GAAG+C,QAAQ,CAAC,KACzC,IAAIF,IAAI,KAAK,SAAS,EAAE,IAAI,CAAC3C,OAAO,GAAG6C,QAAQ;IACpD,IAAI,CAAChB,MAAM,EAAE;EACf,CAAC;EACH,OAAA9C,MAAC;AAAD,CAAC,CA1F2BJ,KAAK"},"metadata":{},"sourceType":"module","externalDependencies":[]}