{"ast":null,"code":"import { __assign, __extends, __read } from \"tslib\";\nimport { deepMix, isUndefined } from '@antv/util';\nimport { Component } from '../../core';\nimport { maybeAppend, parseSeriesAttr, select, subStyleProps } from '../../util';\nimport { Marker } from '../marker';\nimport { DISABLED_STYLE, SIZE_STYLE, TYPE_STYLE } from './constant';\nvar Button = /** @class */function (_super) {\n  __extends(Button, _super);\n  function Button(options) {\n    var _this = _super.call(this, options, {\n      cursor: 'pointer',\n      padding: 10,\n      size: 'middle',\n      type: 'default',\n      text: '',\n      state: 'default',\n      markerAlign: 'left',\n      markerSpacing: 5,\n      default: {\n        buttonLineWidth: 1,\n        buttonRadius: 5\n      },\n      active: {}\n    }) || this;\n    _this.state = 'default';\n    _this.clickEvents = function () {\n      var _a = _this.attributes,\n        onClick = _a.onClick,\n        state = _a.state;\n      // 点击事件\n      if (state !== 'disabled') onClick === null || onClick === void 0 ? void 0 : onClick.call(_this, _this);\n    };\n    _this.mouseenterEvent = function () {\n      var state = _this.attributes.state;\n      if (state !== 'disabled') {\n        _this.state = 'active';\n        _this.render(_this.attributes, _this);\n      }\n    };\n    _this.mouseleaveEvent = function () {\n      var state = _this.attributes.state;\n      _this.state = state;\n      _this.render(_this.attributes, _this);\n    };\n    return _this;\n  }\n  Object.defineProperty(Button.prototype, \"markerSize\", {\n    get: function () {\n      var markerSymbol = this.attributes.markerSymbol;\n      var markerStyle = this.getStyle('marker');\n      var markerSize = !markerSymbol ? 0 : (markerStyle === null || markerStyle === void 0 ? void 0 : markerStyle.size) || 2;\n      return markerSize;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(Button.prototype, \"textAvailableWidth\", {\n    /* 获得文本可用宽度 */\n    get: function () {\n      var _a = this.attributes,\n        markerSymbol = _a.markerSymbol,\n        padding = _a.padding,\n        ellipsis = _a.ellipsis,\n        bWidth = _a.width,\n        spacing = _a.markerSpacing;\n      if (!ellipsis) return Infinity;\n      /* 按钮总宽度 */\n      var width = isUndefined(bWidth) ? this.getStyle('button').width : bWidth;\n      if (markerSymbol) return width - padding * 2 - spacing - this.markerSize;\n      return width - padding * 2;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(Button.prototype, \"buttonHeight\", {\n    get: function () {\n      var height = this.attributes.height;\n      if (height) return +height;\n      return +this.getStyle('button').height;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  /**\n   * 根据size、type属性生成实际渲染的属性\n   */\n  Button.prototype.getStyle = function (name) {\n    var _a = this.attributes,\n      size = _a.size,\n      type = _a.type;\n    var state = this.state;\n    var mixedStyle = deepMix({}, SIZE_STYLE[size], TYPE_STYLE[type][state], this.attributes.default, this.attributes[state]);\n    if (state === 'disabled') {\n      // 从DISABLED_STYLE中pick中pick mixedStyle里已有的style\n      Object.keys(mixedStyle).forEach(function (key) {\n        if (key in DISABLED_STYLE) {\n          // @ts-ignore\n          mixedStyle[key] = DISABLED_STYLE[key];\n        }\n      });\n      Object.keys(DISABLED_STYLE.strict).forEach(function (key) {\n        // @ts-ignore\n        mixedStyle[key] = DISABLED_STYLE.strict[key];\n      });\n      deepMix(mixedStyle, this.attributes.disabled || {});\n    }\n    return subStyleProps(mixedStyle, name);\n  };\n  // @todo 处理 markerAlign='right' 的场景. 方案: left marker & right marker 处理为两个 shape, 互相不干扰\n  Button.prototype.render = function (attributes, container) {\n    var _a = attributes.text,\n      text = _a === void 0 ? '' : _a,\n      _b = attributes.padding,\n      padding = _b === void 0 ? 0 : _b,\n      markerSymbol = attributes.markerSymbol,\n      _c = attributes.markerSpacing,\n      markerSpacing = _c === void 0 ? 0 : _c;\n    container.attr('cursor', this.state === 'disabled' ? 'not-allowed' : 'pointer');\n    var _d = __read(parseSeriesAttr(padding), 4),\n      pt = _d[0],\n      pr = _d[1],\n      pb = _d[2],\n      pl = _d[3];\n    var height = this.buttonHeight;\n    var markerStyle = this.getStyle('marker');\n    var markerSize = this.markerSize;\n    var style = __assign(__assign({}, markerStyle), {\n      symbol: markerSymbol,\n      x: pl + markerSize / 2,\n      y: height / 2,\n      size: markerSize\n    });\n    var markerShape = maybeAppend(container, '.marker', function () {\n      return new Marker({\n        className: 'marker',\n        style: style\n      });\n    }).update({\n      style: style\n    }).node();\n    var bounds = markerShape.getLocalBounds();\n    var textStyle = this.getStyle('text');\n    this.textShape = maybeAppend(container, '.text', 'text').attr('className', 'text').styles(__assign(__assign({\n      x: markerSize ? bounds.max[0] + markerSpacing : pl,\n      y: height / 2\n    }, textStyle), {\n      text: text,\n      textAlign: 'left',\n      textBaseline: 'middle',\n      wordWrap: true,\n      wordWrapWidth: this.textAvailableWidth,\n      maxLines: 1,\n      textOverflow: '...'\n    })).node();\n    var textBounds = this.textShape.getLocalBounds();\n    var buttonStyle = this.getStyle('button');\n    select(container).maybeAppendByClassName('.background', 'rect').styles(__assign(__assign({\n      zIndex: -1\n    }, buttonStyle), {\n      height: height,\n      width: pl + (markerSize ? markerSize + markerSpacing : 0) + textBounds.halfExtents[0] * 2 + pr\n    }));\n  };\n  /**\n   * 组件的更新\n   */\n  Button.prototype.update = function (attr) {\n    if (attr === void 0) {\n      attr = {};\n    }\n    this.attr(deepMix({}, this.attributes, attr));\n    var state = this.attributes.state;\n    // 更新状态\n    this.state = state;\n    this.render(this.attributes, this);\n  };\n  /** 更新状态 (不需要走 update) */\n  Button.prototype.setState = function (state) {\n    this.update({\n      state: state\n    });\n  };\n  Button.prototype.hide = function () {\n    // @ts-ignore\n    this.style.visibility = 'hidden';\n  };\n  Button.prototype.show = function () {\n    // @ts-ignore\n    this.style.visibility = 'visible';\n  };\n  Button.prototype.bindEvents = function () {\n    this.addEventListener('click', this.clickEvents);\n    this.addEventListener('mouseenter', this.mouseenterEvent);\n    this.addEventListener('mouseleave', this.mouseleaveEvent);\n  };\n  /**\n   * 组件类型\n   */\n  Button.tag = 'button';\n  return Button;\n}(Component);\nexport { Button };","map":{"version":3,"names":["deepMix","isUndefined","Component","maybeAppend","parseSeriesAttr","select","subStyleProps","Marker","DISABLED_STYLE","SIZE_STYLE","TYPE_STYLE","Button","_super","__extends","options","_this","call","cursor","padding","size","type","text","state","markerAlign","markerSpacing","default","buttonLineWidth","buttonRadius","active","clickEvents","_a","attributes","onClick","mouseenterEvent","render","mouseleaveEvent","Object","defineProperty","prototype","get","markerSymbol","markerStyle","getStyle","markerSize","ellipsis","bWidth","width","spacing","Infinity","height","name","mixedStyle","keys","forEach","key","strict","disabled","container","_b","_c","attr","_d","__read","pt","pr","pb","pl","buttonHeight","style","__assign","symbol","x","y","markerShape","className","update","node","bounds","getLocalBounds","textStyle","textShape","styles","max","textAlign","textBaseline","wordWrap","wordWrapWidth","textAvailableWidth","maxLines","textOverflow","textBounds","buttonStyle","maybeAppendByClassName","zIndex","halfExtents","setState","hide","visibility","show","bindEvents","addEventListener","tag"],"sources":["ui/button/index.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}