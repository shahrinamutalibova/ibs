{"ast":null,"code":"import { __assign, __extends, __read } from \"tslib\";\nimport { isNil } from '@antv/util';\nimport { Component } from '../../core';\nimport { Text } from '../../shapes';\nimport { maybeAppend, parseSeriesAttr, select, subStyleProps } from '../../util';\nimport { Marker } from '../marker';\nfunction adjust(container, paddingLeft, paddingTop, align, baseline) {\n  var bounds = container.getLocalBounds();\n  var x = 0;\n  var y = 0;\n  if (align === 'start') x = paddingLeft;\n  if (align === 'center') x = -bounds.halfExtents[0];\n  if (align === 'end') x = -paddingLeft - bounds.halfExtents[0] * 2;\n  if (baseline === 'top') y = paddingTop + bounds.halfExtents[1];\n  if (baseline === 'middle') y = 0;\n  if (baseline === 'bottom') y = paddingTop - bounds.halfExtents[1] * 2;\n  container.setLocalPosition([x, y]);\n}\nfunction getTextPosition(markerShape, spacing) {\n  var bounds = markerShape.getLocalBounds();\n  return {\n    x: bounds.halfExtents[0] ? bounds.max[0] + (spacing || 0) : markerShape.style.x,\n    y: bounds.halfExtents[1] ? (bounds.min[1] + bounds.max[1]) / 2 : markerShape.style.y\n  };\n}\n/**\n * 带文本、图标的 Tag 组件，支持 iconfont 组件\n *\n * 组成元素：Marker + Text + BackgroundRect\n */\nvar Tag = /** @class */function (_super) {\n  __extends(Tag, _super);\n  function Tag(options) {\n    return _super.call(this, options, {\n      padding: 4,\n      spacing: 4\n    }) || this;\n  }\n  Tag.prototype.render = function (attributes, container) {\n    var _a = attributes.padding,\n      padding = _a === void 0 ? 0 : _a,\n      marker = attributes.marker,\n      text = attributes.text,\n      radius = attributes.radius,\n      spacing = attributes.spacing,\n      align = attributes.align,\n      verticalAlign = attributes.verticalAlign;\n    var labelStyle = subStyleProps(attributes, 'label');\n    var backgroundStyle = subStyleProps(attributes, 'background');\n    var _b = __read(parseSeriesAttr(padding), 4),\n      pt = _b[0],\n      pr = _b[1],\n      pb = _b[2],\n      pl = _b[3];\n    var group = maybeAppend(container, '.tag-content', 'g').attr('className', 'tag-content').style('zIndex', 0).node();\n    var markerStyle = marker || {\n      symbol: 'triangle',\n      size: 0\n    };\n    // @ts-ignore\n    var markerShape = maybeAppend(group, '.tag-marker', function () {\n      return new Marker({\n        style: markerStyle\n      });\n    }).attr('className', 'tag-marker').call(function (selection) {\n      selection.node().clear();\n    }).update(markerStyle).node();\n    var _c = getTextPosition(markerShape, spacing),\n      x = _c.x,\n      y = _c.y;\n    select(group).maybeAppendByClassName('tag-text', function () {\n      return new Text();\n    }).styles(__assign(__assign({\n      fontSize: 12,\n      text: isNil(text) ? '' : \"\".concat(text),\n      x: x,\n      y: y\n    }, labelStyle), {\n      textBaseline: 'middle'\n    })).call(function (selection) {\n      // text 为空字符串或者 false 但 textShape 依然形成了体积\n      if (!text) selection.remove();\n    });\n    adjust(group, pl, pt, align || 'start', verticalAlign || 'top');\n    var bounds = group.getLocalBounds();\n    select(container).maybeAppendByClassName('tag-background', 'rect').styles(__assign({\n      zIndex: -1,\n      y: bounds.min[1] - pt,\n      x: bounds.min[0] - pl,\n      width: backgroundStyle !== null ? pl + pr + bounds.halfExtents[0] * 2 : 0,\n      height: backgroundStyle !== null ? pt + pb + bounds.halfExtents[1] * 2 : 0,\n      radius: radius !== null && radius !== void 0 ? radius : 2,\n      fill: '#fafafa',\n      stroke: '#d9d9d9',\n      lineWidth: 1\n    }, backgroundStyle));\n  };\n  /**\n   * 标签类型\n   */\n  Tag.tag = 'tag';\n  return Tag;\n}(Component);\nexport { Tag };","map":{"version":3,"names":["isNil","Component","Text","maybeAppend","parseSeriesAttr","select","subStyleProps","Marker","adjust","container","paddingLeft","paddingTop","align","baseline","bounds","getLocalBounds","x","y","halfExtents","setLocalPosition","getTextPosition","markerShape","spacing","max","style","min","Tag","_super","__extends","options","call","padding","prototype","render","attributes","_a","marker","text","radius","verticalAlign","labelStyle","backgroundStyle","_b","__read","pt","pr","pb","pl","group","attr","node","markerStyle","symbol","size","selection","clear","update","_c","maybeAppendByClassName","styles","__assign","fontSize","concat","textBaseline","remove","zIndex","width","height","fill","stroke","lineWidth","tag"],"sources":["ui/tag/index.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}