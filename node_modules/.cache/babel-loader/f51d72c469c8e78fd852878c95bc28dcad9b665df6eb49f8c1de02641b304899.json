{"ast":null,"code":"import { deepMix } from '@antv/util';\nimport { column, columnOf, maybeColumnOf } from './utils/helper';\nimport { createGroups } from './utils/order';\n/**\n * The DiffY transform apply offset for y0 channels.\n * Keep y unchanged, set y1 = max(otherY), if y1 > y, remove the data.\n */\nexport const DiffY = (options = {}) => {\n  const {\n    groupBy = 'x',\n    series = true\n  } = options;\n  return (I, mark) => {\n    const {\n      encode\n    } = mark;\n    const [Y] = columnOf(encode, 'y');\n    const [_, fy1] = columnOf(encode, 'y1');\n    const [S] = series ? maybeColumnOf(encode, 'series', 'color') : columnOf(encode, 'color');\n    // Create groups and apply specified order for each group.\n    const groups = createGroups(groupBy, I, mark);\n    // Only adjust Y1 channel.\n    const newY1 = new Array(I.length);\n    for (const G of groups) {\n      const YG = G.map(i => +Y[i]);\n      // Process each series.\n      for (let idx = 0; idx < G.length; idx++) {\n        const i = G[idx];\n        // Get the max Y of current group with current Y exclude.\n        const max = Math.max(...YG.filter((_, _i) => _i !== idx));\n        // Diff Y value.\n        newY1[i] = Y[i] > max ? max : Y[i];\n      }\n    }\n    return [I, deepMix({}, mark, {\n      encode: {\n        y1: column(newY1, fy1)\n      }\n    })];\n  };\n};\nDiffY.props = {};","map":{"version":3,"names":["deepMix","column","columnOf","maybeColumnOf","createGroups","DiffY","options","groupBy","series","I","mark","encode","Y","_","fy1","S","groups","newY1","Array","length","G","YG","map","i","idx","max","Math","filter","_i","y1","props"],"sources":["transform/diffY.ts"],"sourcesContent":[null],"mappings":"AAAA,SAASA,OAAO,QAAQ,YAAY;AAGpC,SAASC,MAAM,EAAEC,QAAQ,EAAEC,aAAa,QAAQ,gBAAgB;AAChE,SAA8BC,YAAY,QAAoB,eAAe;AAI7E;;;;AAIA,OAAO,MAAMC,KAAK,GAAqBA,CAACC,OAAO,GAAG,EAAE,KAAI;EACtD,MAAM;IAAEC,OAAO,GAAG,GAAG;IAAEC,MAAM,GAAG;EAAI,CAAE,GAAGF,OAAO;EAChD,OAAO,CAACG,CAAC,EAAEC,IAAI,KAAI;IACjB,MAAM;MAAEC;IAAM,CAAE,GAAGD,IAAI;IACvB,MAAM,CAACE,CAAC,CAAC,GAAGV,QAAQ,CAACS,MAAM,EAAE,GAAG,CAAC;IACjC,MAAM,CAACE,CAAC,EAAEC,GAAG,CAAC,GAAGZ,QAAQ,CAACS,MAAM,EAAE,IAAI,CAAC;IAEvC,MAAM,CAACI,CAAC,CAAC,GAAGP,MAAM,GACdL,aAAa,CAACQ,MAAM,EAAE,QAAQ,EAAE,OAAO,CAAC,GACxCT,QAAQ,CAACS,MAAM,EAAE,OAAO,CAAC;IAE7B;IACA,MAAMK,MAAM,GAAGZ,YAAY,CAACG,OAAO,EAAEE,CAAC,EAAEC,IAAI,CAAC;IAE7C;IACA,MAAMO,KAAK,GAAG,IAAIC,KAAK,CAACT,CAAC,CAACU,MAAM,CAAC;IACjC,KAAK,MAAMC,CAAC,IAAIJ,MAAM,EAAE;MACtB,MAAMK,EAAE,GAAGD,CAAC,CAACE,GAAG,CAAEC,CAAC,IAAK,CAACX,CAAC,CAACW,CAAC,CAAC,CAAC;MAC9B;MACA,KAAK,IAAIC,GAAG,GAAG,CAAC,EAAEA,GAAG,GAAGJ,CAAC,CAACD,MAAM,EAAEK,GAAG,EAAE,EAAE;QACvC,MAAMD,CAAC,GAAGH,CAAC,CAACI,GAAG,CAAC;QAChB;QACA,MAAMC,GAAG,GAAGC,IAAI,CAACD,GAAG,CAAC,GAAGJ,EAAE,CAACM,MAAM,CAAC,CAACd,CAAC,EAAEe,EAAE,KAAKA,EAAE,KAAKJ,GAAG,CAAC,CAAC;QACzD;QACAP,KAAK,CAACM,CAAC,CAAC,GAAGX,CAAC,CAACW,CAAC,CAAC,GAAGE,GAAG,GAAGA,GAAG,GAAGb,CAAC,CAACW,CAAC,CAAC;;;IAItC,OAAO,CACLd,CAAC,EACDT,OAAO,CAAC,EAAE,EAAEU,IAAI,EAAE;MAChBC,MAAM,EAAE;QACNkB,EAAE,EAAE5B,MAAM,CAACgB,KAAK,EAAEH,GAAG;;KAExB,CAAC,CACH;EACH,CAAC;AACH,CAAC;AAEDT,KAAK,CAACyB,KAAK,GAAG,EAAE"},"metadata":{},"sourceType":"module","externalDependencies":[]}