{"ast":null,"code":"import { __extends, __spreadArray, __read } from 'tslib';\nimport { AbstractRendererPlugin } from '@antv/g-lite';\n\n// const MOBILE_REGEX = /mobile|tablet|ip(ad|hone|od)|android/i;\n/**\n * listen to mouse/touch/pointer events on DOM wrapper, trigger pointer events\n */\nvar DOMInteractionPlugin = /** @class */function () {\n  function DOMInteractionPlugin() {}\n  DOMInteractionPlugin.prototype.apply = function (context, runtime) {\n    var _this = this;\n    var renderingService = context.renderingService,\n      renderingContext = context.renderingContext,\n      config = context.config;\n    this.context = context;\n    var canvas = renderingContext.root.ownerDocument.defaultView;\n    // const SUPPORT_ONLY_TOUCH = canvas.supportsTouchEvents && MOBILE_REGEX.test(navigator.userAgent);\n    var onPointerMove = function (ev) {\n      renderingService.hooks.pointerMove.call(ev);\n    };\n    var onPointerUp = function (ev) {\n      renderingService.hooks.pointerUp.call(ev);\n    };\n    var onPointerDown = function (ev) {\n      renderingService.hooks.pointerDown.call(ev);\n    };\n    var onPointerOver = function (ev) {\n      renderingService.hooks.pointerOver.call(ev);\n    };\n    var onPointerOut = function (ev) {\n      renderingService.hooks.pointerOut.call(ev);\n    };\n    var onPointerCancel = function (ev) {\n      renderingService.hooks.pointerCancel.call(ev);\n    };\n    var onPointerWheel = function (ev) {\n      renderingService.hooks.pointerWheel.call(ev);\n    };\n    var onClick = function (ev) {\n      renderingService.hooks.click.call(ev);\n    };\n    var addPointerEventListener = function ($el) {\n      runtime.globalThis.document.addEventListener('pointermove', onPointerMove, true);\n      $el.addEventListener('pointerdown', onPointerDown, true);\n      $el.addEventListener('pointerleave', onPointerOut, true);\n      $el.addEventListener('pointerover', onPointerOver, true);\n      runtime.globalThis.addEventListener('pointerup', onPointerUp, true);\n      runtime.globalThis.addEventListener('pointercancel', onPointerCancel, true);\n    };\n    var addTouchEventListener = function ($el) {\n      $el.addEventListener('touchstart', onPointerDown, true);\n      $el.addEventListener('touchend', onPointerUp, true);\n      $el.addEventListener('touchmove', onPointerMove, true);\n      $el.addEventListener('touchcancel', onPointerCancel, true);\n    };\n    var addMouseEventListener = function ($el) {\n      runtime.globalThis.document.addEventListener('mousemove', onPointerMove, true);\n      $el.addEventListener('mousedown', onPointerDown, true);\n      $el.addEventListener('mouseout', onPointerOut, true);\n      $el.addEventListener('mouseover', onPointerOver, true);\n      runtime.globalThis.addEventListener('mouseup', onPointerUp, true);\n    };\n    var removePointerEventListener = function ($el) {\n      runtime.globalThis.document.removeEventListener('pointermove', onPointerMove, true);\n      $el.removeEventListener('pointerdown', onPointerDown, true);\n      $el.removeEventListener('pointerleave', onPointerOut, true);\n      $el.removeEventListener('pointerover', onPointerOver, true);\n      runtime.globalThis.removeEventListener('pointerup', onPointerUp, true);\n    };\n    var removeTouchEventListener = function ($el) {\n      $el.removeEventListener('touchstart', onPointerDown, true);\n      $el.removeEventListener('touchend', onPointerUp, true);\n      $el.removeEventListener('touchmove', onPointerMove, true);\n      $el.removeEventListener('touchcancel', onPointerCancel, true);\n    };\n    var removeMouseEventListener = function ($el) {\n      runtime.globalThis.document.removeEventListener('mousemove', onPointerMove, true);\n      $el.removeEventListener('mousedown', onPointerDown, true);\n      $el.removeEventListener('mouseout', onPointerOut, true);\n      $el.removeEventListener('mouseover', onPointerOver, true);\n      runtime.globalThis.removeEventListener('mouseup', onPointerUp, true);\n    };\n    renderingService.hooks.init.tap(DOMInteractionPlugin.tag, function () {\n      var $el = _this.context.contextService.getDomElement();\n      // @ts-ignore\n      if (runtime.globalThis.navigator.msPointerEnabled) {\n        // @ts-ignore\n        $el.style.msContentZooming = 'none';\n        // @ts-ignore\n        $el.style.msTouchAction = 'none';\n      } else if (canvas.supportsPointerEvents) {\n        $el.style.touchAction = 'none';\n      }\n      if (canvas.supportsPointerEvents) {\n        addPointerEventListener($el);\n      } else {\n        addMouseEventListener($el);\n      }\n      if (canvas.supportsTouchEvents) {\n        addTouchEventListener($el);\n      }\n      if (config.useNativeClickEvent) {\n        $el.addEventListener('click', onClick, true);\n      }\n      // use passive event listeners\n      // @see https://zhuanlan.zhihu.com/p/24555031\n      $el.addEventListener('wheel', onPointerWheel, {\n        passive: true,\n        capture: true\n      });\n    });\n    renderingService.hooks.destroy.tap(DOMInteractionPlugin.tag, function () {\n      var $el = _this.context.contextService.getDomElement();\n      // @ts-ignore\n      if (runtime.globalThis.navigator.msPointerEnabled) {\n        // @ts-ignore\n        $el.style.msContentZooming = '';\n        // @ts-ignore\n        $el.style.msTouchAction = '';\n      } else if (canvas.supportsPointerEvents) {\n        $el.style.touchAction = '';\n      }\n      if (canvas.supportsPointerEvents) {\n        removePointerEventListener($el);\n      } else {\n        removeMouseEventListener($el);\n      }\n      if (canvas.supportsTouchEvents) {\n        removeTouchEventListener($el);\n      }\n      if (config.useNativeClickEvent) {\n        $el.removeEventListener('click', onClick, true);\n      }\n      $el.removeEventListener('wheel', onPointerWheel, true);\n    });\n  };\n  DOMInteractionPlugin.tag = 'DOMInteraction';\n  return DOMInteractionPlugin;\n}();\nvar Plugin = /** @class */function (_super) {\n  __extends(Plugin, _super);\n  function Plugin() {\n    var _this = _super.apply(this, __spreadArray([], __read(arguments), false)) || this;\n    _this.name = 'dom-interaction';\n    return _this;\n  }\n  Plugin.prototype.init = function () {\n    this.addRenderingPlugin(new DOMInteractionPlugin());\n  };\n  Plugin.prototype.destroy = function () {\n    this.removeAllRenderingPlugins();\n  };\n  return Plugin;\n}(AbstractRendererPlugin);\nexport { Plugin };","map":{"version":3,"names":["DOMInteractionPlugin","prototype","apply","context","runtime","_this","renderingService","renderingContext","config","canvas","root","ownerDocument","defaultView","onPointerMove","ev","hooks","pointerMove","call","onPointerUp","pointerUp","onPointerDown","pointerDown","onPointerOver","pointerOver","onPointerOut","pointerOut","onPointerCancel","pointerCancel","onPointerWheel","pointerWheel","onClick","click","addPointerEventListener","$el","globalThis","document","addEventListener","addTouchEventListener","addMouseEventListener","removePointerEventListener","removeEventListener","removeTouchEventListener","removeMouseEventListener","init","tap","tag","contextService","getDomElement","navigator","msPointerEnabled","style","msContentZooming","msTouchAction","supportsPointerEvents","touchAction","supportsTouchEvents","useNativeClickEvent","passive","capture","destroy","Plugin","_super","__extends","name","addRenderingPlugin","removeAllRenderingPlugins","AbstractRendererPlugin"],"sources":["../src/packages/g-plugin-dom-interaction/src/DOMInteractionPlugin.ts","../src/packages/g-plugin-dom-interaction/src/index.ts"],"sourcesContent":[null,null],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}