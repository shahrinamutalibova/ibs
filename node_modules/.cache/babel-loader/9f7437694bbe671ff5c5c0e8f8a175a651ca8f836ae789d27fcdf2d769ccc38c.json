{"ast":null,"code":"var __rest = this && this.__rest || function (s, e) {\n  var t = {};\n  for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0) t[p] = s[p];\n  if (s != null && typeof Object.getOwnPropertySymbols === \"function\") for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n    if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i])) t[p[i]] = s[p[i]];\n  }\n  return t;\n};\nimport { deepMix } from '@antv/util';\nimport { group } from 'd3-array';\nimport { subObject } from '../utils/helper';\nimport { createDatumof, createValueof, mergeState, offsetTransform, renderBackground, renderLink, selectElementByData, selectG2Elements, selectPlotArea, useState } from './utils';\n/**\n * highlight a group of elements.\n */\nexport function elementHighlight(root, {\n  elements: elementsof,\n  // given the root of chart returns elements to be manipulated\n  datum,\n  // given each element returns the datum of it\n  groupKey = d => d,\n  // group elements by specified key\n  link = false,\n  // draw link or not\n  background = false,\n  // draw background or not\n  delay = 60,\n  // delay to unhighlighted element\n  scale,\n  coordinate,\n  emitter,\n  state = {}\n}) {\n  var _a;\n  const elements = elementsof(root);\n  const elementSet = new Set(elements);\n  const keyGroup = group(elements, groupKey);\n  const valueof = createValueof(elements, datum);\n  const [appendLink, removeLink] = renderLink(Object.assign({\n    elements,\n    valueof,\n    link,\n    coordinate\n  }, subObject(state.active, 'link')));\n  const [appendBackground, removeBackground, isBackground] = renderBackground(Object.assign({\n    document: root.ownerDocument,\n    scale,\n    coordinate,\n    background,\n    valueof\n  }, subObject(state.active, 'background')));\n  const elementStyle = deepMix(state, {\n    active: Object.assign({}, ((_a = state.active) === null || _a === void 0 ? void 0 : _a.offset) && {\n      //Apply translate to mock slice out.\n      transform: (...params) => {\n        const value = state.active.offset(...params);\n        const [, i] = params;\n        return offsetTransform(elements[i], value, coordinate);\n      }\n    })\n  });\n  const {\n    setState,\n    removeState,\n    hasState\n  } = useState(elementStyle, valueof);\n  let out; // Timer for delaying unhighlighted.\n  const pointerover = event => {\n    const {\n      target: element,\n      nativeEvent = true\n    } = event;\n    if (!elementSet.has(element)) return;\n    if (out) clearTimeout(out);\n    const k = groupKey(element);\n    const group = keyGroup.get(k);\n    const groupSet = new Set(group);\n    for (const e of elements) {\n      if (groupSet.has(e)) {\n        if (!hasState(e, 'active')) setState(e, 'active');\n      } else {\n        setState(e, 'inactive');\n        removeLink(e);\n      }\n      if (e !== element) removeBackground(e);\n    }\n    appendBackground(element);\n    appendLink(group);\n    // Emit events.\n    if (!nativeEvent) return;\n    emitter.emit('element:highlight', {\n      nativeEvent,\n      data: {\n        data: datum(element),\n        group: group.map(datum)\n      }\n    });\n  };\n  const delayUnhighlighted = () => {\n    if (out) clearTimeout(out);\n    out = setTimeout(() => {\n      unhighlighted();\n      out = null;\n    }, delay);\n  };\n  const unhighlighted = (nativeEvent = true) => {\n    for (const e of elements) {\n      removeState(e, 'active', 'inactive');\n      removeBackground(e);\n      removeLink(e);\n    }\n    if (nativeEvent) {\n      emitter.emit('element:unhighlight', {\n        nativeEvent\n      });\n    }\n  };\n  const pointerout = event => {\n    const {\n      target: element\n    } = event;\n    if (background && !isBackground(element)) return;\n    if (!background && !elementSet.has(element)) return;\n    if (delay > 0) delayUnhighlighted();else unhighlighted();\n  };\n  const pointerleave = () => {\n    unhighlighted();\n  };\n  root.addEventListener('pointerover', pointerover);\n  root.addEventListener('pointerout', pointerout);\n  root.addEventListener('pointerleave', pointerleave);\n  const onRest = e => {\n    const {\n      nativeEvent\n    } = e;\n    if (nativeEvent) return;\n    unhighlighted(false);\n  };\n  const onHighlight = e => {\n    const {\n      nativeEvent\n    } = e;\n    if (nativeEvent) return;\n    const {\n      data\n    } = e.data;\n    const element = selectElementByData(elements, data, datum);\n    if (!element) return;\n    pointerover({\n      target: element,\n      nativeEvent: false\n    });\n  };\n  emitter.on('element:highlight', onHighlight);\n  emitter.on('element:unhighlight', onRest);\n  return () => {\n    root.removeEventListener('pointerover', pointerover);\n    root.removeEventListener('pointerout', pointerout);\n    root.removeEventListener('pointerleave', pointerleave);\n    emitter.off('element:highlight', onHighlight);\n    emitter.off('element:unhighlight', onRest);\n    for (const e of elements) {\n      removeBackground(e);\n      removeLink(e);\n    }\n  };\n}\nexport function ElementHighlight(_a) {\n  var {\n      delay,\n      createGroup,\n      background = false,\n      link = false\n    } = _a,\n    rest = __rest(_a, [\"delay\", \"createGroup\", \"background\", \"link\"]);\n  return (context, _, emitter) => {\n    const {\n      container,\n      view,\n      options\n    } = context;\n    const {\n      scale,\n      coordinate\n    } = view;\n    const plotArea = selectPlotArea(container);\n    return elementHighlight(plotArea, Object.assign({\n      elements: selectG2Elements,\n      datum: createDatumof(view),\n      groupKey: createGroup ? createGroup(view) : undefined,\n      coordinate,\n      scale,\n      state: mergeState(options, [['active', background ? {} : {\n        lineWidth: '1',\n        stroke: '#000'\n      }], 'inactive']),\n      background,\n      link,\n      delay,\n      emitter\n    }, rest));\n  };\n}\nElementHighlight.props = {\n  reapplyWhenUpdate: true\n};","map":{"version":3,"names":["deepMix","group","subObject","createDatumof","createValueof","mergeState","offsetTransform","renderBackground","renderLink","selectElementByData","selectG2Elements","selectPlotArea","useState","elementHighlight","root","elements","elementsof","datum","groupKey","d","link","background","delay","scale","coordinate","emitter","state","elementSet","Set","keyGroup","valueof","appendLink","removeLink","Object","assign","active","appendBackground","removeBackground","isBackground","document","ownerDocument","elementStyle","_a","offset","transform","params","value","i","setState","removeState","hasState","out","pointerover","event","target","element","nativeEvent","has","clearTimeout","k","get","groupSet","e","emit","data","map","delayUnhighlighted","setTimeout","unhighlighted","pointerout","pointerleave","addEventListener","onRest","onHighlight","on","removeEventListener","off","ElementHighlight","createGroup","rest","__rest","context","_","container","view","options","plotArea","undefined","lineWidth","stroke","props","reapplyWhenUpdate"],"sources":["interaction/elementHighlight.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}