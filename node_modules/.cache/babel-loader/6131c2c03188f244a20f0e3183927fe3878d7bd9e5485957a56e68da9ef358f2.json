{"ast":null,"code":"import { __awaiter, __generator, __extends, __spreadArray, __read } from 'tslib';\nimport { setDOMSize, RenderReason, isBrowser, AbstractRendererPlugin, AbstractRenderer } from '@antv/g-lite';\nimport * as CanvasPathGenerator from '@antv/g-plugin-canvas-path-generator';\nexport { CanvasPathGenerator };\nimport * as CanvasPicker from '@antv/g-plugin-canvas-picker';\nexport { CanvasPicker };\nimport * as CanvasRenderer from '@antv/g-plugin-canvas-renderer';\nexport { CanvasRenderer };\nimport * as DomInteraction from '@antv/g-plugin-dom-interaction';\nexport { DomInteraction };\nimport * as HTMLRenderer from '@antv/g-plugin-html-renderer';\nexport { HTMLRenderer };\nimport * as ImageLoader from '@antv/g-plugin-image-loader';\nexport { ImageLoader };\nimport { isString } from '@antv/util';\nvar Canvas2DContextService = /** @class */function () {\n  function Canvas2DContextService(context) {\n    this.renderingContext = context.renderingContext;\n    this.canvasConfig = context.config;\n  }\n  Canvas2DContextService.prototype.init = function () {\n    var _a = this.canvasConfig,\n      container = _a.container,\n      canvas = _a.canvas;\n    if (canvas) {\n      this.$canvas = canvas;\n      if (container && canvas.parentElement !== container) {\n        container.appendChild(canvas);\n      }\n      this.$container = canvas.parentElement;\n      this.canvasConfig.container = this.$container;\n    } else if (container) {\n      // create container\n      this.$container = isString(container) ? document.getElementById(container) : container;\n      if (this.$container) {\n        // create canvas\n        var $canvas = document.createElement('canvas');\n        this.$container.appendChild($canvas);\n        if (!this.$container.style.position) {\n          this.$container.style.position = 'relative';\n        }\n        this.$canvas = $canvas;\n      }\n    }\n    this.context = this.$canvas.getContext('2d');\n    this.resize(this.canvasConfig.width, this.canvasConfig.height);\n  };\n  Canvas2DContextService.prototype.getContext = function () {\n    return this.context;\n  };\n  Canvas2DContextService.prototype.getDomElement = function () {\n    return this.$canvas;\n  };\n  Canvas2DContextService.prototype.getDPR = function () {\n    return this.dpr;\n  };\n  Canvas2DContextService.prototype.getBoundingClientRect = function () {\n    if (this.$canvas.getBoundingClientRect) {\n      return this.$canvas.getBoundingClientRect();\n    }\n  };\n  Canvas2DContextService.prototype.destroy = function () {\n    // @ts-ignore\n    if (this.$container && this.$canvas && this.$canvas.parentNode) {\n      // destroy context\n      // @ts-ignore\n      this.$container.removeChild(this.$canvas);\n    }\n  };\n  Canvas2DContextService.prototype.resize = function (width, height) {\n    var devicePixelRatio = this.canvasConfig.devicePixelRatio;\n    // use user-defined dpr first\n    var dpr = devicePixelRatio || isBrowser && window.devicePixelRatio || 1;\n    dpr = dpr >= 1 ? Math.ceil(dpr) : 1;\n    this.dpr = dpr;\n    if (this.$canvas) {\n      // set canvas width & height\n      this.$canvas.width = this.dpr * width;\n      this.$canvas.height = this.dpr * height;\n      // set CSS style width & height\n      setDOMSize(this.$canvas, width, height);\n      // const dpr = this.getDPR();\n      // scale all drawing operations by the dpr\n      // @see https://www.html5rocks.com/en/tutorials/canvas/hidpi/\n      // this.context.scale(dpr, dpr);\n    }\n    this.renderingContext.renderReasons.add(RenderReason.CAMERA_CHANGED);\n  };\n  Canvas2DContextService.prototype.applyCursorStyle = function (cursor) {\n    if (this.$container && this.$container.style) {\n      this.$container.style.cursor = cursor;\n    }\n  };\n  Canvas2DContextService.prototype.toDataURL = function (options) {\n    if (options === void 0) {\n      options = {};\n    }\n    return __awaiter(this, void 0, void 0, function () {\n      var type, encoderOptions;\n      return __generator(this, function (_a) {\n        type = options.type, encoderOptions = options.encoderOptions;\n        return [2 /*return*/, this.context.canvas.toDataURL(type, encoderOptions)];\n      });\n    });\n  };\n  return Canvas2DContextService;\n}();\nvar ContextRegisterPlugin = /** @class */function (_super) {\n  __extends(ContextRegisterPlugin, _super);\n  function ContextRegisterPlugin() {\n    var _this = _super.apply(this, __spreadArray([], __read(arguments), false)) || this;\n    _this.name = 'canvas-context-register';\n    return _this;\n  }\n  ContextRegisterPlugin.prototype.init = function () {\n    this.context.ContextService = Canvas2DContextService;\n  };\n  ContextRegisterPlugin.prototype.destroy = function () {\n    delete this.context.ContextService;\n  };\n  return ContextRegisterPlugin;\n}(AbstractRendererPlugin);\nvar Renderer = /** @class */function (_super) {\n  __extends(Renderer, _super);\n  function Renderer(config) {\n    var _this = _super.call(this, config) || this;\n    // register Canvas2DContext\n    _this.registerPlugin(new ContextRegisterPlugin());\n    _this.registerPlugin(new ImageLoader.Plugin());\n    _this.registerPlugin(new CanvasPathGenerator.Plugin());\n    // enable rendering with Canvas2D API\n    _this.registerPlugin(new CanvasRenderer.Plugin());\n    _this.registerPlugin(new DomInteraction.Plugin());\n    // enable picking with Canvas2D API\n    _this.registerPlugin(new CanvasPicker.Plugin());\n    // render HTML component\n    _this.registerPlugin(new HTMLRenderer.Plugin());\n    return _this;\n  }\n  return Renderer;\n}(AbstractRenderer);\nexport { Renderer };","map":{"version":3,"names":["Canvas2DContextService","context","renderingContext","canvasConfig","config","prototype","init","_a","container","canvas","$canvas","parentElement","appendChild","$container","isString","document","getElementById","createElement","style","position","getContext","resize","width","height","getDomElement","getDPR","dpr","getBoundingClientRect","destroy","parentNode","removeChild","devicePixelRatio","isBrowser","window","Math","ceil","setDOMSize","renderReasons","add","RenderReason","CAMERA_CHANGED","applyCursorStyle","cursor","toDataURL","options","type","encoderOptions","ContextRegisterPlugin","_super","__extends","_this","name","ContextService","AbstractRendererPlugin","Renderer","call","registerPlugin","ImageLoader","Plugin","CanvasPathGenerator","CanvasRenderer","DomInteraction","CanvasPicker","HTMLRenderer","AbstractRenderer"],"sources":["../src/packages/g-canvas/src/Canvas2DContextService.ts","../src/packages/g-canvas/src/ContextRegisterPlugin.ts","../src/packages/g-canvas/src/index.ts"],"sourcesContent":[null,null,null],"mappings":";;;;;;;;;;;;;;;AAYA,IAAAA,sBAAA;EAaE,SAAAA,uBAAYC,OAAsC;IAChD,IAAI,CAACC,gBAAgB,GAAGD,OAAO,CAACC,gBAAgB;IAChD,IAAI,CAACC,YAAY,GAAGF,OAAO,CAACG,MAAM;;EAGpCJ,sBAAA,CAAAK,SAAA,CAAAC,IAAI,GAAJ;IACQ,IAAAC,EAAA,GAAwB,IAAI,CAACJ,YAAY;MAAvCK,SAAS,GAAAD,EAAA,CAAAC,SAAA;MAAEC,MAAM,GAAAF,EAAA,CAAAE,MAAsB;IAE/C,IAAIA,MAAM,EAAE;MACV,IAAI,CAACC,OAAO,GAAGD,MAAM;MAErB,IACED,SAAS,IACRC,MAA4B,CAACE,aAAa,KAAKH,SAAS,EACzD;QACCA,SAAyB,CAACI,WAAW,CAACH,MAA2B,CAAC;;MAGrE,IAAI,CAACI,UAAU,GAAIJ,MAA4B,CAACE,aAAa;MAC7D,IAAI,CAACR,YAAY,CAACK,SAAS,GAAG,IAAI,CAACK,UAAU;KAC9C,MAAM,IAAIL,SAAS,EAAE;;MAEpB,IAAI,CAACK,UAAU,GAAGC,QAAQ,CAACN,SAAS,CAAC,GACjCO,QAAQ,CAACC,cAAc,CAACR,SAAS,CAAC,GAClCA,SAAS;MACb,IAAI,IAAI,CAACK,UAAU,EAAE;;QAEnB,IAAMH,OAAO,GAAGK,QAAQ,CAACE,aAAa,CAAC,QAAQ,CAAC;QAEhD,IAAI,CAACJ,UAAU,CAACD,WAAW,CAACF,OAAO,CAAC;QACpC,IAAI,CAAC,IAAI,CAACG,UAAU,CAACK,KAAK,CAACC,QAAQ,EAAE;UACnC,IAAI,CAACN,UAAU,CAACK,KAAK,CAACC,QAAQ,GAAG,UAAU;;QAE7C,IAAI,CAACT,OAAO,GAAGA,OAAO;;;IAI1B,IAAI,CAACT,OAAO,GAAG,IAAI,CAACS,OAAO,CAACU,UAAU,CAAC,IAAI,CAAC;IAC5C,IAAI,CAACC,MAAM,CAAC,IAAI,CAAClB,YAAY,CAACmB,KAAK,EAAE,IAAI,CAACnB,YAAY,CAACoB,MAAM,CAAC;GAC/D;EAEDvB,sBAAA,CAAAK,SAAA,CAAAe,UAAU,GAAV;IACE,OAAO,IAAI,CAACnB,OAAmC;GAChD;EAEDD,sBAAA,CAAAK,SAAA,CAAAmB,aAAa,GAAb;IACE,OAAO,IAAI,CAACd,OAAO;GACpB;EAEDV,sBAAA,CAAAK,SAAA,CAAAoB,MAAM,GAAN;IACE,OAAO,IAAI,CAACC,GAAG;GAChB;EAED1B,sBAAA,CAAAK,SAAA,CAAAsB,qBAAqB,GAArB;IACE,IAAK,IAAI,CAACjB,OAA6B,CAACiB,qBAAqB,EAAE;MAC7D,OAAQ,IAAI,CAACjB,OAA6B,CAACiB,qBAAqB,EAAE;;GAErE;EAED3B,sBAAA,CAAAK,SAAA,CAAAuB,OAAO,GAAP;;IAEE,IAAI,IAAI,CAACf,UAAU,IAAI,IAAI,CAACH,OAAO,IAAI,IAAI,CAACA,OAAO,CAACmB,UAAU,EAAE;;;MAG9D,IAAI,CAAChB,UAAU,CAACiB,WAAW,CAAC,IAAI,CAACpB,OAAO,CAAC;;GAE5C;EAEDV,sBAAA,CAAAK,SAAA,CAAAgB,MAAM,GAAN,UAAOC,KAAa,EAAEC,MAAc;IAC1B,IAAAQ,gBAAgB,GAAK,IAAI,CAAC5B,YAAY,CAAA4B,gBAAtB;;IAGxB,IAAIL,GAAG,GAAGK,gBAAgB,IAAKC,SAAS,IAAIC,MAAM,CAACF,gBAAiB,IAAI,CAAC;IACzEL,GAAG,GAAGA,GAAG,IAAI,CAAC,GAAGQ,IAAI,CAACC,IAAI,CAACT,GAAG,CAAC,GAAG,CAAC;IACnC,IAAI,CAACA,GAAG,GAAGA,GAAG;IAEd,IAAI,IAAI,CAAChB,OAAO,EAAE;;MAEhB,IAAI,CAACA,OAAO,CAACY,KAAK,GAAG,IAAI,CAACI,GAAG,GAAGJ,KAAK;MACrC,IAAI,CAACZ,OAAO,CAACa,MAAM,GAAG,IAAI,CAACG,GAAG,GAAGH,MAAM;;MAGvCa,UAAU,CAAC,IAAI,CAAC1B,OAAO,EAAEY,KAAK,EAAEC,MAAM,CAAC;;;;;;IAQzC,IAAI,CAACrB,gBAAgB,CAACmC,aAAa,CAACC,GAAG,CAACC,YAAY,CAACC,cAAc,CAAC;GACrE;EAEDxC,sBAAgB,CAAAK,SAAA,CAAAoC,gBAAA,GAAhB,UAAiBC,MAAc;IAC7B,IAAI,IAAI,CAAC7B,UAAU,IAAI,IAAI,CAACA,UAAU,CAACK,KAAK,EAAE;MAC5C,IAAI,CAACL,UAAU,CAACK,KAAK,CAACwB,MAAM,GAAGA,MAAM;;GAExC;EAEK1C,sBAAS,CAAAK,SAAA,CAAAsC,SAAA,GAAf,UAAgBC,OAAqC;IAArC,IAAAA,OAAA;MAAAA,OAAqC;IAAA;;;;QAC3CC,IAAI,GAAqBD,OAAO,CAA5BC,IAAA,EAAEC,cAAc,GAAKF,OAAO,CAAAE,cAAZ;QAC5B,sBAAQ,IAAI,CAAC7C,OAAO,CAACQ,MAA4B,CAACkC,SAAS,CACzDE,IAAI,EACJC,cAAc,CACf,CAAC;;;EACH;EACH,OAAC9C,sBAAA;AAAD,CAAC;AChID,IAAA+C,qBAAA,0BAAAC,MAAA;EAA2CC,SAAsB,CAAAF,qBAAA,EAAAC,MAAA;EAAjE,SAAAD,sBAAA;;IACEG,KAAI,CAAAC,IAAA,GAAG,yBAAyB;;;EAChCJ,qBAAA,CAAA1C,SAAA,CAAAC,IAAI,GAAJ;IACE,IAAI,CAACL,OAAO,CAACmD,cAAc,GAAGpD,sBAAsB;GACrD;EACD+C,qBAAA,CAAA1C,SAAA,CAAAuB,OAAO,GAAP;IACE,OAAO,IAAI,CAAC3B,OAAO,CAACmD,cAAc;GACnC;EACH,OAACL,qBAAA;AAAD,CARA,CAA2CM,sBAAsB,CAQhE;ACQD,IAAAC,QAAA,0BAAAN,MAAA;EAA8BC,SAAgB,CAAAK,QAAA,EAAAN,MAAA;EAC5C,SAAAM,SAAYlD,MAAgC;IAC1C,IAAA8C,KAAA,GAAAF,MAAK,CAAAO,IAAA,OAACnD,MAAM,CAAC,IAAC;;IAGd8C,KAAI,CAACM,cAAc,CAAC,IAAIT,qBAAqB,EAAE,CAAC;IAChDG,KAAI,CAACM,cAAc,CAAC,IAAIC,WAAW,CAACC,MAAM,EAAE,CAAC;IAC7CR,KAAI,CAACM,cAAc,CAAC,IAAIG,mBAAmB,CAACD,MAAM,EAAE,CAAC;;IAErDR,KAAI,CAACM,cAAc,CAAC,IAAII,cAAc,CAACF,MAAM,EAAE,CAAC;IAChDR,KAAI,CAACM,cAAc,CAAC,IAAIK,cAAc,CAACH,MAAM,EAAE,CAAC;;IAEhDR,KAAI,CAACM,cAAc,CAAC,IAAIM,YAAY,CAACJ,MAAM,EAAE,CAAC;;IAG9CR,KAAI,CAACM,cAAc,CAAC,IAAIO,YAAY,CAACL,MAAM,EAAE,CAAC;;;EAElD,OAACJ,QAAA;AAAD,CAjBA,CAA8BU,gBAAgB,CAiB7C"},"metadata":{},"sourceType":"module","externalDependencies":[]}